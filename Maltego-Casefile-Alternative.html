<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DragonJAR Pentesting Scope Designer</title>
    <link rel="icon" type="image/x-icon" href="https://www.dragonjar.org/favicon.ico">
    <style>
        :root {
            --primary-red: #C11b05;
            --black: #000000;
            --white: #FFFFFF;
            --gray-light: #f8f8f8;
            --gray-medium: #e0e0e0;
            --gray-dark: #333333;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --shadow-heavy: rgba(193, 27, 5, 0.25);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--white);
            color: var(--black);
            overflow: hidden;
            height: 100vh;
            display: flex;
            user-select: none;
            -webkit-user-select: none;
            position: relative;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        .loading-logo {
            width: 150px;
            height: auto;
            max-height: 150px;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            object-fit: contain;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-light);
            border-top: 3px solid var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: 20px;
            color: var(--gray-dark);
            font-size: 14px;
        }
        .header-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--white);
            border-bottom: 1px solid var(--gray-medium);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px var(--shadow-light);
        }
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logo-img {
            height: 40px;
            width: auto;
        }
        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--black);
        }
        .logo-text span {
            color: var(--primary-red);
        }
        /* Ocultar título en móvil */
        @media (max-width: 640px) {
            .logo-text {
                display: none !important;
            }
        }
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .mobile-menu-toggle {
            display: none;
            background: transparent;
            border: none;
            font-size: 24px;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 8px;
            margin-right: 10px;
            transition: var(--transition);
        }
        .mobile-menu-toggle:hover {
            color: var(--primary-red);
        }
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }
        .header-button {
            background: var(--gray-light);
            border: 1px solid var(--gray-medium);
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-dark);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .header-button:hover {
            background: var(--primary-red);
            color: var(--white);
            border-color: var(--primary-red);
            transform: translateY(-1px);
        }
        #sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 280px;
            background: var(--white);
            border-right: 1px solid var(--gray-medium);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
        }
        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray-dark);
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }
        .search-box {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--white);
        }
        .search-box:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(193, 27, 5, 0.1);
        }
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .tool-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: var(--white);
            border: 2px solid var(--gray-medium);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        .tool-button.hidden {
            display: none;
        }
        .tool-button:hover {
            border-color: var(--primary-red);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-light);
        }
        .tool-button.active {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }
        .tool-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            object-fit: contain;
        }
        .tool-button span {
            font-size: 11px;
            font-weight: 500;
            text-align: center;
        }
        #canvas-container {
            position: fixed;
            left: 280px;
            top: 60px;
            right: 0;
            bottom: 0;
            background: var(--gray-light);
            overflow: hidden;
        }
        #main-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            background: transparent;
        }
        #main-canvas.connecting { cursor: pointer; }
        #main-canvas.panning { cursor: grab; }
        #main-canvas.dragging { cursor: grabbing; }
        #main-canvas.deleting { cursor: crosshair; }
        .floating-controls {
            position: fixed;
            right: 20px;
            top: 80px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 200;
        }
        /* Ocultar floating-controls en móvil */
        @media (max-width: 768px) {
            .floating-controls {
                display: none !important;
            }
        }
        .control-group {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px var(--shadow-medium);
            padding: 5px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 18px;
        }
        .control-button:hover {
            background: var(--gray-light);
            color: var(--primary-red);
        }
        .control-button.active {
            background: var(--primary-red);
            color: var(--white);
        }
        .mode-indicator {
            padding: 10px 16px;
            background: var(--black);
            color: var(--white);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 2px 8px var(--shadow-medium);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            transform: translateZ(0);
            will-change: transform, background-color;
        }
        /* Ocultar mode-indicator en móvil */
        @media (max-width: 768px) {
            .mode-indicator {
                display: none !important;
            }
        }
        .mode-indicator.connecting {
            background: var(--primary-red);
        }
        .mode-indicator.deleting {
            background: #ff4444;
        }
        .mode-indicator.panning {
            background: #4a90e2;
        }
        .custom-images-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        .custom-image-btn {
            position: relative;
            padding: 8px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .custom-image-btn:hover {
            border-color: var(--primary-red);
            background: #fef2f2;
        }
        .custom-image-btn img {
            max-width: 40px;
            max-height: 40px;
            object-fit: contain;
        }
        .custom-image-btn .custom-image-name {
            font-size: 10px;
            margin-top: 4px;
            text-align: center;
            color: #6b7280;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .custom-image-btn .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .custom-image-btn:hover .remove-btn {
            opacity: 1;
        }
        .custom-upload-btn {
            border: 2px dashed var(--primary-red) !important;
            background: rgba(193, 27, 5, 0.05) !important;
        }
        .custom-upload-btn:hover {
            background: rgba(193, 27, 5, 0.1) !important;
            border-color: #a91b0d !important;
        }
        @media (max-width: 768px) {
            .custom-images-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            .custom-image-btn {
                min-height: 80px;
                padding: 12px;
            }
            .custom-image-btn img {
                max-width: 50px;
                max-height: 50px;
            }
            .custom-image-btn .remove-btn {
                width: 24px;
                height: 24px;
                font-size: 14px;
                top: -8px;
                right: -8px;
            }
            .custom-upload-btn {
                min-height: 80px !important;
                padding: 16px !important;
            }
        }
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .custom-image-btn img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px var(--shadow-heavy);
        }
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--black);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-dark);
        }
        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--gray-medium);
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(193, 27, 5, 0.1);
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-primary {
            background: var(--primary-red);
            color: var(--white);
        }
        .btn-primary:hover {
            background: #a01604;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: var(--gray-light);
            color: var(--black);
        }
        .btn-secondary:hover {
            background: var(--gray-medium);
        }
        .action-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 200;
        }
        .action-button {
            padding: 12px 24px;
            background: var(--white);
            color: var(--black);
            border: 2px solid var(--gray-medium);
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        .action-button:hover {
            border-color: var(--primary-red);
            color: var(--primary-red);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        .action-button.primary {
            background: var(--primary-red);
            color: var(--white);
            border-color: var(--primary-red);
        }
        .action-button.primary:hover {
            background: #a01604;
            border-color: #a01604;
        }
        /* Ocultar action-bar en móvil (se integra en FAB) */
        @media (max-width: 768px) {
            .action-bar {
                display: none !important;
            }
        }
        /* Asegurar interacción táctil correcta */
        .action-button,
        .fab-button,
        .fab-main {
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }
        /* Z-index hierarchy para evitar solapamientos */
        .header-bar { z-index: 1002; }
        .fab-container { z-index: 1001; }
        .fab-menu { z-index: 1000; }
        .fab-backdrop { z-index: 999; }
        .mode-indicator { z-index: 900; }
        .action-bar { z-index: 200; }
        .floating-controls { z-index: 200; }
        .mobile-menu-toggle {
            display: none;
            width: 40px;
            height: 40px;
            background: var(--white);
            border: 2px solid var(--gray-medium);
            border-radius: 8px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
            }
            #sidebar {
                transform: translateX(-100%);
                width: 300px;
            }
            #sidebar.open {
                transform: translateX(0);
                z-index: 1000;
            }
            #canvas-container {
                left: 0;
            }
            .header-controls {
                flex-direction: column;
                gap: 8px;
                align-items: flex-end;
            }
            .header-button {
                padding: 12px 16px;
                font-size: 14px;
                min-height: 44px;
                min-width: 44px;
            }
            .mode-indicator {
                font-size: 11px;
                padding: 6px 10px;
                min-height: 28px;
                display: flex;
                align-items: center;
                position: fixed;
                bottom: 260px;
            }
            .floating-controls {
                right: 10px;
                top: 70px;
            }
            .action-bar {
                bottom: 10px;
                right: 10px;
                flex-direction: column;
            }
            .control-group {
                flex-direction: row;
            }
            .tool-button {
                padding: 20px;
                min-height: 80px;
            }
            .action-button {
                padding: 15px 20px;
                min-height: 50px;
            }
            .connecting-mode .tool-button {
                border-color: var(--primary-red);
                background: rgba(193, 27, 5, 0.1);
            }
        }
        .tooltip {
            position: fixed;
            background: var(--black);
            color: var(--white);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 9999;
            display: none;
            white-space: nowrap;
        }
        .tooltip.show {
            display: block;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--gray-medium);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-red);
        }
        .minimap-container {
            position: fixed;
            bottom: 20px;
            left: 340px;
            width: 200px;
            height: 150px;
            background: var(--white);
            border: 2px solid var(--gray-medium);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            z-index: 100;
            overflow: hidden;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }
        .minimap-container.collapsed {
            height: 40px;
        }
        .minimap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--gray-light);
            border-bottom: 1px solid var(--gray-medium);
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-dark);
            flex-shrink: 0;
            order: 0;
        }
        .minimap-toggle {
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        .minimap-toggle:hover {
            background: var(--gray-medium);
        }
        .minimap-canvas {
            width: 100%;
            flex: 1;
            min-height: 80px;
            cursor: pointer;
            display: block;
            background: var(--gray-light);
            order: 1;
        }
        .minimap-container.collapsed .minimap-canvas {
            display: none;
        }
        @media (max-width: 768px) {
            .minimap-container {
                left: 20px;
                bottom: 15px;
                width: 150px;
                height: auto;
                min-height: 120px;
            }
            .minimap-container.collapsed {
                height: auto;
                min-height: 80px;
            }
        }
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            pointer-events: none;
            max-width: 300px;
        }
        .toast {
            background: var(--white);
            border: 1px solid var(--gray-medium);
            border-radius: var(--border-radius);
            padding: 16px 20px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-heavy);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            font-size: 14px;
        }
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        .toast.success {
            border-left: 4px solid #28a745;
        }
        .toast.error {
            border-left: 4px solid #dc3545;
        }
        .toast.warning {
            border-left: 4px solid #ffc107;
        }
        .toast.info {
            border-left: 4px solid var(--primary-red);
        }
        .toast-icon {
            font-size: 18px;
            min-width: 18px;
        }
        .toast.success .toast-icon {
            color: #28a745;
        }
        .toast.error .toast-icon {
            color: #dc3545;
        }
        .toast.warning .toast-icon {
            color: #ffc107;
        }
        .toast.info .toast-icon {
            color: var(--primary-red);
        }
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 560px;
            background: var(--white);
            border: 2px solid var(--gray-medium);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-dark);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse-dot 2s infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            justify-content: center;
            align-items: center;
        }
        .help-overlay.show {
            display: flex;
            opacity: 1;
        }
        .help-content {
            background: var(--white);
            border-radius: 16px;
            margin: auto;
            padding: 40px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 80px rgba(0,0,0,0.25);
            line-height: 1.6;
        }
        .help-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--white);
            border: 2px solid var(--gray-light);
            font-size: 22px;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .help-close:hover {
            background: var(--primary-red);
            color: var(--white);
            border-color: var(--primary-red);
            transform: scale(1.1);
        }
        /* Help Header */
        .help-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--gray-lightest);
        }
        .help-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 10px 0;
            letter-spacing: -0.5px;
        }
        .help-header p {
            font-size: 16px;
            color: var(--gray-dark);
            margin: 0 0 25px 0;
            font-weight: 500;
        }
        /* Help Search - Sticky */
        .help-search {
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 100;
            margin: 0 0 25px 0;
            padding: 20px 0 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        .help-search input {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-size: 15px;
            color: var(--text-primary);
            background: var(--gray-lightest);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            outline: none;
        }
        .help-search input:focus {
            border-color: var(--primary-red);
            background: var(--white);
            box-shadow: 0 4px 16px rgba(193, 27, 5, 0.1);
            transform: translateY(-1px);
        }
        /* Unified Help Content */
        .unified-help-content {
            max-height: 65vh;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 0 5px 30px 0;
        }
        .help-section {
            margin-bottom: 45px;
            padding-bottom: 35px;
            border-bottom: 2px solid var(--gray-lightest);
            animation: fadeIn 0.4s ease-in-out;
        }
        .help-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .help-section h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 25px 0;
            letter-spacing: -0.5px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--primary-red);
            display: inline-block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Enhanced scrollbar for help content */
        .help-content::-webkit-scrollbar {
            width: 8px;
        }
        .help-content::-webkit-scrollbar-track {
            background: var(--gray-lightest);
            border-radius: 4px;
        }
        .help-content::-webkit-scrollbar-thumb {
            background: var(--gray-light);
            border-radius: 4px;
        }
        .help-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-red);
        }
        /* Getting Started Styles */
        .getting-started-content {
            margin-bottom: 30px;
        }
        .intro-text {
            font-size: 16px;
            color: var(--text-primary);
            margin: 0 0 20px 0;
            line-height: 1.6;
            font-weight: 500;
        }
        /* Shortcut Categories */
        .shortcut-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 28px;
            margin: 30px 0;
        }
        .shortcut-category {
            background: var(--white);
            border: 2px solid var(--gray-lightest);
            border-radius: 16px;
            padding: 24px;
            border-left: 4px solid var(--primary-red);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .shortcut-category:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(193, 27, 5, 0.15);
            border-color: var(--primary-red);
        }
        .shortcut-category h4 {
            color: var(--primary-red);
            margin: 0 0 18px 0;
            font-size: 18px;
            font-weight: 700;
        }
        /* Pro Tips Container */
        .pro-tips-container {
            display: grid;
            gap: 24px;
            margin: 30px 0;
        }
        .pro-tip-item {
            display: flex;
            align-items: flex-start;
            background: var(--white);
            border: 2px solid var(--gray-lightest);
            border-radius: 16px;
            padding: 24px;
            border-left: 4px solid var(--primary-red);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .pro-tip-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(193, 27, 5, 0.15);
            border-color: var(--primary-red);
        }
        .tip-icon {
            font-size: 28px;
            margin-right: 18px;
            flex-shrink: 0;
            background: var(--gray-lightest);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-red);
        }
        .tip-content h4 {
            color: var(--primary-red);
            margin: 0 0 10px 0;
            font-size: 18px;
            font-weight: 700;
        }
        .tip-content p {
            margin: 0;
            color: var(--gray-dark);
            font-size: 15px;
            line-height: 1.6;
        }
        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-dark);
        }
        .no-results-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .no-results h3 {
            margin: 0 0 10px 0;
            color: var(--gray-dark);
        }
        .no-results p {
            margin: 0;
            opacity: 0.7;
        }
        .shortcut-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 16px 24px;
            margin: 0;
            align-items: center;
        }
        .shortcut-key {
            background: var(--gray-lightest);
            padding: 8px 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-red);
            border: 2px solid var(--gray-light);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .shortcut-grid span:nth-child(even) {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 30px 0;
        }
        .feature-item {
            background: var(--white);
            border: 2px solid var(--gray-lightest);
            border-radius: 16px;
            padding: 24px;
            border-left: 4px solid var(--primary-red);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .feature-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(193, 27, 5, 0.15);
            border-color: var(--primary-red);
        }
        .feature-item h4 {
            margin: 0 0 12px 0;
            color: var(--primary-red);
            font-size: 18px;
            font-weight: 700;
        }
        .feature-item p {
            margin: 0;
            color: var(--gray-dark);
            font-size: 15px;
            line-height: 1.6;
        }
        .usage-steps {
            list-style: none;
            padding: 0;
            margin: 25px 0;
            counter-reset: step-counter;
        }
        .usage-steps li {
            counter-increment: step-counter;
            background: var(--gray-lightest);
            border-radius: 12px;
            padding: 20px 25px;
            margin-bottom: 16px;
            position: relative;
            padding-left: 70px;
            line-height: 1.6;
            font-size: 15px;
            border-left: 4px solid var(--primary-red);
            transition: all 0.3s ease;
        }
        .usage-steps li:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .usage-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 20px;
            top: 20px;
            background: var(--primary-red);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        .usage-steps li strong {
            color: var(--primary-red);
            font-weight: 700;
        }
        .usage-step {
            counter-increment: step-counter;
            background: var(--gray-lightest);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            position: relative;
            padding-left: 60px;
        }
        .usage-step::before {
            content: counter(step-counter);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-red);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .pro-tips {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .pro-tips h3 {
            color: var(--primary-red);
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        .pro-tips ul {
            margin: 0;
            padding-left: 20px;
        }
        .pro-tips li {
            margin-bottom: 8px;
            color: var(--gray-dark);
            font-size: 14px;
            line-height: 1.4;
        }
        @media (max-width: 768px) {
            .toast {
                min-width: 280px;
                right: 10px;
                top: 70px;
            }
            .toast-container {
                top: 70px;
                right: 10px;
                left: 180px;
            }
            .status-indicator {
                position: static;
                right: auto;
                bottom: auto;
                font-size: 10px;
                padding: 6px 8px;
                margin: 4px 8px 8px 8px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                gap: 6px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                border: 1px solid var(--gray-light);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                flex-shrink: 0;
                order: 2;
            }
            .status-indicator .status-dot {
                width: 6px;
                height: 6px;
                flex-shrink: 0;
            }
            .status-indicator span {
                font-size: 10px;
                font-weight: 500;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .help-content {
                margin: 20px;
                padding: 25px;
                max-height: calc(100vh - 40px);
                border-radius: 12px;
            }
            .help-header {
                margin-bottom: 25px;
                padding-bottom: 20px;
            }
            .help-header h2 {
                font-size: 24px;
            }
            .help-header p {
                font-size: 15px;
                margin-bottom: 20px;
            }
            .help-close {
                width: 36px;
                height: 36px;
                font-size: 20px;
                top: 15px;
                right: 15px;
            }
            /* Mobile Search */
            .help-search {
                margin: 0 0 20px 0;
                padding: 15px 0 10px 0;
            }
            .help-search input {
                padding: 12px 18px;
                font-size: 16px;
                border-radius: 12px;
                background: var(--gray-lightest);
            }
            /* Mobile Unified Content */
            .unified-help-content {
                max-height: 60vh;
                padding: 0 2px 20px 0;
            }
            .help-section {
                margin-bottom: 35px;
                padding-bottom: 25px;
            }
            .help-section h3 {
                font-size: 20px;
                margin-bottom: 20px;
            }
            /* Mobile Getting Started */
            .getting-started-content {
                margin-bottom: 20px;
            }
            .intro-text {
                font-size: 15px;
            }
            /* Mobile Shortcut Categories */
            .shortcut-categories {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 25px 0;
            }
            .shortcut-category {
                padding: 20px;
            }
            /* Mobile Pro Tips */
            .pro-tip-item {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            .pro-tips-container {
                margin: 25px 0;
                gap: 20px;
            }
            .tip-icon {
                margin-right: 0;
                margin-bottom: 15px;
                width: 45px;
                height: 45px;
                font-size: 24px;
            }
            /* Mobile No Results */
            .no-results {
                padding: 40px 15px;
            }
            .no-results-icon {
                font-size: 36px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 25px 0;
            }
            .feature-item {
                padding: 20px;
            }
            .usage-step {
                padding: 12px 15px 12px 50px;
                margin-bottom: 12px;
            }
            .usage-step::before {
                left: 15px;
                width: 20px;
                height: 20px;
                font-size: 11px;
            }
            .pro-tips {
                padding: 15px;
            }
        }
        /* Mobile Floating Action Button (FAB) System */
        .fab-container {
            position: fixed;
            bottom: calc(16px + env(safe-area-inset-bottom));
            right: calc(16px + env(safe-area-inset-right));
            z-index: 1001;
            display: none;
            pointer-events: auto;
        }
        /* Mostrar FAB solo en móvil */
        @media (max-width: 768px) {
            .fab-container {
                display: block !important;
            }
        }
        .fab-main {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary-red);
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            position: relative;
            z-index: 1001;
        }
        .fab-main:hover {
            background: #a91704;
            transform: scale(1.1);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }
        .fab-main.expanded {
            transform: rotate(45deg);
            background: #a91704;
        }
        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .fab-menu.expanded {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .fab-option {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            opacity: 0;
            transform: translateX(20px);
            animation: fab-option-in 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .fab-option:nth-child(1) { animation-delay: 0.1s; }
        .fab-option:nth-child(2) { animation-delay: 0.15s; }
        .fab-option:nth-child(3) { animation-delay: 0.2s; }
        .fab-option:nth-child(4) { animation-delay: 0.25s; }
        @keyframes fab-option-in {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .fab-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-red);
            font-size: 18px;
            transition: all 0.2s ease;
        }
        .fab-button:hover {
            background: #f5f5f5;
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .fab-button:active {
            transform: scale(0.95);
        }
        .fab-label {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            margin-left: auto;
        }
        .fab-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .fab-backdrop.visible {
            opacity: 1;
            visibility: visible;
        }
        /* Ripple effect for FAB buttons */
        .fab-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        /* Respetar preferencias de movimiento reducido */
        @media (prefers-reduced-motion: reduce) {
            .fab-main,
            .fab-button,
            .fab-menu,
            .fab-backdrop,
            .mode-indicator {
                transition: none !important;
                animation: none !important;
            }
            .fab-option {
                animation: none !important;
            }
            .fab-ripple {
                display: none !important;
            }
        }
        /* Show FAB only on mobile devices */
        @media (max-width: 768px) {
            .fab-container {
                display: block;
            }
        }
        /* Adaptive Context Menu for Mobile */
        .mobile-context-menu {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .mobile-context-menu.visible {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }
        .context-menu-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            color: var(--gray-dark);
            min-height: 52px;
            transition: background-color 0.2s ease;
        }
        .context-menu-item:last-child {
            border-bottom: none;
        }
        .context-menu-item:hover {
            background: #f8f9fa;
        }
        .context-menu-item.danger {
            color: #dc3545;
        }
        .context-menu-item.danger:hover {
            background: #fee;
        }
        .context-menu-icon {
            font-size: 18px;
            min-width: 18px;
        }
        /* Mobile Space Optimization Classes */
        @media (max-width: 768px) {
            body {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: none;
                touch-action: none;
            }
            #sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1001;
                box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            }
            #sidebar.active {
                transform: translateX(0);
            }
            #canvas-container {
                left: 0 !important;
                touch-action: none;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
            }
            #main-canvas {
                touch-action: none;
                -webkit-tap-highlight-color: transparent;
            }
            .header-bar {
                position: fixed;
                z-index: 1002;
            }
            .floating-controls {
                display: none;
            }
            .mobile-device #canvas-container {
                left: 0 !important;
            }
            .mobile-fullscreen .header-bar {
                transition: transform 0.3s ease;
            }
            .mobile-fullscreen #canvas-container {
                left: 0 !important;
                top: 0 !important;
                transition: all 0.3s ease;
            }
            .mobile-fullscreen-hide .fab-container,
            .mobile-fullscreen-hide .toast-container,
            .mobile-fullscreen-hide .status-indicator {
                opacity: 0.3;
                transition: opacity 0.3s ease;
            }
            .mobile-landscape .fab-container {
                bottom: 16px;
                right: 16px;
            }
            .mobile-portrait .minimap-container {
                width: 120px;
                height: 90px;
                bottom: 90px;
            }
        }
        /* iOS Specific Fixes */
        @supports (-webkit-touch-callout: none) {
            body {
                position: fixed;
                width: 100%;
                height: 100vh;
            }
            #canvas-container {
                -webkit-overflow-scrolling: auto;
                position: fixed;
            }
            .modal {
                -webkit-backdrop-filter: blur(10px);
                backdrop-filter: blur(10px);
            }
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        /* Extra small mobile screens */
        @media (max-width: 480px) {
            .mobile-xs .toast {
                min-width: 250px;
                right: 5px;
                font-size: 13px;
            }
            .mobile-xs .fab-main {
                width: 48px !important;
                height: 48px !important;
            }
            .mobile-xs .fab-button {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            .mobile-xs .context-menu-item {
                padding: 14px 16px;
                font-size: 15px;
                min-height: 48px;
            }
        }
        /* Responsive visual feedback animations */
        .mobile-show {
            animation: mobile-fade-in 0.3s ease;
        }
        @keyframes mobile-fade-in {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        /* Touch-friendly hover states for mobile */
        @media (hover: none) {
            .tool-button:hover {
                transform: none;
                box-shadow: 0 2px 8px var(--shadow-light);
            }
            .fab-button:hover {
                transform: none;
            }
            .context-menu-item:hover {
                background: #f0f0f0;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <img class="loading-logo" src="https://www.dragonjar.org/wp-content/uploads/2010/05/Logo-2-seguridad.png.webp" alt="DragonJAR Loading" />
        <div class="loading-spinner"></div>
        <div class="loading-text">Iniciando...</div>
    </div>
    <div class="header-bar">
        <div class="logo-section">
            <button class="mobile-menu-toggle" id="mobileMenuToggle">☰</button>
            <img class="logo-img" src="https://www.dragonjar.org/wp-content/uploads/2010/05/Logo-2-seguridad.png.webp" alt="DragonJAR" />
            <div class="logo-text"><span>Scope Designer</span></div>
        </div>
        <div class="header-controls">
            <div class="mode-indicator" id="modeIndicator">Normal</div>
            <button class="header-button" id="helpBtn" title="Ayuda y atajos de teclado">
                ❓ Ayuda
            </button>
        </div>
    </div>
    <div id="sidebar">
        <div class="sidebar-section">
            <input type="text" class="search-box" id="searchBox" placeholder="Buscar elementos...">
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Infraestructura</div>
            <div class="tool-grid">
                <button class="tool-button" data-type="server" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1 4.75C1 3.10996 2.47275 2 4 2H20C21.5273 2 23 3.10996 23 4.75V8.25C23 9.89004 21.5273 11 20 11H4C2.47275 11 1 9.89004 1 8.25V4.75ZM7 6.5C7 7.32843 6.32843 8 5.5 8C4.67157 8 4 7.32843 4 6.5C4 5.67157 4.67157 5 5.5 5C6.32843 5 7 5.67157 7 6.5Z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M1 15.75C1 14.11 2.47275 13 4 13H20C21.5273 13 23 14.11 23 15.75V19.25C23 20.89 21.5273 22 20 22H4C2.47275 22 1 20.89 1 19.25V15.75ZM7 17.5C7 18.3284 6.32843 19 5.5 19C4.67157 19 4 18.3284 4 17.5C4 16.6716 4.67157 16 5.5 16C6.32843 16 7 16.6716 7 17.5Z"/>
                    </svg>
                    <span>Servidor</span>
                </button>
                <button class="tool-button" data-type="client" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M4 1.5C2.17363 1.5 0.5 2.9003 0.5 4.85714V14.1429C0.5 16.0997 2.17363 17.5 4 17.5H10.5V19.5H7.5C6.94772 19.5 6.5 19.9477 6.5 20.5V21.5C6.5 22.0523 6.94771 22.5 7.5 22.5H16.5C17.0523 22.5 17.5 22.0523 17.5 21.5V20.5C17.5 19.9477 17.0523 19.5 16.5 19.5H13.5V17.5H20C21.8264 17.5 23.5 16.0997 23.5 14.1429V4.85714C23.5 2.9003 21.8264 1.5 20 1.5H4Z"/>
                    </svg>
                    <span>Cliente</span>
                </button>
                <button class="tool-button" data-type="cloud" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 441.902 441.902" fill="#C11b05" xmlns="http:
                        <path d="M329.375,293.848c58.766,0,106.576-47.811,106.576-106.58c0-58.766-47.811-106.576-106.576-106.576c-4.114,0-8.213,0.234-12.277,0.703c-4.898-20.225-15.654-38.646-31.178-53.025C266.168,10.076,240.456,0,213.52,0c-49.559,0-91.801,33.842-103.422,80.719C52.446,82.012,5.951,129.313,5.951,187.268c0,58.77,47.81,106.58,106.577,106.58h53.923v41.565h-61.883c-5.294-9.533-15.462-16-27.117-16c-17.093,0-31,13.906-31,31c0,17.094,13.907,31,31,31c11.655,0,21.823-6.469,27.117-16h76.883c8.284,0,15-6.717,15-15v-56.565h9.5v89.938c-9.532,5.293-16,15.463-16,27.117c0,17.094,13.907,31,31,31c17.093,0,31-13.906,31-31c0-11.654-6.468-21.824-16-27.117v-89.938h9.5v57.994c0,8.285,6.716,15,15,15h77.73c5.488,8.742,15.208,14.57,26.27,14.57c17.093,0,31-13.906,31-31c0-17.094-13.907-31-31-31c-12.229,0-22.825,7.119-27.866,17.43h-61.134v-42.994H329.375z"/>
                    </svg>
                    <span>Nube</span>
                </button>
                <button class="tool-button" data-type="database" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 16 16" fill="#C11b05" xmlns="http:
                        <path d="M13.1371 6.91018C13.4184 6.7695 13.7123 6.59981 14 6.40001V8C14 9.65685 11.3137 11 8 11C4.68629 11 2 9.65685 2 8V6.40001C2.28772 6.59981 2.58158 6.7695 2.86293 6.91018C4.28096 7.61919 6.09998 8 8 8C9.90002 8 11.719 7.61919 13.1371 6.91018Z"/>
                        <path d="M2 11.4V13C2 14.6569 4.68629 16 8 16C11.3137 16 14 14.6569 14 13V11.4C13.7123 11.5998 13.4184 11.7695 13.1371 11.9102C11.719 12.6192 9.90002 13 8 13C6.09998 13 4.28096 12.6192 2.86293 11.9102C2.58158 11.7695 2.28772 11.5998 2 11.4Z"/>
                        <path d="M8 0C11.3137 0 14 1.34315 14 3C14 4.65685 11.3137 6 8 6C4.68629 6 2 4.65685 2 3C2 1.34315 4.68629 0 8 0Z"/>
                    </svg>
                    <span>Base de Datos</span>
                </button>
                <button class="tool-button" data-type="vm" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 16 16" fill="#C11b05" xmlns="http:
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2h13l.5.5v5.503a5.006 5.006 0 0 0-1-.583V3H2v9h5a5 5 0 0 0 1 3H4v-1h3v-1H1.5l-.5-.5v-10l.5-.5z"/>
                        <path d="M12 8c.367 0 .721.047 1.063.14.34.094.658.23.953.407.294.177.563.385.808.625.245.24.455.509.63.808a4.03 4.03 0 0 1 .405 3.082c-.093.342-.229.66-.406.954a4.382 4.382 0 0 1-.625.808c-.24.245-.509.455-.808.63a4.029 4.029 0 0 1-3.082.405 3.784 3.784 0 0 1-.954-.406 4.382 4.382 0 0 1-.808-.625 3.808 3.808 0 0 1-.63-.808 4.027 4.027 0 0 1-.405-3.082c.093-.342.229-.66.406-.954.177-.294.385-.563.625-.808.24-.245.509-.455.808-.63A4.028 4.028 0 0 1 12 8zm2 3.988L11 10v4l3-2.012z"/>
                    </svg>
                    <span>Máquina Virtual</span>
                </button>
                <button class="tool-button" data-type="proxy" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 128 128" fill="#C11b05" xmlns="http:
                        <path d="M 42.9375 22.03125 C 40.773543 22.03125 39.03125 23.773543 39.03125 25.9375 L 39.03125 33.875 C 39.03125 36.03896 40.773543 37.78125 42.9375 37.78125 L 85.0625 37.78125 C 87.22646 37.78125 88.96875 36.03896 88.96875 33.875 L 88.96875 25.9375 C 88.96875 23.773543 87.22646 22.03125 85.0625 22.03125 L 42.9375 22.03125 z M 46.5 26.75 C 46.58526 26.7333 46.659723 26.75 46.75 26.75 L 56.3125 26.75 C 57.034718 26.75 57.625 27.309032 57.625 28.03125 L 57.625 31.75 C 57.625 32.47222 57.034718 33.0625 56.3125 33.0625 L 46.75 33.0625 C 46.027782 33.0625 45.4375 32.47222 45.4375 31.75 L 45.4375 28.03125 C 45.4375 27.399309 45.903187 26.866876 46.5 26.75 z M 42.9375 44.75 C 40.773543 44.75 39.03125 46.492293 39.03125 48.65625 L 39.03125 56.59375 C 39.03125 58.75771 40.773543 60.5 42.9375 60.5 L 85.0625 60.5 C 87.22646 60.5 88.96875 58.75771 88.96875 56.59375 L 88.96875 48.65625 C 88.96875 46.492293 87.22646 44.75 85.0625 44.75 L 42.9375 44.75 z M 46.5 49.46875 C 46.58526 49.45205 46.659723 49.46875 46.75 49.46875 L 56.3125 49.46875 C 57.034718 49.46875 57.625 50.027782 57.625 50.75 L 57.625 54.46875 C 57.625 55.19097 57.034718 55.78125 56.3125 55.78125 L 46.75 55.78125 C 46.027782 55.78125 45.4375 55.19097 45.4375 54.46875 L 45.4375 50.75 C 45.4375 50.118059 45.903187 49.585626 46.5 49.46875 z M 25.0625 54.5625 L 5.1875 64 L 25.0625 73.4375 L 25.0625 68.5 L 32.90625 68.5 C 34.04633 68.5 34.96875 67.577577 34.96875 66.4375 L 34.96875 61.5625 C 34.96875 60.422423 34.04633 59.5 32.90625 59.5 L 25.0625 59.5 L 25.0625 54.5625 z M 102.9375 54.5625 L 102.9375 59.5 L 95.125 59.5 C 93.98492 59.5 93.0625 60.422423 93.0625 61.5625 L 93.0625 66.4375 C 93.0625 67.577577 93.98492 68.5 95.125 68.5 L 102.9375 68.5 L 102.9375 73.4375 L 122.8125 64 L 102.9375 54.5625 z M 42.9375 67.5 C 40.773543 67.5 39.03125 69.242293 39.03125 71.40625 L 39.03125 79.34375 C 39.03125 81.50771 40.773543 83.25 42.9375 83.25 L 85.0625 83.25 C 87.22646 83.25 88.96875 81.50771 88.96875 79.34375 L 88.96875 71.40625 C 88.96875 69.242293 87.22646 67.5 85.0625 67.5 L 42.9375 67.5 z M 46.5 72.21875 C 46.58526 72.20205 46.659723 72.21875 46.75 72.21875 L 56.3125 72.21875 C 57.034718 72.21875 57.625 72.777782 57.625 73.5 L 57.625 77.21875 C 57.625 77.94097 57.034718 78.53125 56.3125 78.53125 L 46.75 78.53125 C 46.027782 78.53125 45.4375 77.94097 45.4375 77.21875 L 45.4375 73.5 C 45.4375 72.868059 45.903187 72.335626 46.5 72.21875 z M 42.9375 90.21875 C 40.773543 90.21875 39.03125 91.961043 39.03125 94.125 L 39.03125 102.0625 C 39.03125 104.22646 40.773543 105.96875 42.9375 105.96875 L 85.0625 105.96875 C 87.22646 105.96875 88.96875 104.22646 88.96875 102.0625 L 88.96875 94.125 C 88.96875 91.961043 87.22646 90.21875 85.0625 90.21875 L 42.9375 90.21875 z M 46.5 94.9375 C 46.58526 94.9208 46.659723 94.9375 46.75 94.9375 L 56.3125 94.9375 C 57.034718 94.9375 57.625 95.496532 57.625 96.21875 L 57.625 99.9375 C 57.625 100.65972 57.034718 101.25 56.3125 101.25 L 46.75 101.25 C 46.027782 101.25 45.4375 100.65972 45.4375 99.9375 L 45.4375 96.21875 C 45.4375 95.586809 45.903187 95.054376 46.5 94.9375 z "/>
                    </svg>
                    <span>Proxy</span>
                </button>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Seguridad</div>
            <div class="tool-grid">
                <button class="tool-button" data-type="waf" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 430 430" fill="#C11b05" xmlns="http:
                        <g>
                            <path d="M323.423,111.047c-4.114,0-8.213,0.234-12.277,0.703c-4.898-20.225-15.654-38.646-31.177-53.025c-19.752-18.294-45.464-28.369-72.401-28.369c-49.559,0-91.801,33.842-103.422,80.719C46.495,112.367,0,159.668,0,217.623c0,58.77,47.81,106.58,106.577,106.58h19.91c5.509,8.814,11.634,17.236,18.354,25.219c26.339,31.287,52.815,45.273,55.731,46.757c4.446,2.268,9.436,3.466,14.428,3.466c4.964,0,9.928-1.185,14.339-3.42c2.935-1.483,29.436-15.397,55.808-46.682c6.757-8.016,12.914-16.479,18.447-25.34h19.829c58.767,0,106.577-47.81,106.577-106.58C430,158.857,382.19,111.047,323.423,111.047z M303.335,280.381c-8.076,20.565-19.341,39.498-33.48,56.272c-24.194,28.701-48.514,41.204-49.538,41.722c-1.671,0.847-3.494,1.27-5.317,1.27c-1.833,0-3.666-0.428-5.343-1.283c-1.023-0.521-25.331-13.092-49.517-41.82c-14.137-16.793-25.399-35.728-33.475-56.28c-10.049-25.573-15.145-53.683-15.145-83.547c0-5.293,3.533-9.936,8.635-11.348c62.144-17.179,86.997-37.796,87.241-38.003c4.422-3.741,10.821-3.783,15.208,0c0.207,0.173,25.819,21.024,87.241,38.003c5.102,1.412,8.635,6.055,8.635,11.348C318.479,226.643,313.384,254.793,303.335,280.381z"/>
                            <path d="M178.152,321.377c14.709,17.474,29.27,28.009,36.841,32.839L215,170.838c-11.589,7.649-36.918,21.957-79.774,34.699C136.881,250.547,151.301,289.482,178.152,321.377z"/>
                        </g>
                    </svg>
                    <span>WAF</span>
                </button>
                <button class="tool-button" data-type="vpn" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 496 496" fill="#C11b05" xmlns="http:
                        <g id="SVGRepo_bgCarrier" stroke-width="0"/>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>
                        <g id="SVGRepo_iconCarrier">
                            <path style="fill:#C11b05;" d="M248,298.4L248,298.4L248,298.4L248,298.4L248,298.4c-8-0.8-16-2.4-24-4v126.4c0,13.6,10.4,24,24,24 s24-10.4,24-24V294.4C264,296,256,297.6,248,298.4z"/>
                            <path style="fill:#C11b05;" d="M248,298.4L248,298.4L248,298.4L248,298.4c-8-0.8-16-2.4-24-4V376h48v-81.6 C264,296,256,297.6,248,298.4L248,298.4z"/>
                            <path style="fill:#C11b05;" d="M398.4,456H97.6c-13.6,0-24-10.4-24-24s10.4-24,24-24h301.6c13.6,0,24,10.4,24,24 C422.4,445.6,412,456,398.4,456z"/>
                            <path style="fill:#C11b05;" d="M496,317.6c0,13.6-13.6,26.4-26.4,26.4H26.4C13.6,344,0,330.4,0,317.6V64c0-13.6,13.6-24,26.4-24 h442.4c13.6,0,27.2,10.4,27.2,24V317.6z"/>
                            <rect x="160" y="408" style="fill:#C11b05;" width="176" height="48"/>
                            <g>
                                <path style="fill:#FFFFFF;" d="M192,120h-15.2c-3.2,0-6.4,3.2-7.2,6.4L151.2,180c-1.6,4.8-3.2,9.6-4.8,14.4 c-1.6-4.8-2.4-8.8-4-13.6l-16.8-54.4c-0.8-3.2-4-6.4-8-6.4h-15.2c-2.4,0-4.8,2.4-6.4,4.8s-1.6,5.6-0.8,8l35.2,108.8 c0.8,3.2,4,6.4,8,6.4h15.2c3.2,0,6.4-3.2,7.2-6.4l38.4-108c0.8-2.4,0.8-6.4-0.8-8.8C196.8,122.4,194.4,120,192,120z"/>
                                <path style="fill:#FFFFFF;" d="M246.4,121.6c-9.6,0-20.8,0.8-29.6,2.4c-4,0.8-8,4-8,8v106.4c0,4.8,7.2,9.6,11.2,9.6h13.6 c4.8,0,6.4-5.6,6.4-9.6V204c16,0.8,33.6-4.8,42.4-14.4c7.2-7.2,11.2-16.8,11.2-28.8s-4-21.6-12-28.8 C273.6,125.6,261.6,121.6,246.4,121.6z M264,161.6c0,9.6-7.2,15.2-20,15.2c-1.6,0-4,0-4,0v-28c0,0,4,0,5.6,0 C263.2,148.8,264,158.4,264,161.6z"/>
                                <path style="fill:#FFFFFF;" d="M392,120h-16.8c-4.8,0-7.2,5.6-7.2,10.4v44.8c0,0.8,0,0.8,0,1.6l-32.8-52c-1.6-2.4-4.8-4.8-7.2-4.8 h-15.2c-4.8,0-8.8,5.6-8.8,10.4v108c0,4.8,4,9.6,8.8,9.6h12.8c4.8,0,10.4-5.6,10.4-9.6v-56c0.8,1.6,1.6,3.2,3.2,5.6l33.6,56 c1.6,2.4,4,4.8,6.4,4.8h14.4c4.8,0,6.4-5.6,6.4-9.6V130.4C400,125.6,396.8,120,392,120z"/>
                            </g>
                        </g>
                    </svg>
                    <span>VPN</span>
                </button>
                <button class="tool-button" data-type="firewall" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 512 512" fill="#C11b05" xmlns="http:
                        <rect x="0.034" y="0.787" width="155.35" height="94.936"/>
                        <rect x="172.645" y="0.787" width="155.35" height="94.936"/>
                        <rect x="0" y="112.959" width="69.044" height="94.936"/>
                        <rect x="86.34" y="112.985" width="155.35" height="94.936"/>
                        <path d="M266.78,160.9l16.756-26.634l9.111,8.58c1.892-10.19,5.36-20.152,10.22-29.862h-43.916v60.279 C263.7,165.796,266.68,161.059,266.78,160.9z"/>
                        <path d="M436.126,148.283c22.542,18.028,41.586,38.129,56.938,59.613h7.509v-94.936h-69.044v31.32 C433.046,145.611,434.47,146.959,436.126,148.283z"/>
                        <rect x="0.034" y="225.182" width="155.35" height="94.936"/>
                        <rect x="0" y="337.354" width="69.044" height="77.675"/>
                        <path d="M368.494,54.627c4.479,0,8.996,1.003,13.068,2.908c9.836,4.517,16.654,14.16,17.653,25.083l1.193,13.106h100.2 V0.787h-155.35V62.87c3.902-2.562,7.324-4.24,10.097-5.302C359.441,55.639,363.904,54.627,368.494,54.627z"/>
                        <path d="M419.957,168.501c-29.116-23.278-40.498-48.985-44.873-67.266c-3.502-14.682-1.656-16.258-1.656-16.258 c-0.16-1.753-1.252-3.262-2.827-3.986c-1.606-0.75-3.456-0.599-4.888,0.405c0,0-5.66,1.222-14.838,10.139 c-20.936,20.328-44.616,54.228-29.023,100.583c16.756,49.743,7.897,60.144-0.864,59.47c-11.37-0.868-13.106-7.872-11.29-29.668 c2.107-25.479-20.999-47.232-20.999-47.232s-35.901,57.076-63.891,97.904c-16.545,24.13-24.471,54.809-24.471,82.799h-0.561 c0,86.044,69.761,155.822,155.827,155.822c86.078,0,155.822-69.778,155.822-155.822 C517.358,280.64,476.759,213.939,419.957,168.501z M355.872,467.335c-47.461,0-85.969-38.492-85.969-85.968 c0-16.157,4.488-31.286,12.238-44.198c6.688,24.855,29.372,43.169,56.352,43.169c32.204,0,58.332-26.11,58.332-58.315 c0-6.153-0.965-12.086-2.735-17.657c28.298,14.076,47.75,43.254,47.75,77.001C441.84,428.843,403.365,467.335,355.872,467.335z"/>
                        <path d="M177.959,320.118c4.522-22.748,13.279-44.35,25.496-62.167c7.021-10.24,14.577-21.568,21.943-32.77h-52.752 v94.936H177.959z"/>
                        <path d="M173.884,337.379H86.34v77.675h97.814c-6.536-18.719-10.27-38.744-10.27-59.664V337.379z"/>
                    </svg>
                    <span>Firewall</span>
                </button>
                <button class="tool-button" data-type="soc" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 512 512" fill="#C11b05" xmlns="http:
                        <path d="M429.823,409.401c-11.741-17.577-29.574-27.295-46.322-33.618c-8.41-3.157-16.624-5.492-23.859-7.474 c-7.227-1.965-13.508-3.618-17.725-5.213c-7.384-2.738-15.186-6.289-20.628-10.112c-2.722-1.899-4.81-3.856-6.027-5.517 c-1.225-1.702-1.562-2.878-1.578-3.906c0-7.103,0-15.974,0-27.666c9.447-10.508,23.021-26.794,28.595-52.618 c1.949-0.88,3.873-1.875,5.731-3.166c4.62-3.19,8.542-7.819,11.864-14.116c3.346-6.323,6.306-14.405,9.463-25.463 c1.603-5.607,2.343-10.474,2.343-14.815c0.008-4.999-1.028-9.332-2.911-12.85c-2.482-4.678-6.29-7.457-9.701-9.002l7.703-11.478 v-12.727c0.732-0.995,1.2-1.908,1.085-2.631v-27.567l19.6-39.184c4.966-9.932,1.127-22.018-8.666-27.263L265.693,2.43 c-6.05-3.24-13.327-3.24-19.378,0L133.21,63.015c-9.784,5.245-13.624,17.331-8.657,27.263l19.6,39.209v27.543 c-0.123,0.748,0.288,1.66,1.085,2.696v12.662l7.704,11.46c-0.798,0.354-1.62,0.757-2.467,1.275 c-2.664,1.644-5.352,4.218-7.235,7.745c-1.883,3.519-2.919,7.851-2.91,12.85c0,4.341,0.74,9.208,2.343,14.815 c4.226,14.726,8.041,24.238,12.982,31.218c2.475,3.461,5.287,6.24,8.345,8.361c1.858,1.29,3.783,2.286,5.731,3.166 c5.574,25.824,19.148,42.111,28.595,52.618c0,11.692,0,20.562,0,27.666c0,0.872-0.354,2.13-1.702,3.93 c-1.989,2.672-6.108,5.912-11,8.657c-4.876,2.771-10.483,5.18-15.391,6.907c-5.764,2.047-15.054,4.168-25.455,7.153 c-15.629,4.522-34.111,11.033-49.149,23.925c-7.506,6.446-14.092,14.544-18.729,24.607c-4.636,10.056-7.301,22.01-7.292,35.986 c0,3.248,0.14,6.602,0.428,10.072c0.222,2.434,1.142,4.407,2.236,6.034c2.064,3.042,4.81,5.295,8.246,7.622 c6.019,3.979,14.364,7.876,25.043,11.699c31.958,11.396,84.881,21.829,150.449,21.846c53.268,0,98.232-6.914,130.329-15.605 c16.057-4.349,28.875-9.118,38.141-13.878c4.646-2.393,8.394-4.768,11.37-7.358c1.488-1.316,2.795-2.688,3.889-4.325 c1.094-1.627,2.015-3.6,2.228-6.034c0.288-3.461,0.428-6.816,0.428-10.046C442.419,436.114,437.633,421.093,429.823,409.401z M231.936,137.544c0-13.294,10.77-24.065,24.073-24.065c13.286,0,24.056,10.77,24.056,24.065v2.31 c0,13.287-10.77,24.065-24.056,24.065c-13.303,0-24.073-10.778-24.073-24.065V137.544z M236.466,460.639l-54.806-86.517 c4.991-2.088,10.104-4.727,14.84-7.777l31.366,45.104l15.128-28.455L236.466,460.639z M227.117,398.837l-25.273-36.332 c2.31-1.891,4.505-3.897,6.306-6.256c2.54-3.33,4.472-7.49,4.596-12.218l35.386,15.276L227.117,398.837z M212.795,336.887 c0-6.462,0-14.142,0-23.761v-2.77l-1.858-2.072c-9.874-10.993-23.234-25.586-27.871-51.516l-0.732-4.144l-3.955-1.414 c-2.524-0.896-4.439-1.817-6.116-2.984c-2.475-1.743-4.72-4.127-7.342-9.011c-2.59-4.86-5.328-12.119-8.328-22.65 c-1.324-4.604-1.792-8.181-1.792-10.845c0.008-3.083,0.6-4.884,1.2-6.026c0.913-1.653,2.032-2.36,3.454-2.936 c0.642-0.246,1.29-0.378,1.842-0.468l14.873,22.157l6.363-37.285l0.699-2.336c19.42,6.159,44.644,11.1,72.779,11.1 c28.06,0,53.366-4.9,72.794-11.041l0.674,2.277l6.364,37.285l14.873-22.141c0.937,0.148,2.195,0.46,3.166,1.102 c0.83,0.535,1.504,1.151,2.121,2.286c0.6,1.142,1.192,2.943,1.209,6.026c0,2.664-0.477,6.24-1.792,10.845 c-3.988,14.059-7.564,22.231-10.853,26.77c-1.644,2.293-3.149,3.724-4.818,4.892c-1.677,1.168-3.592,2.089-6.116,2.984 l-3.963,1.414l-0.724,4.144c-4.636,25.93-17.998,40.524-27.871,51.516l-1.858,2.072v2.77c0,9.62,0,17.299,0,23.761l-43.204,18.655 L212.795,336.887z M299.262,344.031c0.107,4.572,1.883,8.707,4.342,12.012c1.841,2.483,4.053,4.636,6.47,6.585l-25.191,36.208 l-21.006-39.53L299.262,344.031z M275.543,460.655l-6.528-77.653l15.12,28.447l31.308-45.022c1.044,0.667,2.089,1.324,3.182,1.949 c3.789,2.154,7.794,3.98,11.798,5.664L275.543,460.655z"/>
                    </svg>
                    <span>SOC</span>
                </button>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Red</div>
            <div class="tool-grid">
                <button class="tool-button" data-type="router" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 89.471 89.471" fill="#C11b05" xmlns="http:
                        <g>
                            <g>
                                <g>
                                    <path d="M87.682,52.477h-15.36l-1.174-26.841c0-0.741-0.601-1.342-1.342-1.342c-0.744,0-1.342,0.601-1.342,1.342L67.29,52.477h-65.5C0.805,52.477,0,53.286,0,54.266v14.315c0,0.981,0.805,1.789,1.789,1.789h5.368v2.684h10.737v-2.684h53.794v2.684h10.737v-2.684h5.257c0.984,0,1.789-0.809,1.789-1.789V54.266C89.471,53.286,88.666,52.477,87.682,52.477z M59.312,63.915c-1.381,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.374,0,2.491,1.117,2.491,2.494C61.807,62.802,60.687,63.915,59.312,63.915z M65.965,63.915c-1.385,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.378,0,2.487,1.117,2.487,2.494C68.453,62.802,67.34,63.915,65.965,63.915z M72.608,63.915c-1.374,0-2.494-1.117-2.494-2.491c0-1.381,1.12-2.494,2.494-2.494c1.378,0,2.491,1.117,2.491,2.494C75.099,62.802,73.986,63.915,72.608,63.915z M79.257,63.915c-1.381,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.371,0,2.491,1.117,2.491,2.494C81.752,62.802,80.628,63.915,79.257,63.915z"/>
                                </g>
                                <g>
                                    <path d="M61.939,33.258c-2.201-1.993-3.471-4.839-3.471-7.809s1.267-5.816,3.479-7.809l-1.109-1.224c-2.552,2.305-4.015,5.594-4.015,9.029c0,3.432,1.46,6.728,4.015,9.029L61.939,33.258z"/>
                                </g>
                                <g>
                                    <path d="M62.909,32.185l1.106-1.224c-1.557-1.41-2.448-3.414-2.448-5.511c0-2.094,0.891-4.105,2.448-5.511l-1.106-1.224c-1.904,1.714-2.992,4.173-2.992,6.735C59.917,28.012,61.005,30.463,62.909,32.185z"/>
                                </g>
                                <g>
                                    <path d="M65.117,29.733l1.109-1.224c-1.729-1.56-1.729-4.559,0-6.12l-1.109-1.224c-1.21,1.095-1.9,2.656-1.9,4.287C63.217,27.078,63.908,28.642,65.117,29.733z"/>
                                </g>
                                <g>
                                    <path d="M77.672,33.258l1.102,1.22c2.555-2.301,4.015-5.594,4.015-9.029s-1.46-6.725-4.015-9.029l-1.106,1.224c2.205,1.99,3.471,4.839,3.471,7.809C81.14,28.42,79.873,31.265,77.672,33.258z"/>
                                </g>
                                <g>
                                    <path d="M75.596,30.961l1.106,1.224c1.9-1.721,2.992-4.173,2.992-6.735s-1.092-5.018-2.992-6.735l-1.106,1.224c1.56,1.406,2.448,3.418,2.448,5.511C78.044,27.546,77.156,29.551,75.596,30.961z"/>
                                </g>
                                <g>
                                    <path d="M74.49,29.733c1.21-1.088,1.9-2.656,1.9-4.284c0-1.632-0.691-3.192-1.9-4.287l-1.109,1.224c1.732,1.56,1.732,4.559,0,6.12L74.49,29.733z"/>
                                </g>
                            </g>
                        </g>
                    </svg>
                    <span>Router</span>
                </button>
                <button class="tool-button" data-type="switch" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 36 36" fill="#C11b05" xmlns="http:
                        <path d="M33.91,18.47,30.78,8.41A2,2,0,0,0,28.87,7H7.13A2,2,0,0,0,5.22,8.41L2.09,18.48a2,2,0,0,0-.09.59V27a2,2,0,0,0,2,2H32a2,2,0,0,0,2-2V19.06A2,2,0,0,0,33.91,18.47ZM8.92,25H7.12V22h1.8Zm5,0h-1.8V22h1.8Zm5,0h-1.8V22h1.8Zm5,0H22.1V22h1.8Zm5,0H27.1V22h1.8ZM31,19.4H5V18H31Z"/>
                    </svg>
                    <span>Switch</span>
                </button>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Aplicaciones</div>
            <div class="tool-grid">
                <button class="tool-button" data-type="web" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M15.3222 10.383C15.3796 10.9457 15.4125 11.4903 15.4125 12C15.4125 12.9541 15.2972 14.0315 15.1208 15.1208C14.0315 15.2972 12.9541 15.4125 12 15.4125C11.0502 15.4125 9.97313 15.2975 8.87911 15.1205C8.70281 14.0312 8.5875 12.954 8.5875 12C8.5875 11.4905 8.62039 10.9458 8.67789 10.383C9.82608 10.5668 10.9715 10.6875 12 10.6875C13.0286 10.6875 14.174 10.5668 15.3222 10.383Z"/>
                        <path d="M16.8752 10.0994C16.9462 10.7579 16.9875 11.399 16.9875 12C16.9875 12.8769 16.8997 13.8389 16.7599 14.8153C18.7425 14.4016 20.575 13.8731 21.5567 13.5722C21.8739 13.475 21.9986 13.4363 22.1658 13.3694C22.2494 13.336 22.326 13.302 22.4259 13.2543C22.4748 12.843 22.5 12.4244 22.5 12C22.5 10.878 22.324 9.79714 21.9982 8.78346L21.9133 8.81017C20.8868 9.12245 18.9652 9.6745 16.8752 10.0994Z"/>
                        <path d="M21.4017 7.31948C20.3698 7.63221 18.579 8.14039 16.6599 8.53603C16.2178 5.84926 15.443 3.16951 15.0702 1.95598C17.8422 2.80227 20.1273 4.76467 21.4017 7.31948Z"/>
                        <path d="M15.1117 8.82229C14.0253 8.99781 12.9513 9.1125 12 9.1125C11.0487 9.1125 9.97477 8.99781 8.88843 8.8223C9.30471 6.28005 10.0478 3.68306 10.4278 2.44333C10.525 2.12606 10.5637 2.00144 10.6306 1.83418C10.664 1.75062 10.698 1.67398 10.7457 1.57414C11.157 1.52518 11.5756 1.5 12 1.5C12.4434 1.5 12.8803 1.52748 13.3093 1.58083C13.3184 1.61564 13.3268 1.64679 13.3351 1.67626C13.3597 1.76333 13.3982 1.8857 13.4628 2.09104L13.4696 2.11261C13.7935 3.14223 14.6519 6.01401 15.1117 8.82229Z"/>
                        <path d="M7.34004 8.536C7.7801 5.86107 8.54986 3.19576 8.92192 1.98181L8.92983 1.95597C6.15777 2.80225 3.8727 4.76465 2.59835 7.31946C3.63018 7.63219 5.42095 8.14036 7.34004 8.536Z"/>
                        <path d="M2.00184 8.78345C1.67598 9.79714 1.5 10.878 1.5 12C1.5 12.4389 1.52693 12.8715 1.57923 13.2963L1.74471 13.3515L1.74603 13.3519L1.74765 13.3525L1.74879 13.3528C1.80205 13.3705 3.36305 13.886 5.41878 14.3975C5.99886 14.5418 6.61307 14.6844 7.24006 14.8151C7.10025 13.8388 7.0125 12.8769 7.0125 12C7.0125 11.3988 7.05374 10.7577 7.12472 10.0994C5.03428 9.67436 3.11218 9.12212 2.08597 8.80989L2.07883 8.80771L2.00184 8.78345Z"/>
                        <path d="M12 16.9875C12.8769 16.9875 13.8389 16.8997 14.8153 16.7599C14.4016 18.7425 13.8731 20.575 13.5722 21.5566C13.475 21.8739 13.4363 21.9985 13.3694 22.1658C13.336 22.2494 13.302 22.326 13.2543 22.4259C12.843 22.4748 12.4244 22.5 12 22.5C11.5756 22.5 11.157 22.4748 10.7457 22.4259C10.698 22.326 10.664 22.2494 10.6306 22.1658C10.5637 21.9986 10.525 21.8739 10.4278 21.5567C10.1269 20.5751 9.59846 18.7427 9.18478 16.7603C10.1579 16.8996 11.1201 16.9875 12 16.9875Z"/>
                        <path d="M5.0385 15.9259C3.73853 15.6024 2.63135 15.2775 1.95597 15.0702C2.97258 18.4002 5.59982 21.0274 8.92983 22.044L8.92192 22.0182C8.59705 20.9582 7.96897 18.7917 7.52191 16.4784C6.6525 16.3103 5.80722 16.1171 5.0385 15.9259Z"/>
                        <path d="M22.0182 15.0781C20.9582 15.403 18.7915 16.0311 16.4781 16.4781C16.0311 18.7915 15.403 20.9581 15.0781 22.0182L15.0702 22.044C18.4002 21.0274 21.0274 18.4002 22.044 15.0702L22.0182 15.0781Z"/>
                        <path d="M1.6103 13.323C1.64665 13.3277 1.67628 13.3327 1.68611 13.3349C1.69472 13.337 1.70821 13.3406 1.7131 13.3419L1.72391 13.345L1.72973 13.3468L1.73585 13.3487L1.74098 13.3503C1.7381 13.3494 1.67976 13.3348 1.6103 13.323Z"/>
                    </svg>
                    <span>Aplicación Web</span>
                </button>
                <button class="tool-button" data-type="mobile" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3-3H7V4h10v14z"/>
                    </svg>
                    <span>Aplicación Móvil</span>
                </button>
                <button class="tool-button" data-type="api" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M21.3,19a2.42,2.42,0,0,1-2.5.56l-2.35,2.35a.34.34,0,0,1-.49,0l-1-1a.36.36,0,0,1,0-.49l2.36-2.35a2.39,2.39,0,0,1,3.39-2.91L19.12,16.8l1,1,1.62-1.62A2.39,2.39,0,0,1,21.3,19ZM22,8v5.76A4.47,4.47,0,0,0,19.5,13a4.57,4.57,0,0,0-1.29.19V9.29H16.66V14A4.5,4.5,0,0,0,15,17.5a4.07,4.07,0,0,0,0,.5H4a2,2,0,0,1-2-2V8A2,2,0,0,1,4,6H20A2,2,0,0,1,22,8ZM11,15,9.09,9.27H7L5.17,15h1.7l.29-1.07H9L9.29,15Zm4.77-3.89a1.67,1.67,0,0,0-.55-1.35,2.43,2.43,0,0,0-1.62-.47h-2V15h1.54V13.11h.44a2.75,2.75,0,0,0,1-.17,1.82,1.82,0,0,0,.67-.44,1.63,1.63,0,0,0,.36-.64A2.36,2.36,0,0,0,15.75,11.11Zm-7.3.62-.12-.44-.15-.58c0-.21-.08-.37-.11-.5a4.63,4.63,0,0,1-.1.48c0,.19-.08.38-.13.57s-.08.34-.12.47l-.24.93H8.69Zm5.59-1a.63.63,0,0,0-.5-.17h-.4v1.31h.31a.9.9,0,0,0,.37-.07.59.59,0,0,0,.27-.22.75.75,0,0,0,.11-.42A.57.57,0,0,0,14,10.71Z"/>
                    </svg>
                    <span>API</span>
                </button>
                <button class="tool-button" data-type="code" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 16 16" fill="#C11b05" xmlns="http:
                        <path d="M8.01005 0.858582L6.01005 14.8586L7.98995 15.1414L9.98995 1.14142L8.01005 0.858582Z"/>
                        <path d="M12.5 11.5L11.0858 10.0858L13.1716 8L11.0858 5.91422L12.5 4.5L16 8L12.5 11.5Z"/>
                        <path d="M2.82843 8L4.91421 10.0858L3.5 11.5L0 8L3.5 4.5L4.91421 5.91422L2.82843 8Z"/>
                    </svg>
                    <span>Análisis de Código</span>
                </button>
                <button class="tool-button" data-type="scada" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 512 512" fill="#C11b05" xmlns="http:
                        <path d="M475.115 163.781L336 252.309v-68.28c0-18.916-20.931-30.399-36.885-20.248L160 252.309V56c0-13.255-10.745-24-24-24H24C10.745 32 0 42.745 0 56v400c0 13.255 10.745 24 24 24h464c13.255 0 24-10.745 24-24V184.029c0-18.917-20.931-30.399-36.885-20.248z"/>
                    </svg>
                    <span>SCADA</span>
                </button>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Actores</div>
            <div class="tool-grid">
                <button class="tool-button" data-type="user" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M12 1C8.96243 1 6.5 3.46243 6.5 6.5C6.5 9.53757 8.96243 12 12 12C15.0376 12 17.5 9.53757 17.5 6.5C17.5 3.46243 15.0376 1 12 1Z"/><path d="M7 14C4.23858 14 2 16.2386 2 19V22C2 22.5523 2.44772 23 3 23H21C21.5523 23 22 22.5523 22 22V19C22 16.2386 19.7614 14 17 14H7Z"/>
                    </svg>
                    <span>Usuario</span>
                </button>
                <button class="tool-button" data-type="attacker" draggable="true">
                    <svg class="tool-icon" viewBox="42.395 31.517 401.313 483.014" fill="#C11b05" xmlns="http:
                        <path d="M0 0 C1.293 -0.004 1.293 -0.004 2.612 -0.009 C5.511 -0.018 8.411 -0.019 11.31 -0.021 C13.385 -0.025 15.459 -0.03 17.534 -0.036 C23.178 -0.049 28.823 -0.055 34.468 -0.06 C37.995 -0.063 41.522 -0.067 45.048 -0.071 C56.082 -0.085 67.116 -0.095 78.15 -0.098 C90.886 -0.103 103.623 -0.12 116.36 -0.149 C126.204 -0.171 136.048 -0.181 145.892 -0.182 C151.771 -0.184 157.651 -0.189 163.53 -0.207 C169.064 -0.224 174.597 -0.226 180.131 -0.217 C182.159 -0.216 184.187 -0.221 186.215 -0.231 C188.991 -0.243 191.766 -0.237 194.541 -0.227 C195.736 -0.239 195.736 -0.239 196.955 -0.251 C203.77 -0.192 210.449 1.179 215.964 5.39 C222.501 12.079 223.915 18.529 223.83 27.623 C223.497 34.183 222.382 40.626 221.316 47.097 C221.073 48.614 220.831 50.13 220.59 51.646 C219.958 55.612 219.315 59.576 218.669 63.539 C217.765 69.101 216.875 74.664 215.984 80.227 C215.512 83.178 215.035 86.127 214.555 89.076 C214.332 90.451 214.11 91.827 213.888 93.202 C213.781 93.863 213.675 94.524 213.565 95.206 C213.031 98.561 212.54 101.918 212.116 105.288 C212.03 105.962 211.945 106.636 211.858 107.33 C211.629 109.175 211.411 111.021 211.193 112.867 C210.278 118.398 208.684 124.108 204.651 128.14 C201.865 128.347 199.178 128.427 196.39 128.421 C195.525 128.427 194.66 128.433 193.77 128.439 C190.855 128.457 187.941 128.46 185.027 128.463 C182.944 128.472 180.862 128.482 178.78 128.493 C173.11 128.519 167.441 128.532 161.771 128.541 C158.233 128.547 154.694 128.555 151.155 128.564 C140.092 128.591 129.029 128.611 117.965 128.618 C105.177 128.627 92.39 128.662 79.602 128.72 C69.728 128.763 59.855 128.784 49.981 128.786 C44.079 128.788 38.177 128.8 32.275 128.836 C26.724 128.869 21.175 128.873 15.624 128.856 C13.585 128.854 11.545 128.863 9.505 128.883 C6.725 128.908 3.947 128.896 1.167 128.875 C-0.05 128.9 -0.05 128.9 -1.293 128.924 C-3.551 128.884 -3.551 128.884 -7.349 128.14 C-13.129 121.378 -13.915 113.339 -15.118 104.832 C-15.28 103.725 -15.441 102.618 -15.607 101.477 C-16.13 97.886 -16.646 94.295 -17.161 90.703 C-17.873 85.787 -18.588 80.872 -19.306 75.957 C-19.569 74.15 -19.569 74.15 -19.837 72.307 C-20.823 65.583 -21.854 58.869 -22.985 52.168 C-23.105 51.456 -23.225 50.743 -23.348 50.009 C-23.875 46.888 -24.415 43.77 -24.977 40.654 C-28.75 18.634 -28.75 18.634 -22.27 9.269 C-15.853 2.161 -9.339 -0.01 0 0 Z" transform="translate(144.34854125976563,289.85955810546875)"/>
                        <path d="M0 0 C1.899 -0.009 1.899 -0.009 3.836 -0.018 C5.239 -0.014 6.641 -0.01 8.044 -0.006 C9.536 -0.009 11.028 -0.013 12.519 -0.018 C16.62 -0.028 20.721 -0.026 24.821 -0.022 C29.243 -0.019 33.665 -0.028 38.087 -0.036 C46.752 -0.048 55.416 -0.05 64.08 -0.048 C71.122 -0.046 78.164 -0.048 85.206 -0.052 C86.709 -0.053 86.709 -0.053 88.242 -0.054 C90.277 -0.055 92.312 -0.056 94.346 -0.058 C113.438 -0.068 132.529 -0.066 151.62 -0.06 C169.087 -0.055 186.554 -0.066 204.021 -0.085 C221.952 -0.105 239.883 -0.113 257.814 -0.109 C267.883 -0.107 277.951 -0.11 288.02 -0.124 C296.592 -0.136 305.164 -0.137 313.737 -0.125 C318.11 -0.119 322.484 -0.118 326.857 -0.13 C330.863 -0.141 334.868 -0.138 338.873 -0.124 C340.32 -0.121 341.768 -0.124 343.215 -0.132 C354.069 -0.187 361.848 0.638 369.988 8.313 C374.995 13.819 376.462 19.111 376.125 26.52 C375.023 34.64 371.23 39.323 365.168 44.626 C360.477 47.79 355.945 48.505 350.369 48.512 C349.097 48.518 347.826 48.525 346.516 48.531 C345.112 48.528 343.709 48.525 342.305 48.522 C340.808 48.526 339.311 48.53 337.815 48.536 C333.705 48.548 329.595 48.548 325.485 48.545 C321.052 48.545 316.618 48.556 312.185 48.565 C303.5 48.582 294.815 48.587 286.13 48.589 C279.071 48.59 272.013 48.594 264.954 48.6 C244.942 48.618 224.931 48.627 204.919 48.625 C203.301 48.625 203.301 48.625 201.65 48.625 C200.57 48.625 199.49 48.625 198.377 48.625 C180.868 48.624 163.359 48.643 145.851 48.671 C127.874 48.7 109.898 48.714 91.921 48.712 C81.828 48.712 71.735 48.717 61.642 48.739 C53.05 48.757 44.457 48.761 35.865 48.748 C31.481 48.741 27.098 48.741 22.714 48.758 C18.699 48.774 14.685 48.771 10.671 48.754 C9.22 48.751 7.769 48.754 6.318 48.765 C-2.997 48.832 -9.474 48.421 -16.707 42.106 C-22.652 35.19 -24.783 30.181 -24.547 20.993 C-23.692 13.208 -19.278 8.908 -13.563 3.919 C-9.14 0.741 -5.399 0.004 0 0 Z" transform="translate(67.24638080596924,433.7455244064331)"/>
                        <path d="M0 0 C13.379 7.993 21.457 20.164 30.299 32.609 C32.995 36.398 35.715 40.168 38.438 43.938 C38.971 44.677 39.504 45.416 40.053 46.177 C44.003 51.643 47.994 57.077 52 62.5 C58.185 70.872 64.293 79.296 70.374 87.744 C72.041 90.056 73.713 92.365 75.387 94.672 C78.108 98.424 80.821 102.182 83.525 105.947 C84.474 107.268 85.424 108.587 86.377 109.904 C93.435 119.683 100 129.515 100 142 C96.627 140.718 93.53 139.258 90.402 137.461 C72.923 127.573 55.39 120.191 36 115 C34.471 114.573 34.471 114.573 32.91 114.137 C26.953 112.543 20.95 111.403 14.875 110.375 C14.147 110.252 13.419 110.128 12.668 110.001 C4.026 108.599 -4.566 107.846 -13.32 107.797 C-14.6 107.786 -14.6 107.786 -15.906 107.775 C-61.828 107.482 -106.46 114.969 -145.629 140.566 C-148 142 -148 142 -150 142 C-148.672 124.41 -137.821 111.602 -127.684 97.969 C-124.229 93.32 -120.823 88.637 -117.438 83.938 C-116.905 83.199 -116.372 82.46 -115.823 81.699 C-114.215 79.466 -112.607 77.233 -111 75 C-103.804 65.001 -96.57 55.034 -89.246 45.128 C-85.716 40.347 -82.218 35.545 -78.749 30.72 C-76.62 27.759 -74.483 24.804 -72.342 21.852 C-71.209 20.288 -70.079 18.722 -68.949 17.156 C-61.91 7.706 -53.86 1.602 -43 -3 C-41.675 -3.563 -41.675 -3.563 -40.324 -4.137 C-27.437 -7.483 -11.734 -6.278 0 0 Z" transform="translate(268,39)"/>
                        <path d="M0 0 C-3.902 21.557 -13.348 39.735 -29 55 C-29.7 55.697 -30.4 56.395 -31.121 57.113 C-45.492 70.588 -63.554 75.742 -82.801 75.238 C-99.08 74.492 -114.115 66.926 -126 56 C-126.755 55.325 -127.511 54.649 -128.289 53.953 C-143.298 39.821 -151.082 21.651 -156 2 C-156 1.34 -156 0.68 -156 0 C-143.593 -4.606 -130.961 -7.419 -118 -10 C-116.229 -10.358 -116.229 -10.358 -114.422 -10.723 C-75.973 -17.814 -36.749 -11.665 0 0 Z" transform="translate(321,175)"/>
                        <path d="M0 0 C9.83 0.159 18.671 5.929 25.688 12.375 C26.291 12.924 26.894 13.473 27.516 14.039 C31.395 18.006 33.928 22.487 36.359 27.434 C36.704 28.129 37.049 28.825 37.404 29.542 C41.664 38.24 45.516 47.118 49.375 56 C50.16 57.799 50.945 59.597 51.73 61.396 C53.304 65.001 54.875 68.607 56.443 72.214 C58.2 76.256 59.962 80.296 61.728 84.334 C62.937 87.102 64.144 89.871 65.35 92.64 C65.902 93.908 66.455 95.176 67.009 96.443 C67.769 98.184 68.525 99.926 69.281 101.668 C69.701 102.632 70.12 103.597 70.553 104.591 C75.131 115.825 75.014 126.958 71.016 138.434 C65.295 151.103 54.116 157.567 42.438 164.062 C39.924 165.47 37.413 166.882 34.902 168.293 C34.283 168.64 33.664 168.987 33.025 169.345 C29.285 171.447 25.598 173.617 21.941 175.863 C20.672 176.634 20.672 176.634 19.378 177.421 C17.847 178.357 16.324 179.308 14.813 180.276 C9.551 183.459 5.823 183.809 -0.312 183.375 C-0.03 182.224 0.252 181.073 0.543 179.887 C1.967 173.468 2.799 166.962 3.69 160.453 C5.38 148.122 7.22 135.831 9.312 123.562 C16.887 90.276 16.887 90.276 9.688 58.375 C2.998 49.319 -5.132 42.672 -16.312 40.375 C-21.311 39.86 -26.29 39.567 -31.312 39.375 C-28.49 34.198 -25.337 29.548 -21.75 24.875 C-20.689 23.478 -19.629 22.081 -18.57 20.684 C-18.033 19.976 -17.496 19.268 -16.942 18.539 C-13.816 14.388 -10.761 10.185 -7.703 5.984 C-3.636 0.412 -3.636 0.412 0 0 Z" transform="translate(368.3125,234.625)"/>
                        <path d="M0 0 C3.251 2.899 5.548 6.421 8 10 C8.788 11.099 9.58 12.195 10.375 13.289 C12.062 15.618 13.733 17.958 15.391 20.309 C17.199 22.874 19.023 25.427 20.859 27.973 C21.554 28.937 21.554 28.937 22.262 29.921 C23.157 31.164 24.054 32.405 24.953 33.646 C28 37.888 28 37.888 28 39 C27.068 39.014 26.136 39.028 25.176 39.043 C12.241 39.527 1.721 42.204 -7.84 51.531 C-14.647 59.311 -18.389 67.429 -18.262 77.832 C-18.256 78.574 -18.251 79.315 -18.245 80.08 C-18.105 88.051 -17.037 95.822 -15.812 103.688 C-15.585 105.211 -15.357 106.735 -15.131 108.26 C-13.3 120.478 -11.272 132.664 -9.199 144.844 C-7.79 153.163 -6.513 161.501 -5.256 169.844 C-5.104 170.846 -4.953 171.847 -4.797 172.879 C-4.666 173.751 -4.536 174.623 -4.401 175.522 C-3.995 178.029 -3.514 180.513 -3 183 C-12.037 184.116 -17.772 180.327 -25.312 175.75 C-26.554 175.015 -27.795 174.281 -29.038 173.549 C-31.528 172.078 -34.012 170.595 -36.489 169.104 C-39.627 167.217 -42.789 165.375 -45.961 163.547 C-59.62 155.628 -70.281 148.773 -75.812 133.375 C-78.605 122.666 -77.776 113.837 -73.539 103.816 C-73.183 102.952 -72.828 102.089 -72.461 101.198 C-68.369 91.332 -64.04 81.567 -59.688 71.812 C-58.008 68.04 -56.33 64.266 -54.652 60.492 C-54.246 59.58 -53.84 58.667 -53.421 57.727 C-51.099 52.503 -48.81 47.266 -46.566 42.008 C-46.079 40.872 -45.591 39.737 -45.089 38.567 C-44.237 36.576 -43.394 34.582 -42.561 32.583 C-36.587 18.69 -27.508 7.743 -13.348 1.875 C-4.627 -1.375 -4.627 -1.375 0 0 Z" transform="translate(121,235)"/>
                    </svg>
                    <span>Pentester</span>
                </button>
                <button class="tool-button" data-type="hacker" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 512 512" fill="#C11b05" xmlns="http:
                        <path d="M378.625,209.465c-6.531-38.344-13.672-80-15.844-91.844c-5.313-28.906-43.375-45.063-71.656-24.234 c-14.828,10.938-28.094,11.719-35.125,11.719s-14.828,1.563-35.125-11.719c-29.391-19.219-66.344-4.672-71.656,24.234 c-2.172,11.844-9.313,53.5-15.844,91.844C53.906,219.418,0,238.778,0,261.012c0,32.438,114.625,58.719,256,58.719 c141.391,0,256-26.281,256-58.719C512,238.778,458.094,219.418,378.625,209.465z"/>
                        <path d="M109.125,330.45l7.547,86.515c39.563,6.719,79.734,10.219,119.703,11.078L256,401.278l19.625,26.765 c39.969-0.859,80.141-4.359,119.703-11.078l7.547-86.515c-48.375,9.359-97.906,13.5-146.875,13.5 C207.016,343.95,157.516,339.809,109.125,330.45z M186.688,401.997c-33.469-1.578-35.563-41.766-35.563-41.766l75.125,14.672 C226.25,374.903,220.156,403.59,186.688,401.997z M360.875,360.231c0,0-2.094,40.188-35.563,41.766 c-33.469,1.594-39.563-27.094-39.563-27.094L360.875,360.231z"/>
                    </svg>
                    <span>Atacante</span>
                </button>
                <button class="tool-button" data-type="clients" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 1024 1024" fill="#C11b05" xmlns="http:
                        <path d="M512 505.6c-108.8 0-204.8-89.6-204.8-204.8S396.8 102.4 512 102.4c108.8 0 204.8 89.6 204.8 204.8S620.8 505.6 512 505.6z m0-358.4c-83.2 0-153.6 70.4-153.6 153.6s64 153.6 153.6 153.6 153.6-70.4 153.6-153.6S595.2 147.2 512 147.2z"/>
                        <path d="M832 864c0-211.2-147.2-377.6-326.4-377.6s-326.4 166.4-326.4 377.6H832z"/>
                        <path d="M832 889.6H147.2v-25.6c0-224 160-403.2 352-403.2s352 179.2 352 396.8v25.6l-19.2 6.4z m-633.6-51.2h608C800 659.2 665.6 512 505.6 512c-166.4 0-294.4 147.2-307.2 326.4zM710.4 499.2c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6c64 0 121.6-51.2 121.6-121.6 0-51.2-32-96-83.2-115.2-12.8-6.4-19.2-19.2-12.8-32 6.4-12.8 19.2-19.2 32-12.8 70.4 19.2 115.2 83.2 115.2 160-6.4 96-83.2 172.8-172.8 172.8z"/>
                        <path d="M966.4 806.4h-57.6c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h32c-12.8-140.8-115.2-249.6-236.8-249.6-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6c160 0 288 147.2 288 326.4v25.6h-25.6z"/>
                        <path d="M300.8 499.2c-6.4 0-6.4 0 0 0-44.8 0-89.6-12.8-121.6-44.8-32-32-44.8-76.8-44.8-121.6 0-70.4 44.8-134.4 115.2-160 12.8-6.4 25.6 0 32 12.8 6.4 12.8 0 25.6-12.8 32-57.6 19.2-89.6 64-89.6 115.2 0 32 12.8 64 32 83.2 19.2 25.6 51.2 32 83.2 38.4 19.2 0 25.6 12.8 25.6 25.6s-6.4 19.2-19.2 19.2z"/>
                        <path d="M89.6 806.4H12.8v-25.6c0-179.2 128-320 288-320 12.8 0 25.6 12.8 25.6 25.6s-12.8 25.6-25.6 25.6C179.2 512 76.8 620.8 64 761.6h32c12.8 0 25.6 12.8 25.6 25.6-6.4 6.4-12.8 19.2-32 19.2z"/>
                    </svg>
                    <span>Clientes</span>
                </button>
                <button class="tool-button" data-type="pentester" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.71429 23C6.07616 23 5 21.5067 5 20V4C5 2.49332 6.07616 1 7.71429 1H16.2857C17.9238 1 19 2.49332 19 4V20C19 21.5067 17.9238 23 16.2857 23H7.71429ZM12 21C12.8284 21 13.5 20.3284 13.5 19.5C13.5 18.6716 12.8284 18 12 18C11.1716 18 10.5 18.6716 10.5 19.5C10.5 20.3284 11.1716 21 12 21Z" fill="#C11B05"/>
                    </svg>
                    <span>Pentester</span>
                </button>
            </div>
        </div>
        <!-- Custom images section will be generated dynamically -->
        <div class="sidebar-section">
            <div class="sidebar-title">Herramientas</div>
            <div class="tool-grid">
                <button class="tool-button" data-action="connect">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M16.4481 1.50023C14.844 1.4862 13.3007 2.10727 12.15 3.22645L12.1351 3.24107L11.6464 3.7298C11.2559 4.12032 11.2559 4.75349 11.6464 5.14401L12.3535 5.85112C12.7441 6.24164 13.3772 6.24164 13.7677 5.85112L14.2484 5.37048C14.834 4.80437 15.6142 4.49305 16.4218 4.50012C17.2326 4.50721 18.0103 4.83463 18.5868 5.41517C19.1637 5.99606 19.4927 6.78402 19.4998 7.60991C19.5069 8.43176 19.1946 9.22174 18.633 9.81182L15.5209 12.9432C15.2056 13.2609 14.8269 13.5058 14.4107 13.6622C13.9945 13.8185 13.5501 13.8828 13.1076 13.8509C12.6651 13.8189 12.2341 13.6915 11.8438 13.4768C11.7456 13.4228 11.6504 13.3635 11.5588 13.2993C11.1066 12.9823 10.4859 12.8717 10.0425 13.201L9.23978 13.7973C8.79642 14.1266 8.69902 14.7603 9.09601 15.1443C9.48444 15.52 9.9219 15.8435 10.3977 16.1053C11.1664 16.5282 12.0171 16.78 12.8918 16.8431C13.7666 16.9062 14.6444 16.779 15.4656 16.4706C16.2868 16.1621 17.0317 15.6797 17.65 15.0568L20.7712 11.9162L20.7898 11.8971C21.9007 10.7389 22.5136 9.18987 22.4997 7.58402C22.4859 5.97817 21.8463 4.43996 20.7155 3.30127C19.5844 2.16225 18.0521 1.51427 16.4481 1.50023Z"/><path d="M11.1082 7.15685C10.2334 7.09376 9.35555 7.22089 8.53436 7.52937C7.71347 7.83773 6.96821 8.32053 6.34994 8.94317L3.22873 12.0838L3.21011 12.1029C2.09928 13.261 1.48637 14.8101 1.50023 16.416C1.51409 18.0218 2.15365 19.56 3.28441 20.6987C4.41551 21.8377 5.94781 22.4857 7.55185 22.4997C9.15591 22.5138 10.6993 21.8927 11.85 20.7735L11.8648 20.7589L12.3536 20.2701C12.7441 19.8796 12.7441 19.2465 12.3536 18.8559L11.6464 18.1488C11.2559 17.7583 10.6228 17.7583 10.2322 18.1488L9.75155 18.6295C9.16598 19.1956 8.38576 19.5069 7.5781 19.4999C6.76732 19.4928 5.98963 19.1653 5.41313 18.5848C4.83629 18.0039 4.50725 17.216 4.50012 16.3901C4.49303 15.5682 4.80532 14.7782 5.36694 14.1881L8.47904 11.0567C8.79434 10.7391 9.1731 10.4941 9.58932 10.3378C10.0055 10.1814 10.4498 10.1172 10.8924 10.1491C11.3349 10.181 11.7659 10.3084 12.1561 10.5231C12.2544 10.5772 12.3495 10.6365 12.4411 10.7007C12.8934 11.0177 13.5141 11.1282 13.9574 10.7989L14.7602 10.2026C15.2036 9.87328 15.301 9.23958 14.904 8.85563C14.5155 8.47995 14.0781 8.15644 13.6022 7.89464C12.8335 7.47172 11.9829 7.21993 11.1082 7.15685Z"/>
                    </svg>
                    <span>Conectar</span>
                </button>
                <button class="tool-button" data-action="pan">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="none" xmlns="http:
                        <path d="M12 3V9M12 3L9 6M12 3L15 6M12 15V21M12 21L15 18M12 21L9 18M3 12H9M3 12L6 15M3 12L6 9M15 12H21M21 12L18 9M21 12L18 15" stroke="#C11b05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Mover Vista</span>
                </button>
                <button class="tool-button" data-action="delete">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                    <span>Eliminar</span>
                </button>
                <button class="tool-button" data-type="upload" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 16V4M12 4L8 8M12 4L16 8" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 18V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V18" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Subir</span>
                </button>
                <button class="tool-button" data-type="enlace" draggable="true">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H16M8 12C8 10.8954 8.89543 10 10 10H14C15.1046 10 16 10.8954 16 12C16 13.1046 15.1046 14 14 14H10C8.89543 14 8 13.1046 8 12Z" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z" stroke="#C11B05" stroke-width="2"/>
                    </svg>
                    <span>Enlace</span>
                </button>
                <button class="tool-button" data-action="deleteAll">
                    <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http:
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        <circle cx="18" cy="6" r="4" fill="#ff4444"/>
                        <path d="M16 4h4M18 2v4" stroke="white" stroke-width="1"/>
                    </svg>
                    <span>Eliminar Todo</span>
                </button>
            </div>
        </div>
    </div>
    <div id="canvas-container">
        <canvas id="main-canvas"></canvas>
    </div>
    <div class="floating-controls">
        <div class="control-group">
            <button class="control-button" id="zoomIn" title="Acercar">+</button>
            <button class="control-button" id="zoomOut" title="Alejar">−</button>
            <button class="control-button" id="zoomFit" title="Ajustar">⊡</button>
        </div>
        <div class="control-group">
            <button class="control-button active" id="gridToggle" title="Grid">⋮⋮</button>
            <button class="control-button active" id="snapToggle" title="Snap">⊞</button>
            <button class="control-button" id="forceToggle" title="Force-Directed Layout">⊛</button>
        </div>
    </div>
    <div class="action-bar">
        <button class="action-button" id="saveBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
            </svg>
            Guardar
        </button>
        <button class="action-button" id="loadBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
            </svg>
            Cargar
        </button>
        <button class="action-button primary" id="exportBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
            </svg>
            Exportar PNG
        </button>
    </div>
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <h2 class="modal-title">Editar Elemento</h2>
            <div class="form-group">
                <label class="form-label">Nombre</label>
                <input type="text" class="form-input" id="nodeName" placeholder="Nombre personalizado">
            </div>
            <div class="form-group">
                <label class="form-label">Direcciones IP <span style="font-size: 11px; color: #666;">(una por línea)</span></label>
                <textarea class="form-input" id="nodeIP" placeholder="192.168.1.1&#10;10.0.0.1&#10;172.16.0.1" rows="3" style="resize: vertical; min-height: 60px;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Dominio</label>
                <input type="text" class="form-input" id="nodeDomain" placeholder="ejemplo.com">
            </div>
            <div class="form-group">
                <label class="form-label">Puerto</label>
                <input type="text" class="form-input" id="nodePort" placeholder="80, 443">
            </div>
            <div class="form-group">
                <label class="form-label">Notas</label>
                <textarea class="form-input" id="nodeNotes" rows="3" placeholder="Notas adicionales..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelEdit">Cancelar</button>
                <button class="btn btn-primary" id="saveEdit">Guardar</button>
            </div>
        </div>
    </div>
    <!-- Minimap -->
    <div class="minimap-container" id="minimapContainer">
        <div class="minimap-header">
            <span>Vista General</span>
            <button class="minimap-toggle" id="minimapToggle">−</button>
        </div>
        <canvas id="minimapCanvas" class="minimap-canvas"></canvas>
    </div>
    <div class="tooltip" id="tooltip"></div>
    <div class="toast-container" id="toastContainer"></div>
    <div class="status-indicator" id="statusIndicator">
        <div class="status-dot"></div>
        <span>Auto-guardado activo</span>
    </div>
    <!-- Mobile Floating Action Button (FAB) -->
    <div class="fab-container" id="fabContainer" role="navigation" aria-label="Menú de acciones">
        <div class="fab-backdrop" id="fabBackdrop" aria-hidden="true"></div>
        <div class="fab-menu" id="fabMenu" role="menu" aria-expanded="false">
            <!-- Opciones de archivo -->
            <div class="fab-option">
                <div class="fab-label">Guardar</div>
                <button class="fab-button" id="fabSave" data-action="save" role="menuitem" aria-label="Guardar diagrama">
                    💾
                </button>
            </div>
            <div class="fab-option">
                <div class="fab-label">Cargar</div>
                <button class="fab-button" id="fabLoad" data-action="load" role="menuitem" aria-label="Cargar diagrama">
                    📁
                </button>
            </div>
            <div class="fab-option">
                <div class="fab-label">Exportar PNG</div>
                <button class="fab-button" id="fabExport" data-action="export" role="menuitem" aria-label="Exportar como PNG">
                    📷
                </button>
            </div>
            <!-- Separador visual -->
            <div style="height: 1px; background: rgba(255,255,255,0.2); margin: 8px 0;"></div>
            <!-- Opciones de edición -->
            <div class="fab-option">
                <div class="fab-label">Agregar Nodo</div>
                <button class="fab-button" id="fabAddNode" data-action="add-node" role="menuitem" aria-label="Agregar nodo">
                    ➕
                </button>
            </div>
            <div class="fab-option">
                <div class="fab-label">Conectar</div>
                <button class="fab-button" id="fabConnect" data-action="connect" role="menuitem" aria-label="Conectar nodos">
                    🔗
                </button>
            </div>
            <div class="fab-option">
                <div class="fab-label">Eliminar</div>
                <button class="fab-button" id="fabDelete" data-action="delete" role="menuitem" aria-label="Eliminar elemento">
                    🗑️
                </button>
            </div>
            <div class="fab-option">
                <div class="fab-label">Vista Completa</div>
                <button class="fab-button" id="fabFitView" data-action="fit-view" role="menuitem" aria-label="Ajustar vista">
                    🔍
                </button>
            </div>
        </div>
        <button class="fab-main" id="fabMain" aria-label="Abrir menú de acciones" aria-expanded="false">
            <span class="fab-icon">➕</span>
        </button>
    </div>
    <!-- Input oculto para cargar archivos -->
    <input type="file" id="fileInput" accept=".json,.svg" style="display: none;" aria-hidden="true">
    <!-- Mobile Context Menu -->
    <div class="mobile-context-menu" id="mobileContextMenu">
        <!-- Menu items will be dynamically populated -->
    </div>
    <div class="help-overlay" id="helpOverlay">
        <div class="help-content">
            <button class="help-close" id="helpClose">×</button>
            <div class="help-header">
                <h2>🛠️ DragonJAR Scope Designer</h2>
                <p>Herramienta profesional para diseño de diagramas de pentesting</p>
                <div class="help-search">
                    <input type="text" id="helpSearch" placeholder="🔍 Buscar en la ayuda..." />
                </div>
            </div>
            <div class="unified-help-content">
                <section class="help-section">
                    <h3>📖 Primeros Pasos</h3>
                    <div class="getting-started-content">
                        <p class="intro-text">Sigue estos pasos para crear tu primer diagrama profesional de pentesting:</p>
                    </div>
                    <ol class="usage-steps">
                        <li><strong>Agregar elementos:</strong> Arrastra iconos desde la barra lateral izquierda al canvas o haz clic en el canvas después de seleccionar un elemento</li>
                        <li><strong>Conectar elementos:</strong> Activa el modo "Conectar" y haz clic en dos elementos, o arrastra desde los puntos de conexión visibles</li>
                        <li><strong>Editar propiedades:</strong> Doble clic en cualquier elemento para agregar nombre, IP, dominio, puerto y notas</li>
                        <li><strong>Selección múltiple:</strong> Mantén Ctrl y haz clic en varios elementos para operaciones grupales</li>
                        <li><strong>Navegación fluida:</strong> Usa la rueda del mouse para zoom, clic medio para arrastrar la vista, o el minimapa</li>
                        <li><strong>Exportar resultado:</strong> Usa el botón "Exportar PNG" para guardar tu diagrama como imagen</li>
                    </ol>
                </section>
                <section class="help-section">
                    <h3>🎯 Funcionalidades Principales</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <h4>📦 Elementos de Infraestructura</h4>
                            <p>Servidores, clientes, bases de datos, máquinas virtuales, firewalls, proxies y más</p>
                        </div>
                        <div class="feature-item">
                            <h4>🔗 Conexiones Inteligentes</h4>
                            <p>Conecta elementos fácilmente usando el modo "Conectar" o arrastrando desde puntos de conexión</p>
                        </div>
                        <div class="feature-item">
                            <h4>🖼️ Imágenes Personalizadas</h4>
                            <p>Sube tus propias imágenes SVG/PNG con transparencia para elementos únicos</p>
                        </div>
                        <div class="feature-item">
                            <h4>💾 Auto-guardado</h4>
                            <p>Tus diagramas se guardan automáticamente cada 30 segundos en tu navegador</p>
                        </div>
                        <div class="feature-item">
                            <h4>🗺️ Minimapa</h4>
                            <p>Navega por diagramas grandes usando el minimapa interactivo</p>
                        </div>
                        <div class="feature-item">
                            <h4>📋 Copiar & Pegar</h4>
                            <p>Duplica elementos y conexiones rápidamente con Ctrl+C y Ctrl+V</p>
                        </div>
                    </div>
                </section>
                <section class="help-section">
                    <h3>⌨️ Atajos de Teclado</h3>
                    <div class="shortcut-categories">
                        <div class="shortcut-category">
                            <h4>✏️ Edición</h4>
                            <div class="shortcut-grid">
                                <span class="shortcut-key">Ctrl + Z</span><span>Deshacer última acción</span>
                                <span class="shortcut-key">Ctrl + Y</span><span>Rehacer acción</span>
                                <span class="shortcut-key">Ctrl + C</span><span>Copiar elementos seleccionados</span>
                                <span class="shortcut-key">Ctrl + V</span><span>Pegar elementos copiados</span>
                                <span class="shortcut-key">Delete</span><span>Eliminar elementos seleccionados</span>
                            </div>
                        </div>
                        <div class="shortcut-category">
                            <h4>🧭 Navegación</h4>
                            <div class="shortcut-grid">
                                <span class="shortcut-key">Rueda mouse</span><span>Zoom in/out en el canvas</span>
                                <span class="shortcut-key">Clic medio</span><span>Arrastrar para mover vista</span>
                                <span class="shortcut-key">Escape</span><span>Cancelar modo actual</span>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="help-section">
                    <h3>💡 Consejos Pro</h3>
                    <div class="pro-tips-container">
                        <div class="pro-tip-item">
                            <div class="tip-icon">📌</div>
                            <div class="tip-content">
                                <h4>Alineación Perfecta</h4>
                                <p>Usa la cuadrícula y snap para alineación perfecta de elementos</p>
                            </div>
                        </div>
                        <div class="pro-tip-item">
                            <div class="tip-icon">🔍</div>
                            <div class="tip-content">
                                <h4>Búsqueda Rápida</h4>
                                <p>Usa el buscador en la barra lateral para encontrar elementos rápidamente</p>
                            </div>
                        </div>
                        <div class="pro-tip-item">
                            <div class="tip-icon">📱</div>
                            <div class="tip-content">
                                <h4>Compatibilidad Móvil</h4>
                                <p>La aplicación funciona completamente en móvil con controles táctiles optimizados</p>
                            </div>
                        </div>
                        <div class="pro-tip-item">
                            <div class="tip-icon">🎨</div>
                            <div class="tip-content">
                                <h4>Personalización Avanzada</h4>
                                <p>Personaliza tu diagrama subiendo iconos propios en formato SVG para mejor calidad</p>
                            </div>
                        </div>
                        <div class="pro-tip-item">
                            <div class="tip-icon">💾</div>
                            <div class="tip-content">
                                <h4>Respaldo Completo</h4>
                                <p>Exporta e importa tus diagramas en formato JSON para respaldo completo</p>
                            </div>
                        </div>
                    </div>
                </section>
                <div class="no-results" id="no-results" style="display: none;">
                    <div class="no-results-content">
                        <div class="no-results-icon">🔍</div>
                        <h3>No se encontraron resultados</h3>
                        <p>Intenta con diferentes términos de búsqueda</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const ICONS = {
            server: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4.75C1 3.10996 2.47275 2 4 2H20C21.5273 2 23 3.10996 23 4.75V8.25C23 9.89004 21.5273 11 20 11H4C2.47275 11 1 9.89004 1 8.25V4.75ZM7 6.5C7 7.32843 6.32843 8 5.5 8C4.67157 8 4 7.32843 4 6.5C4 5.67157 4.67157 5 5.5 5C6.32843 5 7 5.67157 7 6.5Z" fill="#C11B05"/><path fill-rule="evenodd" clip-rule="evenodd" d="M1 15.75C1 14.11 2.47275 13 4 13H20C21.5273 13 23 14.11 23 15.75V19.25C23 20.89 21.5273 22 20 22H4C2.47275 22 1 20.89 1 19.25V15.75ZM7 17.5C7 18.3284 6.32843 19 5.5 19C4.67157 19 4 18.3284 4 17.5C4 16.6716 4.67157 16 5.5 16C6.32843 16 7 16.6716 7 17.5Z" fill="#C11B05"/></svg>`),
            client: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5C2.17363 1.5 0.5 2.9003 0.5 4.85714V14.1429C0.5 16.0997 2.17363 17.5 4 17.5H10.5V19.5H7.5C6.94772 19.5 6.5 19.9477 6.5 20.5V21.5C6.5 22.0523 6.94771 22.5 7.5 22.5H16.5C17.0523 22.5 17.5 22.0523 17.5 21.5V20.5C17.5 19.9477 17.0523 19.5 16.5 19.5H13.5V17.5H20C21.8264 17.5 23.5 16.0997 23.5 14.1429V4.85714C23.5 2.9003 21.8264 1.5 20 1.5H4Z" fill="#C11b05"/></svg>`),
            mobile: 'data:image/svg+xml;base64,' + btoa(`<svg fill="#C11b05" height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 470.586 470.586" xml:space="preserve"><g><path d="M327.081,0H143.505c-34.875,0-63.24,28.365-63.24,63.24v344.105c0,34.875,28.365,63.24,63.24,63.24h183.576c34.875,0,63.24-28.365,63.24-63.24V63.24C390.321,28.365,361.956,0,327.081,0z M235.293,438.831c-17.076,0-30.911-13.835-30.911-30.911c0-17.076,13.835-30.911,30.911-30.911c17.076,0,30.911,13.835,30.911,30.911C266.204,424.996,252.369,438.831,235.293,438.831z M338.961,351.975H131.625V70.7h207.336V351.975z"/></g></svg>`),
            cloud: 'data:image/svg+xml;base64,' + btoa(`<svg fill="#C11b05" height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 441.902 441.902" xml:space="preserve"><path d="M329.375,293.848c58.766,0,106.576-47.811,106.576-106.58c0-58.766-47.811-106.576-106.576-106.576c-4.114,0-8.213,0.234-12.277,0.703c-4.898-20.225-15.654-38.646-31.178-53.025C266.168,10.076,240.456,0,213.52,0c-49.559,0-91.801,33.842-103.422,80.719C52.446,82.012,5.951,129.313,5.951,187.268c0,58.77,47.81,106.58,106.577,106.58h53.923v41.565h-61.883c-5.294-9.533-15.462-16-27.117-16c-17.093,0-31,13.906-31,31c0,17.094,13.907,31,31,31c11.655,0,21.823-6.469,27.117-16h76.883c8.284,0,15-6.717,15-15v-56.565h9.5v89.938c-9.532,5.293-16,15.463-16,27.117c0,17.094,13.907,31,31,31c17.093,0,31-13.906,31-31c0-11.654-6.468-21.824-16-27.117v-89.938h9.5v57.994c0,8.285,6.716,15,15,15h77.73c5.488,8.742,15.208,14.57,26.27,14.57c17.093,0,31-13.906,31-31c0-17.094-13.907-31-31-31c-12.229,0-22.825,7.119-27.866,17.43h-61.134v-42.994H329.375z"/></svg>`),
            waf: 'data:image/svg+xml;base64,' + btoa(`<svg fill="#C11b05" height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 430 430" xml:space="preserve"><g><path d="M323.423,111.047c-4.114,0-8.213,0.234-12.277,0.703c-4.898-20.225-15.654-38.646-31.177-53.025c-19.752-18.294-45.464-28.369-72.401-28.369c-49.559,0-91.801,33.842-103.422,80.719C46.495,112.367,0,159.668,0,217.623c0,58.77,47.81,106.58,106.577,106.58h19.91c5.509,8.814,11.634,17.236,18.354,25.219c26.339,31.287,52.815,45.273,55.731,46.757c4.446,2.268,9.436,3.466,14.428,3.466c4.964,0,9.928-1.185,14.339-3.42c2.935-1.483,29.436-15.397,55.808-46.682c6.757-8.016,12.914-16.479,18.447-25.34h19.829c58.767,0,106.577-47.81,106.577-106.58C430,158.857,382.19,111.047,323.423,111.047z M303.335,280.381c-8.076,20.565-19.341,39.498-33.48,56.272c-24.194,28.701-48.514,41.204-49.538,41.722c-1.671,0.847-3.494,1.27-5.317,1.27c-1.833,0-3.666-0.428-5.343-1.283c-1.023-0.521-25.331-13.092-49.517-41.82c-14.137-16.793-25.399-35.728-33.475-56.28c-10.049-25.573-15.145-53.683-15.145-83.547c0-5.293,3.533-9.936,8.635-11.348c62.144-17.179,86.997-37.796,87.241-38.003c4.422-3.741,10.821-3.783,15.208,0c0.207,0.173,25.819,21.024,87.241,38.003c5.102,1.412,8.635,6.055,8.635,11.348C318.479,226.643,313.384,254.793,303.335,280.381z"/><path d="M178.152,321.377c14.709,17.474,29.27,28.009,36.841,32.839L215,170.838c-11.589,7.649-36.918,21.957-79.774,34.699C136.881,250.547,151.301,289.482,178.152,321.377z"/></g></svg>`),
            vpn: 'data:image/svg+xml;base64,' + btoa(`<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 496 496" xml:space="preserve" width="800px" height="800px" fill="#C11b05"><g id="SVGRepo_bgCarrier" stroke-width="0"/><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/><g id="SVGRepo_iconCarrier"> <path style="fill:#C11b05;" d="M248,298.4L248,298.4L248,298.4L248,298.4L248,298.4c-8-0.8-16-2.4-24-4v126.4c0,13.6,10.4,24,24,24 s24-10.4,24-24V294.4C264,296,256,297.6,248,298.4z"/> <path style="fill:#C11b05;" d="M248,298.4L248,298.4L248,298.4L248,298.4c-8-0.8-16-2.4-24-4V376h48v-81.6 C264,296,256,297.6,248,298.4L248,298.4z"/> <path style="fill:#C11b05;" d="M398.4,456H97.6c-13.6,0-24-10.4-24-24s10.4-24,24-24h301.6c13.6,0,24,10.4,24,24 C422.4,445.6,412,456,398.4,456z"/> <path style="fill:#C11b0533;" d="M73.6,432c0-13.6,10.4-24,24-24h301.6c13.6,0,24,10.4,24,24"/> <path style="fill:#C11b05;" d="M496,317.6c0,13.6-13.6,26.4-26.4,26.4H26.4C13.6,344,0,330.4,0,317.6V64c0-13.6,13.6-24,26.4-24 h442.4c13.6,0,27.2,10.4,27.2,24V317.6z"/> <rect x="160" y="408" style="fill:#C11b05;" width="176" height="48"/> <g> <path style="fill:#FFFFFF;" d="M192,144h-15.2c-3.2,0-6.4,0-7.2,3.2L151.2,200c-1.6,4.8-3.2,8.8-4.8,13.6c-1.6-4.8-2.4-9.6-4-14.4 L125.6,148c-0.8-3.2-4-4-8-4h-15.2c-2.4,0-4.8-0.8-6.4,1.6c-1.6,2.4-1.6,4-0.8,6.4l35.2,107.2c0.8,3.2,4,4.8,8,4.8h15.2 c3.2,0,6.4-2.4,7.2-5.6l38.4-108c0.8-2.4,0.8-3.2-0.8-5.6C196.8,143.2,194.4,144,192,144z"/> <path style="fill:#FFFFFF;" d="M246.4,139.2c-9.6,0-20.8,0.8-29.6,2.4c-4,0.8-8,4-8,8V256c0,4.8,7.2,8,11.2,8h13.6 c4.8,0,6.4-3.2,6.4-8v-34.4c16,0.8,33.6-4.8,42.4-14.4c7.2-7.2,11.2-16.8,11.2-28.8s-4-21.6-12-28.8 C273.6,143.2,261.6,139.2,246.4,139.2z M264,180c0,9.6-7.2,15.2-20,15.2c-1.6,0-4,0-4,0v-28c0,0,4,0,5.6,0 C263.2,166.4,264,176,264,180z"/> <path style="fill:#FFFFFF;" d="M393.6,144h-12.8c-4.8,0-4.8,0-4.8,4v44.8c0,4-1.6,7.2-1.6,10.4c-0.8-1.6-3.2-4-4-5.6l-35.2-52.8 c-1.6-1.6-4.8-0.8-7.2-0.8h-15.2c-4.8,0-8.8,0-8.8,4v108c0,4.8,4,8,8.8,8h12.8c4.8,0,10.4-3.2,10.4-8v-46.4c0-4-1.6-8-1.6-12 c1.6,2.4,2.4,4.8,4,8L372,260c1.6,2.4,4,4,6.4,4h14.4c4.8,0,6.4-3.2,6.4-8V148C400,144,397.6,144,393.6,144z"/> </g></g></svg>`),
            router: 'data:image/svg+xml;base64,' + btoa(`<svg height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 89.471 89.471" xml:space="preserve"><g><g><g><path style="fill:#C11b05;" d="M87.682,52.477h-15.36l-1.174-26.841c0-0.741-0.601-1.342-1.342-1.342c-0.744,0-1.342,0.601-1.342,1.342L67.29,52.477h-65.5C0.805,52.477,0,53.286,0,54.266v14.315c0,0.981,0.805,1.789,1.789,1.789h5.368v2.684h10.737v-2.684h53.794v2.684h10.737v-2.684h5.257c0.984,0,1.789-0.809,1.789-1.789V54.266C89.471,53.286,88.666,52.477,87.682,52.477z M59.312,63.915c-1.381,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.374,0,2.491,1.117,2.491,2.494C61.807,62.802,60.687,63.915,59.312,63.915z M65.965,63.915c-1.385,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.378,0,2.487,1.117,2.487,2.494C68.453,62.802,67.34,63.915,65.965,63.915z M72.608,63.915c-1.374,0-2.494-1.117-2.494-2.491c0-1.381,1.12-2.494,2.494-2.494c1.378,0,2.491,1.117,2.491,2.494C75.099,62.802,73.986,63.915,72.608,63.915z M79.257,63.915c-1.381,0-2.494-1.117-2.494-2.491c0-1.381,1.117-2.494,2.494-2.494c1.371,0,2.491,1.117,2.491,2.494C81.752,62.802,80.628,63.915,79.257,63.915z"/></g><g><path style="fill:#C11b05;" d="M61.939,33.258c-2.201-1.993-3.471-4.839-3.471-7.809s1.267-5.816,3.479-7.809l-1.109-1.224c-2.552,2.305-4.015,5.594-4.015,9.029c0,3.432,1.46,6.728,4.015,9.029L61.939,33.258z"/></g><g><path style="fill:#C11b05;" d="M62.909,32.185l1.106-1.224c-1.557-1.41-2.448-3.414-2.448-5.511c0-2.094,0.891-4.105,2.448-5.511l-1.106-1.224c-1.904,1.714-2.992,4.173-2.992,6.735C59.917,28.012,61.005,30.463,62.909,32.185z"/></g><g><path style="fill:#C11b05;" d="M65.117,29.733l1.109-1.224c-1.729-1.56-1.729-4.559,0-6.12l-1.109-1.224c-1.21,1.095-1.9,2.656-1.9,4.287C63.217,27.078,63.908,28.642,65.117,29.733z"/></g><g><path style="fill:#C11b05;" d="M77.672,33.258l1.102,1.22c2.555-2.301,4.015-5.594,4.015-9.029s-1.46-6.725-4.015-9.029l-1.106,1.224c2.205,1.99,3.471,4.839,3.471,7.809C81.14,28.42,79.873,31.265,77.672,33.258z"/></g><g><path style="fill:#C11b05;" d="M75.596,30.961l1.106,1.224c1.9-1.721,2.992-4.173,2.992-6.735s-1.092-5.018-2.992-6.735l-1.106,1.224c1.56,1.406,2.448,3.418,2.448,5.511C78.044,27.546,77.156,29.551,75.596,30.961z"/></g><g><path style="fill:#C11b05;" d="M74.49,29.733c1.21-1.088,1.9-2.656,1.9-4.284c0-1.632-0.691-3.192-1.9-4.287l-1.109,1.224c1.732,1.56,1.732,4.559,0,6.12L74.49,29.733z"/></g></g></g></svg>`),
            switch: 'data:image/svg+xml;base64,' + btoa(`<svg fill="#C11b05" width="800px" height="800px" viewBox="0 0 36 36" version="1.1" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>network-switch-solid</title><path d="M33.91,18.47,30.78,8.41A2,2,0,0,0,28.87,7H7.13A2,2,0,0,0,5.22,8.41L2.09,18.48a2,2,0,0,0-.09.59V27a2,2,0,0,0,2,2H32a2,2,0,0,0,2-2V19.06A2,2,0,0,0,33.91,18.47ZM8.92,25H7.12V22h1.8Zm5,0h-1.8V22h1.8Zm5,0h-1.8V22h1.8Zm5,0H22.1V22h1.8Zm5,0H27.1V22h1.8ZM31,19.4H5V18H31Z" class="clr-i-solid clr-i-solid-path-1"></path><rect x="0" y="0" width="36" height="36" fill-opacity="0"/></svg>`),
            user: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 1C8.96243 1 6.5 3.46243 6.5 6.5C6.5 9.53757 8.96243 12 12 12C15.0376 12 17.5 9.53757 17.5 6.5C17.5 3.46243 15.0376 1 12 1Z" fill="#C11b05"/><path d="M7 14C4.23858 14 2 16.2386 2 19V22C2 22.5523 2.44772 23 3 23H21C21.5523 23 22 22.5523 22 22V19C22 16.2386 19.7614 14 17 14H7Z" fill="#C11b05"/></svg>`),
            attacker: 'data:image/svg+xml;base64,' + btoa(`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="42.395 31.517 401.313 483.014" fill="#C11b05"><path d="M0 0 C1.293 -0.004 1.293 -0.004 2.612 -0.009 C5.511 -0.018 8.411 -0.019 11.31 -0.021 C13.385 -0.025 15.459 -0.03 17.534 -0.036 C23.178 -0.049 28.823 -0.055 34.468 -0.06 C37.995 -0.063 41.522 -0.067 45.048 -0.071 C56.082 -0.085 67.116 -0.095 78.15 -0.098 C90.886 -0.103 103.623 -0.12 116.36 -0.149 C126.204 -0.171 136.048 -0.181 145.892 -0.182 C151.771 -0.184 157.651 -0.189 163.53 -0.207 C169.064 -0.224 174.597 -0.226 180.131 -0.217 C182.159 -0.216 184.187 -0.221 186.215 -0.231 C188.991 -0.243 191.766 -0.237 194.541 -0.227 C195.736 -0.239 195.736 -0.239 196.955 -0.251 C203.77 -0.192 210.449 1.179 215.964 5.39 C222.501 12.079 223.915 18.529 223.83 27.623 C223.497 34.183 222.382 40.626 221.316 47.097 C221.073 48.614 220.831 50.13 220.59 51.646 C219.958 55.612 219.315 59.576 218.669 63.539 C217.765 69.101 216.875 74.664 215.984 80.227 C215.512 83.178 215.035 86.127 214.555 89.076 C214.332 90.451 214.11 91.827 213.888 93.202 C213.781 93.863 213.675 94.524 213.565 95.206 C213.031 98.561 212.54 101.918 212.116 105.288 C212.03 105.962 211.945 106.636 211.858 107.33 C211.629 109.175 211.411 111.021 211.193 112.867 C210.278 118.398 208.684 124.108 204.651 128.14 C201.865 128.347 199.178 128.427 196.39 128.421 C195.525 128.427 194.66 128.433 193.77 128.439 C190.855 128.457 187.941 128.46 185.027 128.463 C182.944 128.472 180.862 128.482 178.78 128.493 C173.11 128.519 167.441 128.532 161.771 128.541 C158.233 128.547 154.694 128.555 151.155 128.564 C140.092 128.591 129.029 128.611 117.965 128.618 C105.177 128.627 92.39 128.662 79.602 128.72 C69.728 128.763 59.855 128.784 49.981 128.786 C44.079 128.788 38.177 128.8 32.275 128.836 C26.724 128.869 21.175 128.873 15.624 128.856 C13.585 128.854 11.545 128.863 9.505 128.883 C6.725 128.908 3.947 128.896 1.167 128.875 C-0.05 128.9 -0.05 128.9 -1.293 128.924 C-3.551 128.884 -3.551 128.884 -7.349 128.14 C-13.129 121.378 -13.915 113.339 -15.118 104.832 C-15.28 103.725 -15.441 102.618 -15.607 101.477 C-16.13 97.886 -16.646 94.295 -17.161 90.703 C-17.873 85.787 -18.588 80.872 -19.306 75.957 C-19.569 74.15 -19.569 74.15 -19.837 72.307 C-20.823 65.583 -21.854 58.869 -22.985 52.168 C-23.105 51.456 -23.225 50.743 -23.348 50.009 C-23.875 46.888 -24.415 43.77 -24.977 40.654 C-28.75 18.634 -28.75 18.634 -22.27 9.269 C-15.853 2.161 -9.339 -0.01 0 0 Z" transform="translate(144.34854125976563,289.85955810546875)"/><path d="M0 0 C1.899 -0.009 1.899 -0.009 3.836 -0.018 C5.239 -0.014 6.641 -0.01 8.044 -0.006 C9.536 -0.009 11.028 -0.013 12.519 -0.018 C16.62 -0.028 20.721 -0.026 24.821 -0.022 C29.243 -0.019 33.665 -0.028 38.087 -0.036 C46.752 -0.048 55.416 -0.05 64.08 -0.048 C71.122 -0.046 78.164 -0.048 85.206 -0.052 C86.709 -0.053 86.709 -0.053 88.242 -0.054 C90.277 -0.055 92.312 -0.056 94.346 -0.058 C113.438 -0.068 132.529 -0.066 151.62 -0.06 C169.087 -0.055 186.554 -0.066 204.021 -0.085 C221.952 -0.105 239.883 -0.113 257.814 -0.109 C267.883 -0.107 277.951 -0.11 288.02 -0.124 C296.592 -0.136 305.164 -0.137 313.737 -0.125 C318.11 -0.119 322.484 -0.118 326.857 -0.13 C330.863 -0.141 334.868 -0.138 338.873 -0.124 C340.32 -0.121 341.768 -0.124 343.215 -0.132 C354.069 -0.187 361.848 0.638 369.988 8.313 C374.995 13.819 376.462 19.111 376.125 26.52 C375.023 34.64 371.23 39.323 365.168 44.626 C360.477 47.79 355.945 48.505 350.369 48.512 C349.097 48.518 347.826 48.525 346.516 48.531 C345.112 48.528 343.709 48.525 342.305 48.522 C340.808 48.526 339.311 48.53 337.815 48.536 C333.705 48.548 329.595 48.548 325.485 48.545 C321.052 48.545 316.618 48.556 312.185 48.565 C303.5 48.582 294.815 48.587 286.13 48.589 C279.071 48.59 272.013 48.594 264.954 48.6 C244.942 48.618 224.931 48.627 204.919 48.625 C203.301 48.625 203.301 48.625 201.65 48.625 C200.57 48.625 199.49 48.625 198.377 48.625 C180.868 48.624 163.359 48.643 145.851 48.671 C127.874 48.7 109.898 48.714 91.921 48.712 C81.828 48.712 71.735 48.717 61.642 48.739 C53.05 48.757 44.457 48.761 35.865 48.748 C31.481 48.741 27.098 48.741 22.714 48.758 C18.699 48.774 14.685 48.771 10.671 48.754 C9.22 48.751 7.769 48.754 6.318 48.765 C-2.997 48.832 -9.474 48.421 -16.707 42.106 C-22.652 35.19 -24.783 30.181 -24.547 20.993 C-23.692 13.208 -19.278 8.908 -13.563 3.919 C-9.14 0.741 -5.399 0.004 0 0 Z" transform="translate(67.24638080596924,433.7455244064331)"/><path d="M0 0 C13.379 7.993 21.457 20.164 30.299 32.609 C32.995 36.398 35.715 40.168 38.438 43.938 C38.971 44.677 39.504 45.416 40.053 46.177 C44.003 51.643 47.994 57.077 52 62.5 C58.185 70.872 64.293 79.296 70.374 87.744 C72.041 90.056 73.713 92.365 75.387 94.672 C78.108 98.424 80.821 102.182 83.525 105.947 C84.474 107.268 85.424 108.587 86.377 109.904 C93.435 119.683 100 129.515 100 142 C96.627 140.718 93.53 139.258 90.402 137.461 C72.923 127.573 55.39 120.191 36 115 C34.471 114.573 34.471 114.573 32.91 114.137 C26.953 112.543 20.95 111.403 14.875 110.375 C14.147 110.252 13.419 110.128 12.668 110.001 C4.026 108.599 -4.566 107.846 -13.32 107.797 C-14.6 107.786 -14.6 107.786 -15.906 107.775 C-61.828 107.482 -106.46 114.969 -145.629 140.566 C-148 142 -148 142 -150 142 C-148.672 124.41 -137.821 111.602 -127.684 97.969 C-124.229 93.32 -120.823 88.637 -117.438 83.938 C-116.905 83.199 -116.372 82.46 -115.823 81.699 C-114.215 79.466 -112.607 77.233 -111 75 C-103.804 65.001 -96.57 55.034 -89.246 45.128 C-85.716 40.347 -82.218 35.545 -78.749 30.72 C-76.62 27.759 -74.483 24.804 -72.342 21.852 C-71.209 20.288 -70.079 18.722 -68.949 17.156 C-61.91 7.706 -53.86 1.602 -43 -3 C-41.675 -3.563 -41.675 -3.563 -40.324 -4.137 C-27.437 -7.483 -11.734 -6.278 0 0 Z" transform="translate(268,39)"/><path d="M0 0 C-3.902 21.557 -13.348 39.735 -29 55 C-29.7 55.697 -30.4 56.395 -31.121 57.113 C-45.492 70.588 -63.554 75.742 -82.801 75.238 C-99.08 74.492 -114.115 66.926 -126 56 C-126.755 55.325 -127.511 54.649 -128.289 53.953 C-143.298 39.821 -151.082 21.651 -156 2 C-156 1.34 -156 0.68 -156 0 C-143.593 -4.606 -130.961 -7.419 -118 -10 C-116.229 -10.358 -116.229 -10.358 -114.422 -10.723 C-75.973 -17.814 -36.749 -11.665 0 0 Z" transform="translate(321,175)"/><path d="M0 0 C9.83 0.159 18.671 5.929 25.688 12.375 C26.291 12.924 26.894 13.473 27.516 14.039 C31.395 18.006 33.928 22.487 36.359 27.434 C36.704 28.129 37.049 28.825 37.404 29.542 C41.664 38.24 45.516 47.118 49.375 56 C50.16 57.799 50.945 59.597 51.73 61.396 C53.304 65.001 54.875 68.607 56.443 72.214 C58.2 76.256 59.962 80.296 61.728 84.334 C62.937 87.102 64.144 89.871 65.35 92.64 C65.902 93.908 66.455 95.176 67.009 96.443 C67.769 98.184 68.525 99.926 69.281 101.668 C69.701 102.632 70.12 103.597 70.553 104.591 C75.131 115.825 75.014 126.958 71.016 138.434 C65.295 151.103 54.116 157.567 42.438 164.062 C39.924 165.47 37.413 166.882 34.902 168.293 C34.283 168.64 33.664 168.987 33.025 169.345 C29.285 171.447 25.598 173.617 21.941 175.863 C20.672 176.634 20.672 176.634 19.378 177.421 C17.847 178.357 16.324 179.308 14.813 180.276 C9.551 183.459 5.823 183.809 -0.312 183.375 C-0.03 182.224 0.252 181.073 0.543 179.887 C1.967 173.468 2.799 166.962 3.69 160.453 C5.38 148.122 7.22 135.831 9.312 123.562 C16.887 90.276 16.887 90.276 9.688 58.375 C2.998 49.319 -5.132 42.672 -16.312 40.375 C-21.311 39.86 -26.29 39.567 -31.312 39.375 C-28.49 34.198 -25.337 29.548 -21.75 24.875 C-20.689 23.478 -19.629 22.081 -18.57 20.684 C-18.033 19.976 -17.496 19.268 -16.942 18.539 C-13.816 14.388 -10.761 10.185 -7.703 5.984 C-3.636 0.412 -3.636 0.412 0 0 Z" transform="translate(368.3125,234.625)"/><path d="M0 0 C3.251 2.899 5.548 6.421 8 10 C8.788 11.099 9.58 12.195 10.375 13.289 C12.062 15.618 13.733 17.958 15.391 20.309 C17.199 22.874 19.023 25.427 20.859 27.973 C21.554 28.937 21.554 28.937 22.262 29.921 C23.157 31.164 24.054 32.405 24.953 33.646 C28 37.888 28 37.888 28 39 C27.068 39.014 26.136 39.028 25.176 39.043 C12.241 39.527 1.721 42.204 -7.84 51.531 C-14.647 59.311 -18.389 67.429 -18.262 77.832 C-18.256 78.574 -18.251 79.315 -18.245 80.08 C-18.105 88.051 -17.037 95.822 -15.812 103.688 C-15.585 105.211 -15.357 106.735 -15.131 108.26 C-13.3 120.478 -11.272 132.664 -9.199 144.844 C-7.79 153.163 -6.513 161.501 -5.256 169.844 C-5.104 170.846 -4.953 171.847 -4.797 172.879 C-4.666 173.751 -4.536 174.623 -4.401 175.522 C-3.995 178.029 -3.514 180.513 -3 183 C-12.037 184.116 -17.772 180.327 -25.312 175.75 C-26.554 175.015 -27.795 174.281 -29.038 173.549 C-31.528 172.078 -34.012 170.595 -36.489 169.104 C-39.627 167.217 -42.789 165.375 -45.961 163.547 C-59.62 155.628 -70.281 148.773 -75.812 133.375 C-78.605 122.666 -77.776 113.837 -73.539 103.816 C-73.183 102.952 -72.828 102.089 -72.461 101.198 C-68.369 91.332 -64.04 81.567 -59.688 71.812 C-58.008 68.04 -56.33 64.266 -54.652 60.492 C-54.246 59.58 -53.84 58.667 -53.421 57.727 C-51.099 52.503 -48.81 47.266 -46.566 42.008 C-46.079 40.872 -45.591 39.737 -45.089 38.567 C-44.237 36.576 -43.394 34.582 -42.561 32.583 C-36.587 18.69 -27.508 7.743 -13.348 1.875 C-4.627 -1.375 -4.627 -1.375 0 0 Z" transform="translate(121,235)"/></svg>`),
            web: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="style=fill"><g id="web"><g id="Vector"><path d="M15.3222 10.383C15.3796 10.9457 15.4125 11.4903 15.4125 12C15.4125 12.9541 15.2972 14.0315 15.1208 15.1208C14.0315 15.2972 12.9541 15.4125 12 15.4125C11.0502 15.4125 9.97313 15.2975 8.87911 15.1205C8.70281 14.0312 8.5875 12.954 8.5875 12C8.5875 11.4905 8.62039 10.9458 8.67789 10.383C9.82608 10.5668 10.9715 10.6875 12 10.6875C13.0286 10.6875 14.174 10.5668 15.3222 10.383Z" fill="#C11b05"/><path d="M16.8752 10.0994C16.9462 10.7579 16.9875 11.399 16.9875 12C16.9875 12.8769 16.8997 13.8389 16.7599 14.8153C18.7425 14.4016 20.575 13.8731 21.5567 13.5722C21.8739 13.475 21.9986 13.4363 22.1658 13.3694C22.2494 13.336 22.326 13.302 22.4259 13.2543C22.4748 12.843 22.5 12.4244 22.5 12C22.5 10.878 22.324 9.79714 21.9982 8.78346L21.9133 8.81017C20.8868 9.12245 18.9652 9.6745 16.8752 10.0994Z" fill="#C11b05"/><path d="M21.4017 7.31948C20.3698 7.63221 18.579 8.14039 16.6599 8.53603C16.2178 5.84926 15.443 3.16951 15.0702 1.95598C17.8422 2.80227 20.1273 4.76467 21.4017 7.31948Z" fill="#C11b05"/><path d="M15.1117 8.82229C14.0253 8.99781 12.9513 9.1125 12 9.1125C11.0487 9.1125 9.97477 8.99781 8.88843 8.8223C9.30471 6.28005 10.0478 3.68306 10.4278 2.44333C10.525 2.12606 10.5637 2.00144 10.6306 1.83418C10.664 1.75062 10.698 1.67398 10.7457 1.57414C11.157 1.52518 11.5756 1.5 12 1.5C12.4434 1.5 12.8803 1.52748 13.3093 1.58083C13.3184 1.61564 13.3268 1.64679 13.3351 1.67626C13.3597 1.76333 13.3982 1.8857 13.4628 2.09104L13.4696 2.11261C13.7935 3.14223 14.6519 6.01401 15.1117 8.82229Z" fill="#C11b05"/><path d="M7.34004 8.536C7.7801 5.86107 8.54986 3.19576 8.92192 1.98181L8.92983 1.95597C6.15777 2.80225 3.8727 4.76465 2.59835 7.31946C3.63018 7.63219 5.42095 8.14036 7.34004 8.536Z" fill="#C11b05"/><path d="M2.00184 8.78345C1.67598 9.79714 1.5 10.878 1.5 12C1.5 12.4389 1.52693 12.8715 1.57923 13.2963L1.74471 13.3515L1.74603 13.3519L1.74765 13.3525L1.74879 13.3528C1.80205 13.3705 3.36305 13.886 5.41878 14.3975C5.99886 14.5418 6.61307 14.6844 7.24006 14.8151C7.10025 13.8388 7.0125 12.8769 7.0125 12C7.0125 11.3988 7.05374 10.7577 7.12472 10.0994C5.03428 9.67436 3.11218 9.12212 2.08597 8.80989L2.07883 8.80771L2.00184 8.78345Z" fill="#C11b05"/><path d="M12 16.9875C12.8769 16.9875 13.8389 16.8997 14.8153 16.7599C14.4016 18.7425 13.8731 20.575 13.5722 21.5566C13.475 21.8739 13.4363 21.9985 13.3694 22.1658C13.336 22.2494 13.302 22.326 13.2543 22.4259C12.843 22.4748 12.4244 22.5 12 22.5C11.5756 22.5 11.157 22.4748 10.7457 22.4259C10.698 22.326 10.664 22.2494 10.6306 22.1658C10.5637 21.9986 10.525 21.8739 10.4278 21.5567C10.1269 20.5751 9.59846 18.7427 9.18478 16.7603C10.1579 16.8996 11.1201 16.9875 12 16.9875Z" fill="#C11b05"/><path d="M5.0385 15.9259C3.73853 15.6024 2.63135 15.2775 1.95597 15.0702C2.97258 18.4002 5.59982 21.0274 8.92983 22.044L8.92192 22.0182C8.59705 20.9582 7.96897 18.7917 7.52191 16.4784C6.6525 16.3103 5.80722 16.1171 5.0385 15.9259Z" fill="#C11b05"/><path d="M22.0182 15.0781C20.9582 15.403 18.7915 16.0311 16.4781 16.4781C16.0311 18.7915 15.403 20.9581 15.0781 22.0182L15.0702 22.044C18.4002 21.0274 21.0274 18.4002 22.044 15.0702L22.0182 15.0781Z" fill="#C11b05"/><path d="M1.6103 13.323C1.64665 13.3277 1.67628 13.3327 1.68611 13.3349C1.69472 13.337 1.70821 13.3406 1.7131 13.3419L1.72391 13.345L1.72973 13.3468L1.73585 13.3487L1.74098 13.3503C1.7381 13.3494 1.67976 13.3348 1.6103 13.323Z" fill="#C11b05"/></g></g></g></svg>`),
            api: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.3,19a2.42,2.42,0,0,1-2.5.56l-2.35,2.35a.34.34,0,0,1-.49,0l-1-1a.36.36,0,0,1,0-.49l2.36-2.35a2.39,2.39,0,0,1,3.39-2.91L19.12,16.8l1,1,1.62-1.62A2.39,2.39,0,0,1,21.3,19ZM22,8v5.76A4.47,4.47,0,0,0,19.5,13a4.57,4.57,0,0,0-1.29.19V9.29H16.66V14A4.5,4.5,0,0,0,15,17.5a4.07,4.07,0,0,0,0,.5H4a2,2,0,0,1-2-2V8A2,2,0,0,1,4,6H20A2,2,0,0,1,22,8ZM11,15,9.09,9.27H7L5.17,15h1.7l.29-1.07H9L9.29,15Zm4.77-3.89a1.67,1.67,0,0,0-.55-1.35,2.43,2.43,0,0,0-1.62-.47h-2V15h1.54V13.11h.44a2.75,2.75,0,0,0,1-.17,1.82,1.82,0,0,0,.67-.44,1.63,1.63,0,0,0,.36-.64A2.36,2.36,0,0,0,15.75,11.11Zm-7.3.62-.12-.44-.15-.58c0-.21-.08-.37-.11-.5a4.63,4.63,0,0,1-.1.48c0,.19-.08.38-.13.57s-.08.34-.12.47l-.24.93H8.69Zm5.59-1a.63.63,0,0,0-.5-.17h-.4v1.31h.31a.9.9,0,0,0,.37-.07.59.59,0,0,0,.27-.22.75.75,0,0,0,.11-.42A.57.57,0,0,0,14,10.71Z" fill="#C11b05"/></svg>`),
            code: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.01005 0.858582L6.01005 14.8586L7.98995 15.1414L9.98995 1.14142L8.01005 0.858582Z" fill="#C11B05"/><path d="M12.5 11.5L11.0858 10.0858L13.1716 8L11.0858 5.91422L12.5 4.5L16 8L12.5 11.5Z" fill="#C11B05"/><path d="M2.82843 8L4.91421 10.0858L3.5 11.5L0 8L3.5 4.5L4.91421 5.91422L2.82843 8Z" fill="#C11B05"/></svg>`),
            scada: 'data:image/svg+xml;base64,' + btoa(`<svg fill="#C11B05" width="800px" height="800px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M475.115 163.781L336 252.309v-68.28c0-18.916-20.931-30.399-36.885-20.248L160 252.309V56c0-13.255-10.745-24-24-24H24C10.745 32 0 42.745 0 56v400c0 13.255 10.745 24 24 24h464c13.255 0 24-10.745 24-24V184.029c0-18.917-20.931-30.399-36.885-20.248z"/></svg>`),
            vm: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#C11b05"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2h13l.5.5v5.503a5.006 5.006 0 0 0-1-.583V3H2v9h5a5 5 0 0 0 1 3H4v-1h3v-1H1.5l-.5-.5v-10l.5-.5z"/><path d="M12 8c.367 0 .721.047 1.063.14.34.094.658.23.953.407.294.177.563.385.808.625.245.24.455.509.63.808a4.03 4.03 0 0 1 .405 3.082c-.093.342-.229.66-.406.954a4.382 4.382 0 0 1-.625.808c-.24.245-.509.455-.808.63a4.029 4.029 0 0 1-3.082.405 3.784 3.784 0 0 1-.954-.406 4.382 4.382 0 0 1-.808-.625 3.808 3.808 0 0 1-.63-.808 4.027 4.027 0 0 1-.405-3.082c.093-.342.229-.66.406-.954.177-.294.385-.563.625-.808.24-.245.509-.455.808-.63A4.028 4.028 0 0 1 12 8zm2 3.988L11 10v4l3-2.012z"/></svg>`),
            proxy: 'data:image/svg+xml;base64,' + btoa(`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="128" height="128" version="1.1"><title>Proxy Icon</title><path d="M 42.9375 22.03125 C 40.773543 22.03125 39.03125 23.773543 39.03125 25.9375 L 39.03125 33.875 C 39.03125 36.03896 40.773543 37.78125 42.9375 37.78125 L 85.0625 37.78125 C 87.22646 37.78125 88.96875 36.03896 88.96875 33.875 L 88.96875 25.9375 C 88.96875 23.773543 87.22646 22.03125 85.0625 22.03125 L 42.9375 22.03125 z M 46.5 26.75 C 46.58526 26.7333 46.659723 26.75 46.75 26.75 L 56.3125 26.75 C 57.034718 26.75 57.625 27.309032 57.625 28.03125 L 57.625 31.75 C 57.625 32.47222 57.034718 33.0625 56.3125 33.0625 L 46.75 33.0625 C 46.027782 33.0625 45.4375 32.47222 45.4375 31.75 L 45.4375 28.03125 C 45.4375 27.399309 45.903187 26.866876 46.5 26.75 z M 42.9375 44.75 C 40.773543 44.75 39.03125 46.492293 39.03125 48.65625 L 39.03125 56.59375 C 39.03125 58.75771 40.773543 60.5 42.9375 60.5 L 85.0625 60.5 C 87.22646 60.5 88.96875 58.75771 88.96875 56.59375 L 88.96875 48.65625 C 88.96875 46.492293 87.22646 44.75 85.0625 44.75 L 42.9375 44.75 z M 46.5 49.46875 C 46.58526 49.45205 46.659723 49.46875 46.75 49.46875 L 56.3125 49.46875 C 57.034718 49.46875 57.625 50.027782 57.625 50.75 L 57.625 54.46875 C 57.625 55.19097 57.034718 55.78125 56.3125 55.78125 L 46.75 55.78125 C 46.027782 55.78125 45.4375 55.19097 45.4375 54.46875 L 45.4375 50.75 C 45.4375 50.118059 45.903187 49.585626 46.5 49.46875 z M 25.0625 54.5625 L 5.1875 64 L 25.0625 73.4375 L 25.0625 68.5 L 32.90625 68.5 C 34.04633 68.5 34.96875 67.577577 34.96875 66.4375 L 34.96875 61.5625 C 34.96875 60.422423 34.04633 59.5 32.90625 59.5 L 25.0625 59.5 L 25.0625 54.5625 z M 102.9375 54.5625 L 102.9375 59.5 L 95.125 59.5 C 93.98492 59.5 93.0625 60.422423 93.0625 61.5625 L 93.0625 66.4375 C 93.0625 67.577577 93.98492 68.5 95.125 68.5 L 102.9375 68.5 L 102.9375 73.4375 L 122.8125 64 L 102.9375 54.5625 z M 42.9375 67.5 C 40.773543 67.5 39.03125 69.242293 39.03125 71.40625 L 39.03125 79.34375 C 39.03125 81.50771 40.773543 83.25 42.9375 83.25 L 85.0625 83.25 C 87.22646 83.25 88.96875 81.50771 88.96875 79.34375 L 88.96875 71.40625 C 88.96875 69.242293 87.22646 67.5 85.0625 67.5 L 42.9375 67.5 z M 46.5 72.21875 C 46.58526 72.20205 46.659723 72.21875 46.75 72.21875 L 56.3125 72.21875 C 57.034718 72.21875 57.625 72.777782 57.625 73.5 L 57.625 77.21875 C 57.625 77.94097 57.034718 78.53125 56.3125 78.53125 L 46.75 78.53125 C 46.027782 78.53125 45.4375 77.94097 45.4375 77.21875 L 45.4375 73.5 C 45.4375 72.868059 45.903187 72.335626 46.5 72.21875 z M 42.9375 90.21875 C 40.773543 90.21875 39.03125 91.961043 39.03125 94.125 L 39.03125 102.0625 C 39.03125 104.22646 40.773543 105.96875 42.9375 105.96875 L 85.0625 105.96875 C 87.22646 105.96875 88.96875 104.22646 88.96875 102.0625 L 88.96875 94.125 C 88.96875 91.961043 87.22646 90.21875 85.0625 90.21875 L 42.9375 90.21875 z M 46.5 94.9375 C 46.58526 94.9208 46.659723 94.9375 46.75 94.9375 L 56.3125 94.9375 C 57.034718 94.9375 57.625 95.496532 57.625 96.21875 L 57.625 99.9375 C 57.625 100.65972 57.034718 101.25 56.3125 101.25 L 46.75 101.25 C 46.027782 101.25 45.4375 100.65972 45.4375 99.9375 L 45.4375 96.21875 C 45.4375 95.586809 45.903187 95.054376 46.5 94.9375 z " fill="#C11b05"/></svg>`),
            soc: 'data:image/svg+xml;base64,' + btoa(`<svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g><path class="st0" style="fill:#C11B05;" d="M429.823,409.401c-11.741-17.577-29.574-27.295-46.322-33.618c-8.41-3.157-16.624-5.492-23.859-7.474 c-7.227-1.965-13.508-3.618-17.725-5.213c-7.384-2.738-15.186-6.289-20.628-10.112c-2.722-1.899-4.81-3.856-6.027-5.517 c-1.225-1.702-1.562-2.878-1.578-3.906c0-7.103,0-15.974,0-27.666c9.447-10.508,23.021-26.794,28.595-52.618 c1.949-0.88,3.873-1.875,5.731-3.166c4.62-3.19,8.542-7.819,11.864-14.116c3.346-6.323,6.306-14.405,9.463-25.463 c1.603-5.607,2.343-10.474,2.343-14.815c0.008-4.999-1.028-9.332-2.911-12.85c-2.482-4.678-6.29-7.457-9.701-9.002l7.703-11.478 v-12.727c0.732-0.995,1.2-1.908,1.085-2.631v-27.567l19.6-39.184c4.966-9.932,1.127-22.018-8.666-27.263L265.693,2.43 c-6.05-3.24-13.327-3.24-19.378,0L133.21,63.015c-9.784,5.245-13.624,17.331-8.657,27.263l19.6,39.209v27.543 c-0.123,0.748,0.288,1.66,1.085,2.696v12.662l7.704,11.46c-0.798,0.354-1.62,0.757-2.467,1.275 c-2.664,1.644-5.352,4.218-7.235,7.745c-1.883,3.519-2.919,7.851-2.91,12.85c0,4.341,0.74,9.208,2.343,14.815 c4.226,14.726,8.041,24.238,12.982,31.218c2.475,3.461,5.287,6.24,8.345,8.361c1.858,1.29,3.783,2.286,5.731,3.166 c5.574,25.824,19.148,42.111,28.595,52.618c0,11.692,0,20.562,0,27.666c0,0.872-0.354,2.13-1.702,3.93 c-1.989,2.672-6.108,5.912-11,8.657c-4.876,2.771-10.483,5.18-15.391,6.907c-5.764,2.047-15.054,4.168-25.455,7.153 c-15.629,4.522-34.111,11.033-49.149,23.925c-7.506,6.446-14.092,14.544-18.729,24.607c-4.636,10.056-7.301,22.01-7.292,35.986 c0,3.248,0.14,6.602,0.428,10.072c0.222,2.434,1.142,4.407,2.236,6.034c2.064,3.042,4.81,5.295,8.246,7.622 c6.019,3.979,14.364,7.876,25.043,11.699c31.958,11.396,84.881,21.829,150.449,21.846c53.268,0,98.232-6.914,130.329-15.605 c16.057-4.349,28.875-9.118,38.141-13.878c4.646-2.393,8.394-4.768,11.37-7.358c1.488-1.316,2.795-2.688,3.889-4.325 c1.094-1.627,2.015-3.6,2.228-6.034c0.288-3.461,0.428-6.816,0.428-10.046C442.419,436.114,437.633,421.093,429.823,409.401z M231.936,137.544c0-13.294,10.77-24.065,24.073-24.065c13.286,0,24.056,10.77,24.056,24.065v2.31 c0,13.287-10.77,24.065-24.056,24.065c-13.303,0-24.073-10.778-24.073-24.065V137.544z M236.466,460.639l-54.806-86.517 c4.991-2.088,10.104-4.727,14.84-7.777l31.366,45.104l15.128-28.455L236.466,460.639z M227.117,398.837l-25.273-36.332 c2.31-1.891,4.505-3.897,6.306-6.256c2.54-3.33,4.472-7.49,4.596-12.218l35.386,15.276L227.117,398.837z M212.795,336.887 c0-6.462,0-14.142,0-23.761v-2.77l-1.858-2.072c-9.874-10.993-23.234-25.586-27.871-51.516l-0.732-4.144l-3.955-1.414 c-2.524-0.896-4.439-1.817-6.116-2.984c-2.475-1.743-4.72-4.127-7.342-9.011c-2.59-4.86-5.328-12.119-8.328-22.65 c-1.324-4.604-1.792-8.181-1.792-10.845c0.008-3.083,0.6-4.884,1.2-6.026c0.913-1.653,2.032-2.36,3.454-2.936 c0.642-0.246,1.29-0.378,1.842-0.468l14.873,22.157l6.363-37.285l0.699-2.336c19.42,6.159,44.644,11.1,72.779,11.1 c28.06,0,53.366-4.9,72.794-11.041l0.674,2.277l6.364,37.285l14.873-22.141c0.937,0.148,2.195,0.46,3.166,1.102 c0.83,0.535,1.504,1.151,2.121,2.286c0.6,1.142,1.192,2.943,1.209,6.026c0,2.664-0.477,6.24-1.792,10.845 c-3.988,14.059-7.564,22.231-10.853,26.77c-1.644,2.293-3.149,3.724-4.818,4.892c-1.677,1.168-3.592,2.089-6.116,2.984 l-3.963,1.414l-0.724,4.144c-4.636,25.93-17.998,40.524-27.871,51.516l-1.858,2.072v2.77c0,9.62,0,17.299,0,23.761l-43.204,18.655 L212.795,336.887z M299.262,344.031c0.107,4.572,1.883,8.707,4.342,12.012c1.841,2.483,4.053,4.636,6.47,6.585l-25.191,36.208 l-21.006-39.53L299.262,344.031z M275.543,460.655l-6.528-77.653l15.12,28.447l31.308-45.022c1.044,0.667,2.089,1.324,3.182,1.949 c3.789,2.154,7.794,3.98,11.798,5.664L275.543,460.655z"/></g></svg>`),
            database: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.1371 6.91018C13.4184 6.7695 13.7123 6.59981 14 6.40001V8C14 9.65685 11.3137 11 8 11C4.68629 11 2 9.65685 2 8V6.40001C2.28772 6.59981 2.58158 6.7695 2.86293 6.91018C4.28096 7.61919 6.09998 8 8 8C9.90002 8 11.719 7.61919 13.1371 6.91018Z" fill="#C11B05"/><path d="M2 11.4V13C2 14.6569 4.68629 16 8 16C11.3137 16 14 14.6569 14 13V11.4C13.7123 11.5998 13.4184 11.7695 13.1371 11.9102C11.719 12.6192 9.90002 13 8 13C6.09998 13 4.28096 12.6192 2.86293 11.9102C2.58158 11.7695 2.28772 11.5998 2 11.4Z" fill="#C11B05"/><path d="M8 0C11.3137 0 14 1.34315 14 3C14 4.65685 11.3137 6 8 6C4.68629 6 2 4.65685 2 3C2 1.34315 4.68629 0 8 0Z" fill="#C11B05"/></svg>`),
            firewall: 'data:image/svg+xml;base64,' + btoa(`<svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g><rect x="0.034" y="0.787" fill="#C11B05" width="155.35" height="94.936"/><rect x="172.645" y="0.787" fill="#C11B05" width="155.35" height="94.936"/><rect x="0" y="112.959" fill="#C11B05" width="69.044" height="94.936"/><rect x="86.34" y="112.985" fill="#C11B05" width="155.35" height="94.936"/><path fill="#C11B05" d="M266.78,160.9l16.756-26.634l9.111,8.58c1.892-10.19,5.36-20.152,10.22-29.862h-43.916v60.279C263.7,165.796,266.68,161.059,266.78,160.9z"/><path fill="#C11B05" d="M436.126,148.283c22.542,18.028,41.586,38.129,56.938,59.613h7.509v-94.936h-69.044v31.32C433.046,145.611,434.47,146.959,436.126,148.283z"/><rect x="0.034" y="225.182" fill="#C11B05" width="155.35" height="94.936"/><rect x="0" y="337.354" fill="#C11B05" width="69.044" height="77.675"/><path fill="#C11B05" d="M368.494,54.627c4.479,0,8.996,1.003,13.068,2.908c9.836,4.517,16.654,14.16,17.653,25.083l1.193,13.106h100.2V0.787h-155.35V62.87c3.902-2.562,7.324-4.24,10.097-5.302C359.441,55.639,363.904,54.627,368.494,54.627z"/><path fill="#C11B05" d="M419.957,168.501c-29.116-23.278-40.498-48.985-44.873-67.266c-3.502-14.682-1.656-16.258-1.656-16.258c-0.16-1.753-1.252-3.262-2.827-3.986c-1.606-0.75-3.456-0.599-4.888,0.405c0,0-5.66,1.222-14.838,10.139c-20.936,20.328-44.616,54.228-29.023,100.583c16.756,49.743,7.897,60.144-0.864,59.47c-11.37-0.868-13.106-7.872-11.29-29.668c2.107-25.479-20.999-47.232-20.999-47.232s-35.901,57.076-63.891,97.904c-16.545,24.13-24.471,54.809-24.471,82.799h-0.561c0,86.044,69.761,155.822,155.827,155.822c86.078,0,155.822-69.778,155.822-155.822C517.358,280.64,476.759,213.939,419.957,168.501z M355.872,467.335c-47.461,0-85.969-38.492-85.969-85.968c0-16.157,4.488-31.286,12.238-44.198c6.688,24.855,29.372,43.169,56.352,43.169c32.204,0,58.332-26.11,58.332-58.315c0-6.153-0.965-12.086-2.735-17.657c28.298,14.076,47.75,43.254,47.75,77.001C441.84,428.843,403.365,467.335,355.872,467.335z"/><path fill="#C11B05" d="M177.959,320.118c4.522-22.748,13.279-44.35,25.496-62.167c7.021-10.24,14.577-21.568,21.943-32.77h-52.752v94.936H177.959z"/><path fill="#C11B05" d="M173.884,337.379H86.34v77.675h97.814c-6.536-18.719-10.27-38.744-10.27-59.664V337.379z"/></g></svg>`),
            hacker: 'data:image/svg+xml;base64,' + btoa(`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 512 512" xml:space="preserve"><g><path d="M378.625,209.465c-6.531-38.344-13.672-80-15.844-91.844c-5.313-28.906-43.375-45.063-71.656-24.234c-14.828,10.938-28.094,11.719-35.125,11.719s-14.828,1.563-35.125-11.719c-29.391-19.219-66.344-4.672-71.656,24.234c-2.172,11.844-9.313,53.5-15.844,91.844C53.906,219.418,0,238.778,0,261.012c0,32.438,114.625,58.719,256,58.719c141.391,0,256-26.281,256-58.719C512,238.778,458.094,219.418,378.625,209.465z" fill="#C11B05"/><path d="M109.125,330.45l7.547,86.515c39.563,6.719,79.734,10.219,119.703,11.078L256,401.278l19.625,26.765c39.969-0.859,80.141-4.359,119.703-11.078l7.547-86.515c-48.375,9.359-97.906,13.5-146.875,13.5C207.016,343.95,157.516,339.809,109.125,330.45z M186.688,401.997c-33.469-1.578-35.563-41.766-35.563-41.766l75.125,14.672C226.25,374.903,220.156,403.59,186.688,401.997z M360.875,360.231c0,0-2.094,40.188-35.563,41.766c-33.469,1.594-39.563-27.094-39.563-27.094L360.875,360.231z" fill="#C11B05"/></g></svg>`),
            pentester: 'data:image/svg+xml;base64,' + btoa(`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="42.395 31.517 401.313 483.014"><path d="M0 0 C1.293 -0.004 1.293 -0.004 2.612 -0.009 C5.511 -0.018 8.411 -0.019 11.31 -0.021 C13.385 -0.025 15.459 -0.03 17.534 -0.036 C23.178 -0.049 28.823 -0.055 34.468 -0.06 C37.995 -0.063 41.522 -0.067 45.048 -0.071 C56.082 -0.085 67.116 -0.095 78.15 -0.098 C90.886 -0.103 103.623 -0.12 116.36 -0.149 C126.204 -0.171 136.048 -0.181 145.892 -0.182 C151.771 -0.184 157.651 -0.189 163.53 -0.207 C169.064 -0.224 174.597 -0.226 180.131 -0.217 C182.159 -0.216 184.187 -0.221 186.215 -0.231 C188.991 -0.243 191.766 -0.237 194.541 -0.227 C195.736 -0.239 195.736 -0.239 196.955 -0.251 C203.77 -0.192 210.449 1.179 215.964 5.39 C222.501 12.079 223.915 18.529 223.83 27.623 C223.497 34.183 222.382 40.626 221.316 47.097 C221.073 48.614 220.831 50.13 220.59 51.646 C219.958 55.612 219.315 59.576 218.669 63.539 C217.765 69.101 216.875 74.664 215.984 80.227 C215.512 83.178 215.035 86.127 214.555 89.076 C214.332 90.451 214.11 91.827 213.888 93.202 C213.781 93.863 213.675 94.524 213.565 95.206 C213.031 98.561 212.54 101.918 212.116 105.288 C212.03 105.962 211.945 106.636 211.858 107.33 C211.629 109.175 211.411 111.021 211.193 112.867 C210.278 118.398 208.684 124.108 204.651 128.14 C201.865 128.347 199.178 128.427 196.39 128.421 C195.525 128.427 194.66 128.433 193.77 128.439 C190.855 128.457 187.941 128.46 185.027 128.463 C182.944 128.472 180.862 128.482 178.78 128.493 C173.11 128.519 167.441 128.532 161.771 128.541 C158.233 128.547 154.694 128.555 151.155 128.564 C140.092 128.591 129.029 128.611 117.965 128.618 C105.177 128.627 92.39 128.662 79.602 128.72 C69.728 128.763 59.855 128.784 49.981 128.786 C44.079 128.788 38.177 128.8 32.275 128.836 C26.724 128.869 21.175 128.873 15.624 128.856 C13.585 128.854 11.545 128.863 9.505 128.883 C6.725 128.908 3.947 128.896 1.167 128.875 C-0.05 128.9 -0.05 128.9 -1.293 128.924 C-3.551 128.884 -3.551 128.884 -7.349 128.14 C-13.129 121.378 -13.915 113.339 -15.118 104.832 C-15.28 103.725 -15.441 102.618 -15.607 101.477 C-16.13 97.886 -16.646 94.295 -17.161 90.703 C-17.873 85.787 -18.588 80.872 -19.306 75.957 C-19.569 74.15 -19.569 74.15 -19.837 72.307 C-20.823 65.583 -21.854 58.869 -22.985 52.168 C-23.105 51.456 -23.225 50.743 -23.348 50.009 C-23.875 46.888 -24.415 43.77 -24.977 40.654 C-28.75 18.634 -28.75 18.634 -22.27 9.269 C-15.853 2.161 -9.339 -0.01 0 0 Z" fill="#C11B05" transform="translate(144.34854125976563,289.85955810546875)"/><path d="M0 0 C1.899 -0.009 1.899 -0.009 3.836 -0.018 C5.239 -0.014 6.641 -0.01 8.044 -0.006 C9.536 -0.009 11.028 -0.013 12.519 -0.018 C16.62 -0.028 20.721 -0.026 24.821 -0.022 C29.243 -0.019 33.665 -0.028 38.087 -0.036 C46.752 -0.048 55.416 -0.05 64.08 -0.048 C71.122 -0.046 78.164 -0.048 85.206 -0.052 C86.709 -0.053 86.709 -0.053 88.242 -0.054 C90.277 -0.055 92.312 -0.056 94.346 -0.058 C113.438 -0.068 132.529 -0.066 151.62 -0.06 C169.087 -0.055 186.554 -0.066 204.021 -0.085 C221.952 -0.105 239.883 -0.113 257.814 -0.109 C267.883 -0.107 277.951 -0.11 288.02 -0.124 C296.592 -0.136 305.164 -0.137 313.737 -0.125 C318.11 -0.119 322.484 -0.118 326.857 -0.13 C330.863 -0.141 334.868 -0.138 338.873 -0.124 C340.32 -0.121 341.768 -0.124 343.215 -0.132 C354.069 -0.187 361.848 0.638 369.988 8.313 C374.995 13.819 376.462 19.111 376.125 26.52 C375.023 34.64 371.23 39.323 365.168 44.626 C360.477 47.79 355.945 48.505 350.369 48.512 C349.097 48.518 347.826 48.525 346.516 48.531 C345.112 48.528 343.709 48.525 342.305 48.522 C340.808 48.526 339.311 48.53 337.815 48.536 C333.705 48.548 329.595 48.548 325.485 48.545 C321.052 48.545 316.618 48.556 312.185 48.565 C303.5 48.582 294.815 48.587 286.13 48.589 C279.071 48.59 272.013 48.594 264.954 48.6 C244.942 48.618 224.931 48.627 204.919 48.625 C203.301 48.625 203.301 48.625 201.65 48.625 C200.57 48.625 199.49 48.625 198.377 48.625 C180.868 48.624 163.359 48.643 145.851 48.671 C127.874 48.7 109.898 48.714 91.921 48.712 C81.828 48.712 71.735 48.717 61.642 48.739 C53.05 48.757 44.457 48.761 35.865 48.748 C31.481 48.741 27.098 48.741 22.714 48.758 C18.699 48.774 14.685 48.771 10.671 48.754 C9.22 48.751 7.769 48.754 6.318 48.765 C-2.997 48.832 -9.474 48.421 -16.707 42.106 C-22.652 35.19 -24.783 30.181 -24.547 20.993 C-23.692 13.208 -19.278 8.908 -13.563 3.919 C-9.14 0.741 -5.399 0.004 0 0 Z" fill="#C11B05" transform="translate(67.24638080596924,433.7455244064331)"/><path d="M0 0 C13.379 7.993 21.457 20.164 30.299 32.609 C32.995 36.398 35.715 40.168 38.438 43.938 C38.971 44.677 39.504 45.416 40.053 46.177 C44.003 51.643 47.994 57.077 52 62.5 C58.185 70.872 64.293 79.296 70.374 87.744 C72.041 90.056 73.713 92.365 75.387 94.672 C78.108 98.424 80.821 102.182 83.525 105.947 C84.474 107.268 85.424 108.587 86.377 109.904 C93.435 119.683 100 129.515 100 142 C96.627 140.718 93.53 139.258 90.402 137.461 C72.923 127.573 55.39 120.191 36 115 C34.471 114.573 34.471 114.573 32.91 114.137 C26.953 112.543 20.95 111.403 14.875 110.375 C14.147 110.252 13.419 110.128 12.668 110.001 C4.026 108.599 -4.566 107.846 -13.32 107.797 C-14.6 107.786 -14.6 107.786 -15.906 107.775 C-61.828 107.482 -106.46 114.969 -145.629 140.566 C-148 142 -148 142 -150 142 C-148.672 124.41 -137.821 111.602 -127.684 97.969 C-124.229 93.32 -120.823 88.637 -117.438 83.938 C-116.905 83.199 -116.372 82.46 -115.823 81.699 C-114.215 79.466 -112.607 77.233 -111 75 C-103.804 65.001 -96.57 55.034 -89.246 45.128 C-85.716 40.347 -82.218 35.545 -78.749 30.72 C-76.62 27.759 -74.483 24.804 -72.342 21.852 C-71.209 20.288 -70.079 18.722 -68.949 17.156 C-61.91 7.706 -53.86 1.602 -43 -3 C-41.675 -3.563 -41.675 -3.563 -40.324 -4.137 C-27.437 -7.483 -11.734 -6.278 0 0 Z" fill="#C11B05" transform="translate(268,39)"/><path d="M0 0 C-3.902 21.557 -13.348 39.735 -29 55 C-29.7 55.697 -30.4 56.395 -31.121 57.113 C-45.492 70.588 -63.554 75.742 -82.801 75.238 C-99.08 74.492 -114.115 66.926 -126 56 C-126.755 55.325 -127.511 54.649 -128.289 53.953 C-143.298 39.821 -151.082 21.651 -156 2 C-156 1.34 -156 0.68 -156 0 C-143.593 -4.606 -130.961 -7.419 -118 -10 C-116.229 -10.358 -116.229 -10.358 -114.422 -10.723 C-75.973 -17.814 -36.749 -11.665 0 0 Z" fill="#C11B05" transform="translate(321,175)"/><path d="M0 0 C9.83 0.159 18.671 5.929 25.688 12.375 C26.291 12.924 26.894 13.473 27.516 14.039 C31.395 18.006 33.928 22.487 36.359 27.434 C36.704 28.129 37.049 28.825 37.404 29.542 C41.664 38.24 45.516 47.118 49.375 56 C50.16 57.799 50.945 59.597 51.73 61.396 C53.304 65.001 54.875 68.607 56.443 72.214 C58.2 76.256 59.962 80.296 61.728 84.334 C62.937 87.102 64.144 89.871 65.35 92.64 C65.902 93.908 66.455 95.176 67.009 96.443 C67.769 98.184 68.525 99.926 69.281 101.668 C69.701 102.632 70.12 103.597 70.553 104.591 C75.131 115.825 75.014 126.958 71.016 138.434 C65.295 151.103 54.116 157.567 42.438 164.062 C39.924 165.47 37.413 166.882 34.902 168.293 C34.283 168.64 33.664 168.987 33.025 169.345 C29.285 171.447 25.598 173.617 21.941 175.863 C20.672 176.634 20.672 176.634 19.378 177.421 C17.847 178.357 16.324 179.308 14.813 180.276 C9.551 183.459 5.823 183.809 -0.312 183.375 C-0.03 182.224 0.252 181.073 0.543 179.887 C1.967 173.468 2.799 166.962 3.69 160.453 C5.38 148.122 7.22 135.831 9.312 123.562 C16.887 90.276 16.887 90.276 9.688 58.375 C2.998 49.319 -5.132 42.672 -16.312 40.375 C-21.311 39.86 -26.29 39.567 -31.312 39.375 C-28.49 34.198 -25.337 29.548 -21.75 24.875 C-20.689 23.478 -19.629 22.081 -18.57 20.684 C-18.033 19.976 -17.496 19.268 -16.942 18.539 C-13.816 14.388 -10.761 10.185 -7.703 5.984 C-3.636 0.412 -3.636 0.412 0 0 Z" fill="#C11B05" transform="translate(368.3125,234.625)"/><path d="M0 0 C3.251 2.899 5.548 6.421 8 10 C8.788 11.099 9.58 12.195 10.375 13.289 C12.062 15.618 13.733 17.958 15.391 20.309 C17.199 22.874 19.023 25.427 20.859 27.973 C21.554 28.937 21.554 28.937 22.262 29.921 C23.157 31.164 24.054 32.405 24.953 33.646 C28 37.888 28 37.888 28 39 C27.068 39.014 26.136 39.028 25.176 39.043 C12.241 39.527 1.721 42.204 -7.84 51.531 C-14.647 59.311 -18.389 67.429 -18.262 77.832 C-18.256 78.574 -18.251 79.315 -18.245 80.08 C-18.105 88.051 -17.037 95.822 -15.812 103.688 C-15.585 105.211 -15.357 106.735 -15.131 108.26 C-13.3 120.478 -11.272 132.664 -9.199 144.844 C-7.79 153.163 -6.513 161.501 -5.256 169.844 C-5.104 170.846 -4.953 171.847 -4.797 172.879 C-4.666 173.751 -4.536 174.623 -4.401 175.522 C-3.995 178.029 -3.514 180.513 -3 183 C-12.037 184.116 -17.772 180.327 -25.312 175.75 C-26.554 175.015 -27.795 174.281 -29.038 173.549 C-31.528 172.078 -34.012 170.595 -36.489 169.104 C-39.627 167.217 -42.789 165.375 -45.961 163.547 C-59.62 155.628 -70.281 148.773 -75.812 133.375 C-78.605 122.666 -77.776 113.837 -73.539 103.816 C-73.183 102.952 -72.828 102.089 -72.461 101.198 C-68.369 91.332 -64.04 81.567 -59.688 71.812 C-58.008 68.04 -56.33 64.266 -54.652 60.492 C-54.246 59.58 -53.84 58.667 -53.421 57.727 C-51.099 52.503 -48.81 47.266 -46.566 42.008 C-46.079 40.872 -45.591 39.737 -45.089 38.567 C-44.237 36.576 -43.394 34.582 -42.561 32.583 C-36.587 18.69 -27.508 7.743 -13.348 1.875 C-4.627 -1.375 -4.627 -1.375 0 0 Z" fill="#C11B05" transform="translate(121,235)"/><path d="M0 0 C0.889 2.367 1.595 4.63 2.25 7.062 C10.349 34.631 26.176 57.796 51.543 72.031 C70.734 82.085 93.763 85.781 114.846 79.445 C140.248 71.337 160.863 53.433 173.139 29.809 C177.992 19.86 181.757 9.572 185 -1 C195.954 2.27 205.87 9.268 215 16 C213.176 28.159 206.031 37.234 198.594 46.668 C196.024 49.939 193.591 53.293 191.188 56.688 C190.584 57.538 190.584 57.538 189.968 58.406 C189.114 59.612 188.259 60.817 187.405 62.022 C184.723 65.797 182.019 69.555 179.312 73.312 C178.79 74.041 178.268 74.77 177.729 75.52 C176.723 76.917 175.702 78.304 174.666 79.679 C172.973 81.953 172.973 81.953 171.659 84.348 C169.273 88.16 167.455 90.583 163.031 91.85 C159.266 92.202 155.553 92.264 151.778 92.228 C150.335 92.247 148.892 92.269 147.449 92.295 C143.544 92.353 139.64 92.354 135.734 92.341 C132.466 92.334 129.199 92.355 125.931 92.376 C118.217 92.423 110.503 92.423 102.789 92.393 C94.848 92.363 86.911 92.414 78.971 92.505 C72.138 92.58 65.306 92.605 58.473 92.589 C54.399 92.58 50.326 92.59 46.252 92.65 C42.417 92.703 38.586 92.693 34.75 92.635 C33.35 92.624 31.949 92.635 30.549 92.671 C20.298 92.911 20.298 92.911 16.462 89.721 C13.111 86.155 10.568 82.148 8 78 C6.893 76.465 5.776 74.937 4.637 73.426 C3.652 72.056 2.668 70.685 1.688 69.312 C0.582 67.773 -0.523 66.234 -1.629 64.695 C-2.183 63.922 -2.738 63.149 -3.309 62.353 C-5.559 59.222 -7.823 56.103 -10.087 52.983 C-12.24 50.011 -14.384 47.033 -16.525 44.053 C-17.474 42.732 -18.424 41.413 -19.377 40.096 C-30.921 24.102 -30.921 24.102 -31.047 17.559 C-29.409 13.557 -26.271 12.169 -22.625 10.062 C-21.544 9.416 -21.544 9.416 -20.441 8.757 C-18.303 7.487 -16.153 6.242 -14 5 C-12.877 4.335 -11.754 3.67 -10.598 2.984 C-3.419 -1.14 -3.419 -1.14 0 0 Z" fill="#C11B05" transform="translate(151,183)"/><path d="M0 0 C120.12 0 240.24 0 364 0 C361.725 6.825 361.725 6.825 358.375 9.688 C357.743 10.248 357.112 10.809 356.461 11.387 C348.767 16.43 341.51 16.431 332.564 16.388 C331.201 16.392 329.839 16.397 328.477 16.404 C324.747 16.418 321.019 16.414 317.29 16.407 C313.262 16.402 309.235 16.415 305.208 16.425 C297.324 16.442 289.44 16.443 281.556 16.438 C275.148 16.434 268.74 16.435 262.332 16.44 C260.964 16.442 260.964 16.442 259.567 16.443 C257.714 16.444 255.86 16.446 254.006 16.447 C236.629 16.461 219.251 16.456 201.874 16.444 C185.979 16.434 170.084 16.447 154.188 16.471 C137.862 16.495 121.535 16.505 105.208 16.498 C96.044 16.495 86.88 16.497 77.716 16.515 C69.916 16.529 62.116 16.53 54.316 16.513 C50.337 16.504 46.359 16.502 42.38 16.517 C38.735 16.531 35.092 16.526 31.447 16.507 C29.509 16.501 27.571 16.515 25.632 16.53 C17.521 16.462 11.988 15.503 5.723 10 C5.175 9.34 4.627 8.68 4.062 8 C3.214 7.01 3.214 7.01 2.348 6 C1 4 1 4 0 0 Z" fill="#C11B05" transform="translate(61,498)"/><path d="M0 0 C4.074 0.849 5.544 2.302 8 5.625 C8.547 8.973 8.34 10.838 7 13.938 C3.963 16.5 0.909 16.798 -3 16.625 C-5.438 15.688 -5.438 15.688 -7 13.625 C-7.958 10.887 -8.326 8.515 -8 5.625 C-5.605 2.142 -4.148 0.864 0 0 Z" fill="#0A0A0A" transform="translate(243,345.375)"/></svg>`),
            clients: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg"><g><path d="M512 505.6c-108.8 0-204.8-89.6-204.8-204.8S396.8 102.4 512 102.4c108.8 0 204.8 89.6 204.8 204.8S620.8 505.6 512 505.6z m0-358.4c-83.2 0-153.6 70.4-153.6 153.6s64 153.6 153.6 153.6 153.6-70.4 153.6-153.6S595.2 147.2 512 147.2z" fill="#C11B05"/><path d="M832 864c0-211.2-147.2-377.6-326.4-377.6s-326.4 166.4-326.4 377.6H832z" fill="#C11B05"/><path d="M832 889.6H147.2v-25.6c0-224 160-403.2 352-403.2s352 179.2 352 396.8v25.6l-19.2 6.4z m-633.6-51.2h608C800 659.2 665.6 512 505.6 512c-166.4 0-294.4 147.2-307.2 326.4zM710.4 499.2c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6c64 0 121.6-51.2 121.6-121.6 0-51.2-32-96-83.2-115.2-12.8-6.4-19.2-19.2-12.8-32 6.4-12.8 19.2-19.2 32-12.8 70.4 19.2 115.2 83.2 115.2 160-6.4 96-83.2 172.8-172.8 172.8z" fill="#C11B05"/><path d="M966.4 806.4h-57.6c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h32c-12.8-140.8-115.2-249.6-236.8-249.6-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6c160 0 288 147.2 288 326.4v25.6h-25.6z" fill="#C11B05"/><path d="M300.8 499.2c-6.4 0-6.4 0 0 0-44.8 0-89.6-12.8-121.6-44.8-32-32-44.8-76.8-44.8-121.6 0-70.4 44.8-134.4 115.2-160 12.8-6.4 25.6 0 32 12.8 6.4 12.8 0 25.6-12.8 32-57.6 19.2-89.6 64-89.6 115.2 0 32 12.8 64 32 83.2 19.2 25.6 51.2 32 83.2 38.4 19.2 0 25.6 12.8 25.6 25.6s-6.4 19.2-19.2 19.2z" fill="#C11B05"/><path d="M89.6 806.4H12.8v-25.6c0-179.2 128-320 288-320 12.8 0 25.6 12.8 25.6 25.6s-12.8 25.6-25.6 25.6C179.2 512 76.8 620.8 64 761.6h32c12.8 0 25.6 12.8 25.6 25.6-6.4 6.4-12.8 19.2-32 19.2z" fill="#C11B05"/></g></svg>`),
            upload: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 16V4M12 4L8 8M12 4L16 8" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 18V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V18" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`),
            enlace: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 12H16M8 12C8 10.8954 8.89543 10 10 10H14C15.1046 10 16 10.8954 16 12C16 13.1046 15.1046 14 14 14H10C8.89543 14 8 13.1046 8 12Z" stroke="#C11B05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z" stroke="#C11B05" stroke-width="2"/></svg>`),
            mover: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L14 4H13V8H17V7L19 9L17 11V10H13V14H14L12 16L10 14H11V10H7V11L5 9L7 7V8H11V4H10L12 2Z" fill="#C11B05"/></svg>`),
            borrar: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 4V2C7 1.44772 7.44772 1 8 1H16C16.5523 1 17 1.44772 17 2V4H20C20.5523 4 21 4.44772 21 5C21 5.55228 20.5523 6 20 6H19V19C19 20.1046 18.1046 21 17 21H7C5.89543 21 5 20.1046 5 19V6H4C3.44772 6 3 5.55228 3 5C3 4.44772 3.44772 4 4 4H7ZM9 8V17H11V8H9ZM13 8V17H15V8H13Z" fill="#C11B05"/></svg>`),
            deleteAll: 'data:image/svg+xml;base64,' + btoa(`<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 3H9.5L8.5 4H5V6H19V4H15.5L14.5 3Z" fill="#C11B05"/><path d="M6 7H18V19C18 20.1 17.1 21 16 21H8C6.9 21 6 20.1 6 19V7Z" fill="#C11B05"/><path d="M10 10H14V12H10V10Z" fill="#FFFFFF"/><path d="M10 13H14V15H10V13Z" fill="#FFFFFF"/><path d="M10 16H14V18H10V16Z" fill="#FFFFFF"/></svg>`)
        };
        const componentLibrary = {
            server: { width: 60, height: 60, name: 'Servidor' },
            client: { width: 60, height: 60, name: 'Cliente' },
            mobile: { width: 60, height: 60, name: 'App Móvil' },
            cloud: { width: 60, height: 60, name: 'Nube' },
            waf: { width: 60, height: 60, name: 'WAF' },
            vpn: { width: 60, height: 60, name: 'VPN' },
            router: { width: 60, height: 60, name: 'Router' },
            switch: { width: 60, height: 60, name: 'Switch' },
            user: { width: 60, height: 60, name: 'Usuario' },
            web: { width: 60, height: 60, name: 'Aplicación Web' },
            api: { width: 60, height: 60, name: 'API' },
            code: { width: 60, height: 60, name: 'Análisis de Código' },
            scada: { width: 60, height: 60, name: 'SCADA' },
            vm: { width: 60, height: 60, name: 'Máquina Virtual' },
            proxy: { width: 60, height: 60, name: 'Proxy' },
            soc: { width: 60, height: 60, name: 'SOC' },
            database: { width: 60, height: 60, name: 'Base de Datos' },
            firewall: { width: 60, height: 60, name: 'Firewall' },
            hacker: { width: 60, height: 60, name: 'Atacante' },
            pentester: { width: 60, height: 60, name: 'Pentester' },
            clients: { width: 60, height: 60, name: 'Clientes' },
            upload: { width: 60, height: 60, name: 'Subir' },
            enlace: { width: 60, height: 60, name: 'Enlace' },
            mover: { width: 60, height: 60, name: 'Mover Vista' },
            borrar: { width: 60, height: 60, name: 'Eliminar' },
            deleteAll: { width: 60, height: 60, name: 'Eliminar Todo' }
        };
        const appState = {
            nodes: [],
            connectors: [],
            selectedElements: [],
            hoveredElement: null,
            mode: 'normal',
            showGrid: true,
            snapToGrid: true,
            gridSize: 24,
            nextId: 1,
            viewport: { x: 0, y: 0, scale: 1 },
            canvas: { width: 0, height: 0 },
            isForceLayoutActive: false,
            interaction: {
                isDragging: false,
                dragStart: { x: 0, y: 0 },
                dragElement: null,
                connectingFrom: null,
                isPanning: false,
                lastPointer: { x: 0, y: 0 },
                isDraggingConnector: false,
                dragConnector: null,
                dragConnectorEnd: null, 
                originalConnectorNodeId: null
            },
            needsRender: false,
            animationFrame: null,
            undoStack: [],
            redoStack: [],
            maxHistorySize: 50,
            lastSaveTime: Date.now(),
            autoSaveInterval: 30000, 
            clipboard: null
        };
        const MobileUX = {
            device: {
                type: 'desktop',
                isMobile: false,
                isTablet: false,
                hasTouch: false,
                supportsHaptics: false,
                isIOS: false,
                isAndroid: false,
                isSafari: false,
                isStandalone: false
            },
            adaptive: {
                touchAreaSize: 44,
                connectionPointRadius: 8,
                connectionPointThreshold: 30,
                selectionThreshold: 30,
                minimumTapDistance: 10,
                doubleTapTimeout: 300,
                longPressTimeout: 600,
                longPressThreshold: 10,
                scrollThreshold: 5,
                velocityThreshold: 0.3
            },
            gestures: {
                isDoubleTap: false,
                doubleTapTimer: null,
                longPressTimer: null,
                longPressActive: false,
                lastTapTime: 0,
                lastTapPosition: { x: 0, y: 0 },
                pinchStartDistance: 0,
                pinchLastScale: 1,
                isPinching: false,
                isPanning: false,
                twoFingerPan: false,
                touches: new Map(),
                velocity: { x: 0, y: 0 },
                lastMoveTime: 0
            },
            performance: {
                reducedQuality: false,
                lastInteractionTime: 0,
                interactionThrottleDelay: 16,
                renderQuality: 1,
                throttleTimer: null
            },
            init() {
                this.detectDevice();
                this.setAdaptiveValues();
                this.initializeHaptics();
                this.setupPerformanceMonitoring();
                this.preventIOSBehaviors();
                this.setupSafeArea();
            },
            detectDevice() {
                const ua = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                const hasTouch = ('ontouchstart' in window) || 
                                (navigator.maxTouchPoints > 0) || 
                                (navigator.msMaxTouchPoints > 0);
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const minDimension = Math.min(screenWidth, screenHeight);
                const maxDimension = Math.max(screenWidth, screenHeight);
                
                this.device.hasTouch = hasTouch;
                this.device.isIOS = (/ipad|iphone|ipod/.test(ua) || 
                                    (platform === 'macintel' && hasTouch)) && !window.MSStream;
                this.device.isAndroid = /android/.test(ua);
                this.device.isSafari = /safari/.test(ua) && !/chrome|crios|fxios/.test(ua);
                this.device.isStandalone = window.navigator.standalone || 
                                          window.matchMedia('(display-mode: standalone)').matches;
                
                this.device.isMobile = hasTouch && minDimension <= 768;
                this.device.isTablet = hasTouch && minDimension > 768 && minDimension <= 1024;
                this.device.type = this.device.isMobile ? 'mobile' : 
                                  this.device.isTablet ? 'tablet' : 'desktop';
                
                this.device.supportsHaptics = 'vibrate' in navigator;
                this.device.supportsPointerEvents = window.PointerEvent !== undefined;
                this.device.supportsTouchEvents = window.TouchEvent !== undefined;
                
                if (this.device.isIOS) {
                    this.device.iosVersion = this.getIOSVersion(ua);
                }
                
            },
            getIOSVersion(ua) {
                const match = ua.match(/os ([\d_]+)/);
                if (match) {
                    return parseFloat(match[1].replace('_', '.'));
                }
                return 0;
            },
            preventIOSBehaviors() {
                if (!this.device.isIOS) return;
                
                document.addEventListener('gesturestart', (e) => e.preventDefault(), { passive: false });
                document.addEventListener('gesturechange', (e) => e.preventDefault(), { passive: false });
                document.addEventListener('gestureend', (e) => e.preventDefault(), { passive: false });
                
                document.addEventListener('touchmove', (e) => {
                    if (e.scale !== undefined && e.scale !== 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                document.body.style.webkitTouchCallout = 'none';
                document.body.style.webkitUserSelect = 'none';
                document.body.style.touchAction = 'none';
                
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            },
            setupSafeArea() {
                if (this.device.isIOS) {
                    const style = document.createElement('style');
                    style.textContent = `
                        @supports (padding: env(safe-area-inset-top)) {
                            .header-bar {
                                padding-top: env(safe-area-inset-top);
                                height: calc(60px + env(safe-area-inset-top));
                            }
                            #sidebar {
                                padding-bottom: env(safe-area-inset-bottom);
                            }
                            #canvas-container {
                                top: calc(60px + env(safe-area-inset-top));
                                padding-bottom: env(safe-area-inset-bottom);
                            }
                            .floating-controls {
                                top: calc(80px + env(safe-area-inset-top));
                                right: max(20px, env(safe-area-inset-right));
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            },
            setAdaptiveValues() {
                if (this.device.isMobile) {
                    this.adaptive.touchAreaSize = 44;
                    this.adaptive.connectionPointRadius = 12;
                    this.adaptive.connectionPointThreshold = 40;
                    this.adaptive.selectionThreshold = 40;
                    this.adaptive.minimumTapDistance = 15;
                    this.adaptive.longPressTimeout = 600;
                    if (this.device.isIOS) {
                        this.adaptive.doubleTapTimeout = 350;
                        this.adaptive.longPressTimeout = 700;
                    }
                } else if (this.device.isTablet) {
                    this.adaptive.touchAreaSize = 36;
                    this.adaptive.connectionPointRadius = 10;
                    this.adaptive.connectionPointThreshold = 35;
                    this.adaptive.selectionThreshold = 35;
                    this.adaptive.minimumTapDistance = 12;
                } else {
                    this.adaptive.touchAreaSize = 20;
                    this.adaptive.connectionPointRadius = 8;
                    this.adaptive.connectionPointThreshold = 20;
                    this.adaptive.selectionThreshold = 20;
                    this.adaptive.minimumTapDistance = 10;
                }
            },
            initializeHaptics() {
                this.hapticFeedback = {
                    light: () => this.vibrate(10),
                    medium: () => this.vibrate(50),
                    heavy: () => this.vibrate(100),
                    selection: () => this.vibrate(10),
                    impact: () => this.vibrate(30),
                    error: () => this.vibrate([100, 50, 100])
                };
            },
            vibrate(pattern) {
                if (this.device.supportsHaptics && navigator.vibrate) {
                    try {
                        navigator.vibrate(pattern);
                    } catch (e) {
                    }
                }
            },
            setupPerformanceMonitoring() {
                let frameCount = 0;
                let lastTime = performance.now();
                const checkPerformance = () => {
                    frameCount++;
                    const currentTime = performance.now();
                    if (currentTime - lastTime >= 1000) {
                        const fps = frameCount;
                        frameCount = 0;
                        lastTime = currentTime;
                        if (this.device.isMobile || this.device.isTablet) {
                            if (fps < 30) {
                                this.performance.reducedQuality = true;
                                this.performance.renderQuality = 0.75;
                            } else if (fps > 45) {
                                this.performance.reducedQuality = false;
                                this.performance.renderQuality = 1;
                            }
                        }
                    }
                    requestAnimationFrame(checkPerformance);
                };
                if (this.device.hasTouch) {
                    requestAnimationFrame(checkPerformance);
                }
            },
            getTouchAreaSize(baseSize = 20) {
                return Math.max(baseSize, this.adaptive.touchAreaSize);
            },
            getScaledValue(mobileValue, desktopValue) {
                return this.device.isMobile ? mobileValue : desktopValue;
            },
            isWithinTouchThreshold(distance, customThreshold = null) {
                const threshold = customThreshold || this.adaptive.selectionThreshold;
                return distance <= threshold;
            }
        };
        const MobileGestures = {
            activeGestures: new Set(),
            touchHistory: [],
            isProcessing: false,
            rafId: null,
            init() {
                if (MobileUX.device.hasTouch) {
                    this.setupGestureHandlers();
                    this.setupIOSSpecificHandlers();
                }
            },
            setupGestureHandlers() {
                const canvas = document.getElementById('main-canvas');
                if (!canvas) {
                    return;
                }
                
                this.cleanupEventListeners();
                
                const options = { passive: false, capture: false };
                
                if (MobileUX.device.supportsPointerEvents && !MobileUX.device.isIOS) {
                    this.boundHandlers = {
                        pointerdown: this.handlePointerDown.bind(this),
                        pointermove: this.handlePointerMove.bind(this),
                        pointerup: this.handlePointerUp.bind(this),
                        pointercancel: this.handlePointerCancel.bind(this)
                    };
                    canvas.addEventListener('pointerdown', this.boundHandlers.pointerdown, options);
                    canvas.addEventListener('pointermove', this.boundHandlers.pointermove, options);
                    canvas.addEventListener('pointerup', this.boundHandlers.pointerup, options);
                    canvas.addEventListener('pointercancel', this.boundHandlers.pointercancel, options);
                } else {
                    this.boundHandlers = {
                        touchstart: this.handleTouchStart.bind(this),
                        touchmove: this.throttledTouchMove.bind(this),
                        touchend: this.handleTouchEnd.bind(this),
                        touchcancel: this.handleTouchCancel.bind(this)
                    };
                    canvas.addEventListener('touchstart', this.boundHandlers.touchstart, options);
                    canvas.addEventListener('touchmove', this.boundHandlers.touchmove, options);
                    canvas.addEventListener('touchend', this.boundHandlers.touchend, options);
                    canvas.addEventListener('touchcancel', this.boundHandlers.touchcancel, options);
                }
                this.canvas = canvas;
                
                canvas.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    return false;
                }, false);
            },
            cleanupEventListeners() {
                if (this.canvas && this.boundHandlers) {
                    Object.entries(this.boundHandlers).forEach(([event, handler]) => {
                        this.canvas.removeEventListener(event, handler);
                    });
                    this.boundHandlers = null;
                }
            },
            setupIOSSpecificHandlers() {
                if (!MobileUX.device.isIOS) return;
                
                const canvas = document.getElementById('main-canvas');
                canvas.style.webkitTapHighlightColor = 'transparent';
                canvas.style.webkitTouchCallout = 'none';
                
                let touchStartY = 0;
                let touchStartX = 0;
                
                canvas.addEventListener('touchstart', (e) => {
                    touchStartY = e.touches[0].clientY;
                    touchStartX = e.touches[0].clientX;
                }, { passive: true });
                
                canvas.addEventListener('touchmove', (e) => {
                    const touch = e.touches[0];
                    const deltaY = Math.abs(touch.clientY - touchStartY);
                    const deltaX = Math.abs(touch.clientX - touchStartX);
                    
                    if (deltaY > MobileUX.adaptive.scrollThreshold || 
                        deltaX > MobileUX.adaptive.scrollThreshold) {
                        e.preventDefault();
                    }
                }, { passive: false });
            },
            handlePointerDown(e) {
                if (e.pointerType === 'touch') {
                    this.handleTouchStart(e);
                }
            },
            handlePointerMove(e) {
                if (e.pointerType === 'touch') {
                    this.throttledTouchMove(e);
                }
            },
            handlePointerUp(e) {
                if (e.pointerType === 'touch') {
                    this.handleTouchEnd(e);
                }
            },
            handlePointerCancel(e) {
                if (e.pointerType === 'touch') {
                    this.handleTouchCancel(e);
                }
            },
            throttledTouchMove(e) {
                if (!this.isProcessing) {
                    this.isProcessing = true;
                    this.rafId = requestAnimationFrame(() => {
                        this.handleTouchMove(e);
                        this.isProcessing = false;
                    });
                }
            },
            handleTouchStart(e) {
                const touches = e.touches ? Array.from(e.touches) : [e];
                const timestamp = Date.now();
                const target = e.target;
                
                if (target.closest('#sidebar') || target.closest('.modal')) {
                    return;
                }
                
                e.preventDefault();
                e.stopPropagation();
                
                touches.forEach(touch => {
                    const id = touch.identifier !== undefined ? touch.identifier : e.pointerId;
                    MobileUX.gestures.touches.set(id, {
                        id: id,
                        startX: touch.clientX,
                        startY: touch.clientY,
                        currentX: touch.clientX,
                        currentY: touch.clientY,
                        startTime: timestamp,
                        moved: false
                    });
                });
                
                const touchCount = touches.length;
                if (touchCount === 1) {
                    this.handleSingleTouchStart(touches[0], timestamp);
                } else if (touchCount === 2) {
                    this.handleMultiTouchStart(touches, timestamp);
                }
                
                this.updateTouchHistory(touches, 'start');
            },
            handleSingleTouchStart(touch, timestamp) {
                const pos = { x: touch.clientX, y: touch.clientY };
                const timeSinceLastTap = timestamp - MobileUX.gestures.lastTapTime;
                const distanceFromLastTap = Math.hypot(
                    pos.x - MobileUX.gestures.lastTapPosition.x,
                    pos.y - MobileUX.gestures.lastTapPosition.y
                );
                if (timeSinceLastTap < MobileUX.adaptive.doubleTapTimeout && 
                    distanceFromLastTap < MobileUX.adaptive.minimumTapDistance) {
                    this.handleDoubleTap(pos);
                    MobileUX.gestures.isDoubleTap = true;
                    this.clearTimers();
                } else {
                    this.startLongPressTimer(pos, timestamp);
                }
                MobileUX.gestures.lastTapTime = timestamp;
                MobileUX.gestures.lastTapPosition = pos;
            },
            handleMultiTouchStart(touches, timestamp) {
                if (touches.length === 2) {
                    const [touch1, touch2] = touches;
                    const distance = Math.hypot(
                        touch2.clientX - touch1.clientX,
                        touch2.clientY - touch1.clientY
                    );
                    MobileUX.gestures.pinchStartDistance = distance;
                    MobileUX.gestures.pinchLastScale = appState.viewport.scale;
                    MobileUX.gestures.isPinching = true;
                    this.activeGestures.add('pinch');
                    this.pinchCenter = {
                        x: (touch1.clientX + touch2.clientX) / 2,
                        y: (touch1.clientY + touch2.clientY) / 2
                    };
                }
            },
            handleTouchMove(e) {
                const touches = e.touches ? Array.from(e.touches) : [e];
                const timestamp = Date.now();
                
                if (e.cancelable) {
                    e.preventDefault();
                }
                
                touches.forEach(touch => {
                    const id = touch.identifier !== undefined ? touch.identifier : e.pointerId;
                    const storedTouch = MobileUX.gestures.touches.get(id);
                    if (storedTouch) {
                        const deltaX = touch.clientX - storedTouch.currentX;
                        const deltaY = touch.clientY - storedTouch.currentY;
                        const moved = Math.hypot(
                            touch.clientX - storedTouch.startX,
                            touch.clientY - storedTouch.startY
                        ) > MobileUX.adaptive.minimumTapDistance;
                        
                        storedTouch.previousX = storedTouch.currentX;
                        storedTouch.previousY = storedTouch.currentY;
                        storedTouch.currentX = touch.clientX;
                        storedTouch.currentY = touch.clientY;
                        storedTouch.moved = moved;
                        storedTouch.velocityX = deltaX;
                        storedTouch.velocityY = deltaY;
                    }
                });
                
                if (touches.length === 1) {
                    this.handleSingleTouchMove(touches[0]);
                } else if (touches.length === 2) {
                    if (!MobileUX.gestures.isPinching) {
                        this.startPinchGesture(touches);
                    } else {
                        this.handlePinchMove(touches);
                    }
                }
                
                this.updateTouchHistory(touches, 'move');
            },
            handleSingleTouchMove(touch) {
                const id = touch.identifier !== undefined ? touch.identifier : touch.pointerId;
                const storedTouch = MobileUX.gestures.touches.get(id);
                if (storedTouch && storedTouch.moved) {
                    this.cancelLongPress();
                    if (appState.mode === 'pan' || MobileUX.gestures.isPanning) {
                        this.handlePan(storedTouch);
                    }
                }
            },
            startPinchGesture(touches) {
                const [touch1, touch2] = touches;
                const distance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                MobileUX.gestures.pinchStartDistance = distance;
                MobileUX.gestures.pinchLastScale = appState.viewport.scale;
                MobileUX.gestures.isPinching = true;
                this.activeGestures.add('pinch');
                this.cancelLongPress();
            },
            handlePinchMove(touches) {
                const [touch1, touch2] = touches;
                const currentDistance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                
                const scaleChange = currentDistance / MobileUX.gestures.pinchStartDistance;
                let newScale = MobileUX.gestures.pinchLastScale * scaleChange;
                
                const MIN_SCALE = 0.1;
                const MAX_SCALE = 5;
                newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, newScale));
                
                const centerX = (touch1.clientX + touch2.clientX) / 2;
                const centerY = (touch1.clientY + touch2.clientY) / 2;
                
                this.applyPinchZoom(newScale, centerX, centerY);
            },
            handlePan(storedTouch) {
                const deltaX = storedTouch.velocityX || 0;
                const deltaY = storedTouch.velocityY || 0;
                
                appState.viewport.x += deltaX;
                appState.viewport.y += deltaY;
                
                requestRender();
            },
            applyPinchZoom(newScale, centerX, centerY) {
                const rect = canvas.getBoundingClientRect();
                const canvasX = centerX - rect.left;
                const canvasY = centerY - rect.top;
                const worldX = (canvasX - appState.viewport.x) / appState.viewport.scale;
                const worldY = (canvasY - appState.viewport.y) / appState.viewport.scale;
                appState.viewport.scale = newScale;
                appState.viewport.x = canvasX - worldX * newScale;
                appState.viewport.y = canvasY - worldY * newScale;
                requestRender();
                MobileUX.hapticFeedback.light();
            },
            handleTouchEnd(e) {
                const timestamp = Date.now();
                const remainingTouches = e.touches ? Array.from(e.touches) : [];
                const changedTouches = e.changedTouches ? Array.from(e.changedTouches) : [e];
                
                if (e.cancelable) {
                    e.preventDefault();
                }
                
                if (changedTouches.length === 1 && remainingTouches.length === 0) {
                    this.handleSingleTouchEnd(changedTouches[0], timestamp);
                }
                
                changedTouches.forEach(touch => {
                    const id = touch.identifier !== undefined ? touch.identifier : e.pointerId;
                    MobileUX.gestures.touches.delete(id);
                });
                
                if (remainingTouches.length < 2 && MobileUX.gestures.isPinching) {
                    this.endPinchGesture();
                }
                
                if (remainingTouches.length === 0) {
                    MobileUX.gestures.isPanning = false;
                }
                
                this.updateTouchHistory(remainingTouches, 'end');
            },
            handleSingleTouchEnd(touch, timestamp) {
                const id = touch.identifier !== undefined ? touch.identifier : touch.pointerId;
                const storedTouch = MobileUX.gestures.touches.get(id);
                if (!storedTouch) return;
                
                const duration = timestamp - storedTouch.startTime;
                const moved = storedTouch.moved;
                
                this.clearTimers();
                
                if (!moved && !MobileUX.gestures.isDoubleTap) {
                    if (duration < MobileUX.adaptive.longPressTimeout && !MobileUX.gestures.longPressActive) {
                        this.handleSingleTap({ x: touch.clientX, y: touch.clientY });
                    }
                }
                
                if (moved && storedTouch.velocityX && storedTouch.velocityY) {
                    const velocity = Math.hypot(storedTouch.velocityX, storedTouch.velocityY);
                    if (velocity > MobileUX.adaptive.velocityThreshold) {
                        this.handleMomentum(storedTouch);
                    }
                }
                
                MobileUX.gestures.isDoubleTap = false;
                MobileUX.gestures.longPressActive = false;
            },
            handleMomentum(storedTouch) {
                const friction = 0.95;
                let velocityX = storedTouch.velocityX * 2;
                let velocityY = storedTouch.velocityY * 2;
                
                const animate = () => {
                    velocityX *= friction;
                    velocityY *= friction;
                    
                    if (Math.abs(velocityX) > 0.1 || Math.abs(velocityY) > 0.1) {
                        appState.viewport.x += velocityX;
                        appState.viewport.y += velocityY;
                        requestRender();
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
            },
            handleTouchCancel(e) {
                this.clearTimers();
                MobileUX.gestures.touches.clear();
                this.endPinchGesture();
                this.activeGestures.clear();
            },
            startLongPressTimer(position, timestamp) {
                this.clearTimers();
                MobileUX.gestures.longPressTimer = setTimeout(() => {
                    if (!MobileUX.gestures.longPressActive) {
                        MobileUX.gestures.longPressActive = true;
                        this.handleLongPress(position);
                    }
                }, MobileUX.adaptive.longPressTimeout);
            },
            cancelLongPress() {
                if (MobileUX.gestures.longPressTimer) {
                    clearTimeout(MobileUX.gestures.longPressTimer);
                    MobileUX.gestures.longPressTimer = null;
                }
                MobileUX.gestures.longPressActive = false;
            },
            clearTimers() {
                if (MobileUX.gestures.doubleTapTimer) {
                    clearTimeout(MobileUX.gestures.doubleTapTimer);
                    MobileUX.gestures.doubleTapTimer = null;
                }
                this.cancelLongPress();
            },
            endPinchGesture() {
                MobileUX.gestures.isPinching = false;
                MobileUX.gestures.pinchStartDistance = 0;
                this.activeGestures.delete('pinch');
            },
            updateTouchHistory(touches, type) {
                this.touchHistory.push({
                    timestamp: Date.now(),
                    type: type,
                    touches: touches.map(t => ({ x: t.clientX, y: t.clientY, id: t.identifier }))
                });
                if (this.touchHistory.length > 10) {
                    this.touchHistory.shift();
                }
            },
            handleSingleTap(position) {
                this.simulatePointerEvent('click', position);
                MobileUX.hapticFeedback.selection();
            },
            handleDoubleTap(position) {
                const rect = canvas.getBoundingClientRect();
                const canvasX = position.x - rect.left;
                const canvasY = position.y - rect.top;
                const worldPos = screenToWorld(canvasX, canvasY);
                const hitNode = appState.nodes.find(node => node.isHit(worldPos.x, worldPos.y));
                if (hitNode) {
                    editElement(hitNode);
                } else {
                    const currentScale = appState.viewport.scale;
                    let targetScale;
                    if (currentScale < 1) {
                        targetScale = 1;
                    } else if (currentScale < 2) {
                        targetScale = 2;
                    } else {
                        targetScale = 0.5;
                    }
                    this.animateZoomTo(targetScale, canvasX, canvasY);
                }
                MobileUX.hapticFeedback.medium();
            },
            handleLongPress(position) {
                const rect = canvas.getBoundingClientRect();
                const canvasX = position.x - rect.left;
                const canvasY = position.y - rect.top;
                this.showMobileContextMenu(position.x, position.y, canvasX, canvasY);
                MobileUX.hapticFeedback.heavy();
            },
            animateZoomTo(targetScale, centerX, centerY, duration = 300) {
                const startScale = appState.viewport.scale;
                const startTime = Date.now();
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeProgress = 1 - Math.pow(1 - progress, 3); // Ease out cubic
                    const currentScale = startScale + (targetScale - startScale) * easeProgress;
                    const worldX = (centerX - appState.viewport.x) / appState.viewport.scale;
                    const worldY = (centerY - appState.viewport.y) / appState.viewport.scale;
                    appState.viewport.scale = currentScale;
                    appState.viewport.x = centerX - worldX * currentScale;
                    appState.viewport.y = centerY - worldY * currentScale;
                    requestRender();
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                requestAnimationFrame(animate);
            },
            simulatePointerEvent(type, position) {
                const rect = canvas.getBoundingClientRect();
                const canvasX = position.x - rect.left;
                const canvasY = position.y - rect.top;
                const syntheticEvent = new PointerEvent(`pointer${type === 'click' ? 'down' : type}`, {
                    pointerId: 1,
                    bubbles: true,
                    clientX: position.x,
                    clientY: position.y
                });
                syntheticEvent.canvasX = canvasX;
                syntheticEvent.canvasY = canvasY;
                canvas.dispatchEvent(syntheticEvent);
            },
            showMobileContextMenu(screenX, screenY, canvasX, canvasY) {
                MobileFAB.showContextMenu(screenX, screenY, canvasX, canvasY);
            }
        };
        const MobileFAB = {
            isExpanded: false,
            contextMenuVisible: false,
            elements: {},
            lastFocusedElement: null,
            init() {
                    this.cacheElements();
                this.setupEventListeners();
                this.setupKeyboardHandling();
            },
            cacheElements() {
                this.elements = {
                    container: document.getElementById('fabContainer'),
                    main: document.getElementById('fabMain'),
                    menu: document.getElementById('fabMenu'),
                    backdrop: document.getElementById('fabBackdrop'),
                    contextMenu: document.getElementById('mobileContextMenu'),
                        save: document.getElementById('fabSave'),
                    load: document.getElementById('fabLoad'),
                    export: document.getElementById('fabExport'),
                    addNode: document.getElementById('fabAddNode'),
                    connect: document.getElementById('fabConnect'),
                    delete: document.getElementById('fabDelete'),
                    fitView: document.getElementById('fabFitView'),
                    fileInput: document.getElementById('fileInput')
                };
            },
            setupEventListeners() {
                if (!this.elements.main) return;
                
                this.elements.main.addEventListener('click', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    this.toggleFAB();
                });
                
                if (this.elements.backdrop) {
                    this.elements.backdrop.addEventListener('click', () => {
                        this.closeFAB();
                    });
                }
                
                const actions = {
                    save: () => this.handleSave(),
                    load: () => this.handleLoad(),
                    export: () => this.handleExport(),
                    addNode: () => this.handleAddNode(),
                    connect: () => this.handleConnect(),
                    delete: () => this.handleDelete(),
                    fitView: () => this.handleFitView()
                };
                
                Object.entries(actions).forEach(([key, handler]) => {
                    if (this.elements[key]) {
                        this.elements[key].addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            handler();
                            this.closeFAB();
                        });
                    }
                });
                
                if (this.elements.fileInput) {
                    this.elements.fileInput.addEventListener('change', (e) => {
                        this.processFileLoad(e.target.files[0]);
                    });
                }
                
                document.addEventListener('click', (e) => {
                    if (this.isExpanded && !this.elements.container.contains(e.target)) {
                        this.closeFAB();
                    }
                });
            },
            setupKeyboardHandling() {
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isExpanded) {
                        this.closeFAB();
                        if (this.lastFocusedElement) {
                            this.lastFocusedElement.focus();
                        }
                    }
                });
                
                if (this.elements.menu) {
                    this.elements.menu.addEventListener('keydown', (e) => {
                        if (e.key === 'Tab' && this.isExpanded) {
                            const focusableElements = this.elements.menu.querySelectorAll('button:not([disabled])');
                            const firstElement = focusableElements[0];
                            const lastElement = focusableElements[focusableElements.length - 1];
                            
                            if (e.shiftKey && document.activeElement === firstElement) {
                                e.preventDefault();
                                lastElement.focus();
                            } else if (!e.shiftKey && document.activeElement === lastElement) {
                                e.preventDefault();
                                firstElement.focus();
                            }
                        }
                    });
                }
            },
            toggleFAB() {
                if (this.isExpanded) {
                    this.closeFAB();
                } else {
                    this.openFAB();
                }
            },
            openFAB() {
                this.isExpanded = true;
                this.lastFocusedElement = document.activeElement;
                this.elements.main.classList.add('expanded');
                this.elements.main.setAttribute('aria-expanded', 'true');
                this.elements.menu.classList.add('expanded');
                this.elements.menu.setAttribute('aria-expanded', 'true');
                this.elements.backdrop.classList.add('visible');
                
                setTimeout(() => {
                    const firstButton = this.elements.menu.querySelector('button:not([disabled])');
                    if (firstButton) firstButton.focus();
                }, 100);
                
                if (MobileUX.device.supportsHaptics) {
                    MobileUX.hapticFeedback.light();
                }
                this.addRippleEffect(this.elements.main);
            },
            closeFAB() {
                this.isExpanded = false;
                this.elements.main.classList.remove('expanded');
                this.elements.main.setAttribute('aria-expanded', 'false');
                this.elements.menu.classList.remove('expanded');
                this.elements.menu.setAttribute('aria-expanded', 'false');
                this.elements.backdrop.classList.remove('visible');
                
                if (MobileUX.device.supportsHaptics) {
                    MobileUX.hapticFeedback.light();
                }
            },
            addRippleEffect(button) {
                const ripple = document.createElement('span');
                ripple.classList.add('fab-ripple');
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = '50%';
                ripple.style.top = '50%';
                ripple.style.transform = 'translate(-50%, -50%)';
                button.appendChild(ripple);
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 600);
            },
            handleSave() {
                if (typeof saveCanvas === 'function') {
                    saveCanvas();
                } else {
                    this.saveCanvasFallback();
                }
                if (MobileUX.device.supportsHaptics) MobileUX.hapticFeedback.medium();
            },
            saveCanvasFallback() {
                try {
                    const diagramData = this.serializeDiagram();
                    const blob = new Blob([JSON.stringify(diagramData, null, 2)], { 
                        type: 'application/json' 
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `diagram_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    showToast('Diagrama guardado exitosamente', 'success');
                } catch (error) {
                    showToast('Error al guardar el diagrama', 'error');
                }
            },
            handleLoad() {
                if (typeof loadCanvas === 'function') {
                    loadCanvas();
                } else {
                    if (this.elements.fileInput) {
                        this.elements.fileInput.click();
                    }
                }
                if (MobileUX.device.supportsHaptics) MobileUX.hapticFeedback.light();
            },
            processFileLoad(file) {
                if (!file) return;
                
                const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
                const ALLOWED_TYPES = ['application/json', 'image/svg+xml'];
                
                if (file.size > MAX_FILE_SIZE) {
                    showToast('El archivo es demasiado grande (máx 10MB)', 'error');
                    return;
                }
                
                if (!ALLOWED_TYPES.includes(file.type) && !file.name.endsWith('.json')) {
                    showToast('Tipo de archivo no permitido', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (!this.validateDiagramData(data)) {
                            throw new Error('Formato de archivo inválido');
                        }
                        this.loadDiagram(data);
                        showToast('Diagrama cargado exitosamente', 'success');
                        if (MobileUX.device.supportsHaptics) MobileUX.hapticFeedback.medium();
                    } catch (error) {
                        showToast('Error al cargar el archivo', 'error');
                    }
                };
                reader.onerror = () => {
                    showToast('Error al leer el archivo', 'error');
                };
                reader.readAsText(file);
                this.elements.fileInput.value = '';
            },
            validateDiagramData(data) {
                try {
                    if (!data || typeof data !== 'object') return false;
                    if (!Array.isArray(data.nodes)) return false;
                    if (!Array.isArray(data.connections)) return false;
                    
                    return data.nodes.every(node => 
                        node.hasOwnProperty('id') && 
                        node.hasOwnProperty('type') && 
                        typeof node.x === 'number' && 
                        typeof node.y === 'number'
                    );
                } catch (error) {
                    return false;
                }
            },
            handleExport() {
                if (typeof exportCanvas === 'function') {
                    exportCanvas();
                } else {
                    this.exportCanvasFallback();
                }
                if (MobileUX.device.supportsHaptics) MobileUX.hapticFeedback.medium();
            },
            exportCanvasFallback() {
                try {
                    const link = document.createElement('a');
                    link.download = `diagram_${new Date().toISOString().split('T')[0]}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    showToast('Imagen exportada exitosamente', 'success');
                } catch (error) {
                    showToast('Error al exportar la imagen', 'error');
                }
            },
            serializeDiagram() {
                return {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    nodes: appState.nodes,
                    connections: appState.connections,
                    viewport: appState.viewport
                };
            },
            loadDiagram(data) {
                if (data.nodes) {
                    appState.nodes = data.nodes.map(nodeData => {
                        if (nodeData.ipAddress && !nodeData.ipAddresses) {
                            nodeData.ipAddresses = nodeData.ipAddress ? [nodeData.ipAddress] : [];
                            delete nodeData.ipAddress;
                        }
                        if (!nodeData.ipAddresses) {
                            nodeData.ipAddresses = [];
                        }
                        return nodeData;
                    });
                }
                if (data.connections) appState.connections = data.connections;
                if (data.viewport) Object.assign(appState.viewport, data.viewport);
                requestRender();
            },
            handleAddNode() {
                this.closeFAB();
                this.showNodePicker();
                if (MobileUX.device.supportsHaptics) MobileUX.hapticFeedback.medium();
            },
            handleConnect() {
                this.closeFAB();
                if (appState.mode === 'connecting') {
                    setMode('normal');
                } else {
                    setMode('connecting');
                }
                MobileUX.hapticFeedback.medium();
                showToast(
                    appState.mode === 'connecting' 
                        ? 'Modo conexión activado - Toca dos nodos para conectar 🔗' 
                        : 'Modo normal activado ✋', 
                    'info'
                );
            },
            handleDelete() {
                this.closeFAB();
                if (appState.mode === 'deleting') {
                    setMode('normal');
                } else {
                    setMode('deleting');
                }
                MobileUX.hapticFeedback.medium();
                showToast(
                    appState.mode === 'deleting' 
                        ? 'Modo eliminación activado - Toca elementos para eliminar 🗑️' 
                        : 'Modo normal activado ✋', 
                    'info'
                );
            },
            handleFitView() {
                this.closeFAB();
                fitCanvas();
                MobileUX.hapticFeedback.medium();
                showToast('🔍 Vista ajustada', 'success', 1500);
            },
            showNodePicker() {
                const modal = this.createNodePickerModal();
                document.body.appendChild(modal);
                setTimeout(() => {
                    modal.classList.add('visible');
                }, 10);
            },
            createNodePickerModal() {
                const modal = document.createElement('div');
                modal.className = 'mobile-context-menu visible';
                modal.style.cssText = `
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    max-height: 60vh;
                    overflow-y: auto;
                    min-width: 280px;
                `;
                const nodeTypes = [
                    { type: 'server', name: 'Servidor', icon: '🖥️' },
                    { type: 'client', name: 'Cliente', icon: '💻' },
                    { type: 'mobile', name: 'Móvil', icon: '📱' },
                    { type: 'cloud', name: 'Nube', icon: '☁️' },
                    { type: 'database', name: 'Base de Datos', icon: '🗄️' },
                    { type: 'router', name: 'Router', icon: '🌐' },
                    { type: 'firewall', name: 'Firewall', icon: '🛡️' },
                    { type: 'user', name: 'Usuario', icon: '👤' }
                ];
                nodeTypes.forEach(({ type, name, icon }) => {
                    const item = document.createElement('div');
                    item.className = 'context-menu-item';
                    item.innerHTML = `
                        <span class="context-menu-icon">${icon}</span>
                        <span>${name}</span>
                    `;
                    item.addEventListener('click', () => {
                        this.addNodeOfType(type);
                        this.closeNodePicker(modal);
                    });
                    modal.appendChild(item);
                });
                const cancelItem = document.createElement('div');
                cancelItem.className = 'context-menu-item';
                cancelItem.innerHTML = `
                    <span class="context-menu-icon">❌</span>
                    <span>Cancelar</span>
                `;
                cancelItem.addEventListener('click', () => {
                    this.closeNodePicker(modal);
                });
                modal.appendChild(cancelItem);
                return modal;
            },
            addNodeOfType(type) {
                const rect = canvas.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const worldPos = screenToWorld(centerX, centerY);
                const node = new CanvasNode(appState.nextId++, type, worldPos.x, worldPos.y);
                node.x -= node.width / 2;
                node.y -= node.height / 2;
                appState.nodes.push(node);
                addToHistory();
                requestRender();
                MobileUX.hapticFeedback.impact();
                showToast(`${type} agregado ✅`, 'success', 1500);
            },
            closeNodePicker(modal) {
                modal.classList.remove('visible');
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                }, 300);
            },
            showContextMenu(screenX, screenY, canvasX, canvasY) {
                const worldPos = screenToWorld(canvasX, canvasY);
                const hitNode = appState.nodes.find(node => node.isHit(worldPos.x, worldPos.y));
                const hitConnector = appState.connectors.find(conn => conn.isHit(worldPos.x, worldPos.y, appState.nodes));
                let menuItems = [];
                if (hitNode) {
                    menuItems = [
                        { icon: '✏️', text: 'Editar', action: () => editElement(hitNode) },
                        { icon: '📋', text: 'Copiar', action: () => this.copyNode(hitNode) },
                        { icon: '🗑️', text: 'Eliminar', action: () => this.deleteNode(hitNode), danger: true }
                    ];
                } else if (hitConnector) {
                    menuItems = [
                        { icon: '🗑️', text: 'Eliminar Conexión', action: () => this.deleteConnector(hitConnector), danger: true }
                    ];
                } else {
                    menuItems = [
                        { icon: '➕', text: 'Agregar Nodo', action: () => this.showNodePicker() },
                        { icon: '📋', text: 'Pegar', action: () => pasteElements() },
                        { icon: '🔍', text: 'Ajustar Vista', action: () => fitToCanvas() }
                    ];
                }
                this.showContextMenuWithItems(screenX, screenY, menuItems);
            },
            showContextMenuWithItems(x, y, items) {
                const menu = this.elements.contextMenu;
                menu.innerHTML = '';
                items.forEach(item => {
                    const menuItem = document.createElement('div');
                    menuItem.className = `context-menu-item ${item.danger ? 'danger' : ''}`;
                    menuItem.innerHTML = `
                        <span class="context-menu-icon">${item.icon}</span>
                        <span>${item.text}</span>
                    `;
                    menuItem.addEventListener('click', () => {
                        this.hideContextMenu();
                        item.action();
                        MobileUX.hapticFeedback.selection();
                    });
                    menu.appendChild(menuItem);
                });
                this.positionContextMenu(menu, x, y);
                menu.classList.add('visible');
                this.contextMenuVisible = true;
            },
            positionContextMenu(menu, x, y) {
                const rect = menu.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                let left = x;
                let top = y;
                if (left + rect.width > viewportWidth - 20) {
                    left = viewportWidth - rect.width - 20;
                }
                if (left < 20) {
                    left = 20;
                }
                if (top + rect.height > viewportHeight - 20) {
                    top = y - rect.height - 10;
                }
                if (top < 20) {
                    top = 20;
                }
                menu.style.left = left + 'px';
                menu.style.top = top + 'px';
            },
            hideContextMenu() {
                this.elements.contextMenu.classList.remove('visible');
                this.contextMenuVisible = false;
            },
            copyNode(node) {
                appState.clipboard = {
                    nodes: [{
                        type: node.type,
                        x: node.x,
                        y: node.y,
                        customName: node.customName,
                        ipAddresses: node.ipAddresses,
                        domain: node.domain,
                        port: node.port,
                        notes: node.notes,
                        customImageId: node.customImageId,
                        originalId: node.id
                    }],
                    connectors: []
                };
                showToast('📋 Nodo copiado', 'success', 1500);
            },
            deleteNode(node) {
                appState.nodes = appState.nodes.filter(n => n.id !== node.id);
                appState.connectors = appState.connectors.filter(c => 
                    c.startNodeId !== node.id && c.endNodeId !== node.id
                );
                addToHistory();
                requestRender();
                showToast('🗑️ Nodo eliminado', 'success', 1500);
            },
            deleteConnector(connector) {
                appState.connectors = appState.connectors.filter(c => c.id !== connector.id);
                addToHistory();
                requestRender();
                showToast('🗑️ Conexión eliminada', 'success', 1500);
            }
        };
        const MobileSpace = {
            isFullscreen: false,
            sidebarVisible: false,
            minimapCollapsed: false,
            init() {
                if (!MobileUX.device.isMobile && !MobileUX.device.isTablet) return;
                this.setupResponsiveLayout();
                this.setupAutoHideBehavior();
                this.optimizeForMobile();
            },
            setupResponsiveLayout() {
                if (MobileUX.device.isMobile) {
                    const minimapContainer = document.getElementById('minimapContainer');
                    const minimapToggle = document.getElementById('minimapToggle');
                    if (minimapContainer && minimapToggle) {
                        minimapContainer.classList.add('collapsed');
                        minimapToggle.textContent = '+';
                        this.minimapCollapsed = true;
                    }
                }
                window.addEventListener('resize', () => {
                    this.handleViewportChange();
                });
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        this.handleViewportChange();
                        this.optimizeForOrientation();
                    }, 100);
                });
            },
            setupAutoHideBehavior() {
                let hideTimer;
                let isInteracting = false;
                const showUI = () => {
                    if (this.isFullscreen) {
                        document.body.classList.remove('mobile-fullscreen-hide');
                    }
                    clearTimeout(hideTimer);
                };
                const scheduleHide = () => {
                    if (this.isFullscreen && !isInteracting) {
                        clearTimeout(hideTimer);
                        hideTimer = setTimeout(() => {
                            document.body.classList.add('mobile-fullscreen-hide');
                        }, 3000); // Hide after 3 seconds of inactivity
                    }
                };
                const interactionStart = () => {
                    isInteracting = true;
                    showUI();
                };
                const interactionEnd = () => {
                    isInteracting = false;
                    scheduleHide();
                };
                canvas.addEventListener('touchstart', interactionStart);
                canvas.addEventListener('pointerdown', interactionStart);
                canvas.addEventListener('touchend', interactionEnd);
                canvas.addEventListener('pointerup', interactionEnd);
                canvas.addEventListener('touchmove', showUI);
                canvas.addEventListener('pointermove', showUI);
            },
            optimizeForMobile() {
                if (!MobileUX.device.isMobile) return;
                document.body.classList.add('mobile-device');
                this.optimizeCanvasPerformance();
                this.setupFullscreenGestures();
            },
            handleViewportChange() {
                MobileUX.detectDevice();
                if (MobileUX.device.isMobile) {
                    this.optimizeForMobile();
                }
                if (typeof resizeCanvas === 'function') {
                    resizeCanvas();
                }
            },
            optimizeForOrientation() {
                const isLandscape = window.innerWidth > window.innerHeight;
                if (MobileUX.device.isMobile) {
                    if (isLandscape) {
                        document.body.classList.add('mobile-landscape');
                        document.body.classList.remove('mobile-portrait');
                    } else {
                        document.body.classList.add('mobile-portrait');
                        document.body.classList.remove('mobile-landscape');
                    }
                }
            },
            optimizeCanvasPerformance() {
                if (!canvas) return;
                const devicePixelRatio = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                const mobilePixelRatio = MobileUX.device.isMobile ? 
                    Math.min(devicePixelRatio, 2) : devicePixelRatio;
                canvas.width = rect.width * mobilePixelRatio;
                canvas.height = rect.height * mobilePixelRatio;
                const ctx = canvas.getContext('2d');
                ctx.scale(mobilePixelRatio, mobilePixelRatio);
            },
            setupFullscreenGestures() {
                const header = document.querySelector('.header-bar');
                if (header) {
                    let lastTap = 0;
                    header.addEventListener('touchend', (e) => {
                        const currentTime = new Date().getTime();
                        const tapLength = currentTime - lastTap;
                        if (tapLength < 500 && tapLength > 0) {
                            e.preventDefault();
                            this.toggleFullscreen();
                            MobileUX.hapticFeedback.medium();
                        }
                        lastTap = currentTime;
                    });
                }
            },
            toggleFullscreen() {
                this.isFullscreen = !this.isFullscreen;
                if (this.isFullscreen) {
                    this.enterFullscreen();
                } else {
                    this.exitFullscreen();
                }
            },
            enterFullscreen() {
                document.body.classList.add('mobile-fullscreen');
                const header = document.querySelector('.header-bar');
                const sidebar = document.querySelector('#sidebar');
                if (header) header.style.transform = 'translateY(-100%)';
                if (sidebar) sidebar.style.transform = 'translateX(-100%)';
                const canvasContainer = document.getElementById('canvas-container');
                if (canvasContainer) {
                    canvasContainer.style.left = '0';
                    canvasContainer.style.top = '0';
                }
                setTimeout(() => {
                    this.handleViewportChange();
                }, 300);
                showToast('📱 Modo pantalla completa activado', 'info', 2000);
            },
            exitFullscreen() {
                document.body.classList.remove('mobile-fullscreen', 'mobile-fullscreen-hide');
                const header = document.querySelector('.header-bar');
                const sidebar = document.querySelector('#sidebar');
                if (header) header.style.transform = '';
                if (sidebar && MobileUX.device.isMobile) {
                    sidebar.style.transform = 'translateX(-100%)'; // Keep sidebar hidden on mobile
                }
                const canvasContainer = document.getElementById('canvas-container');
                if (canvasContainer) {
                    canvasContainer.style.left = MobileUX.device.isMobile ? '0' : '280px';
                    canvasContainer.style.top = '60px';
                }
                setTimeout(() => {
                    this.handleViewportChange();
                }, 300);
                showToast('📱 Modo normal activado', 'info', 1500);
            },
            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                if (!sidebar) return;
                this.sidebarVisible = !this.sidebarVisible;
                if (this.sidebarVisible) {
                    sidebar.classList.add('open');
                    if (mobileMenuToggle) mobileMenuToggle.textContent = '✕';
                } else {
                    sidebar.classList.remove('open');
                    if (mobileMenuToggle) mobileMenuToggle.textContent = '☰';
                }
                MobileUX.hapticFeedback.light();
            },
            showElement(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.display = '';
                    element.classList.add('mobile-show');
                }
            },
            hideElement(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.classList.remove('mobile-show');
                    setTimeout(() => {
                        if (!element.classList.contains('mobile-show')) {
                            element.style.display = 'none';
                        }
                    }, 300);
                }
            },
            optimizeLayout() {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                if (viewportWidth < 480) {
                    document.body.classList.add('mobile-xs');
                    this.applyExtraSmallOptimizations();
                }
                else if (viewportWidth < 768) {
                    document.body.classList.add('mobile-sm');
                    this.applySmallScreenOptimizations();
                }
                else if (viewportWidth < 1024) {
                    document.body.classList.add('mobile-md');
                    this.applyTabletOptimizations();
                }
            },
            applyExtraSmallOptimizations() {
                const statusIndicator = document.getElementById('statusIndicator');
                if (statusIndicator) {
                    statusIndicator.style.display = 'none';
                }
                const fabMain = document.getElementById('fabMain');
                if (fabMain) {
                    fabMain.style.width = '48px';
                    fabMain.style.height = '48px';
                }
            },
            applySmallScreenOptimizations() {
            },
            applyTabletOptimizations() {
                const statusIndicator = document.getElementById('statusIndicator');
                if (statusIndicator) {
                    statusIndicator.style.display = '';
                }
            }
        };
        let canvas, ctx;
        let iconImages = {};
        const DOM = {};
        const CONSTANTS = {
            CONNECTION_POINT_RADIUS: { mobile: 10, desktop: 6 },
            CONNECTION_POINT_THRESHOLD: { mobile: 25, desktop: 15 },
            GRID_SPACING: 20,
            EXPORT_PADDING: 40,
            NODE_TEXT_OFFSET: 60,
            MIN_SCALE: 0.1,
            MAX_SCALE: 3,
            MAX_FILE_SIZE: 5 * 1024 * 1024, 
            SUPPORTED_IMAGE_TYPES: ['image/svg+xml', 'image/png'],
            COLORS: {
                PRIMARY_RED: '#C11b05',
                BLACK: '#000000',
                WHITE: '#FFFFFF',
                TEXT_PRIMARY: '#111827',
                TEXT_SECONDARY: '#6b7280',
                GRID_LINE: 'rgba(0, 0, 0, 0.08)',
                CONNECTION_POINT: '#C11b05',
                CONNECTION_POINT_STROKE: 'white',
                SHADOW_PRIMARY: 'rgba(193, 27, 5, 0.3)',
                SHADOW_SECONDARY: 'rgba(193, 27, 5, 0.2)'
            },
            DRAWING: {
                SELECTION_PADDING: 5,
                LINE_WIDTH_SELECTED: 3,
                LINE_WIDTH_NORMAL: 2,
                LINE_WIDTH_SCALE_DIVISOR: 1,
                DASH_PATTERN: [8, 4],
                SELECTION_DASH: [5, 3],
                ARROW_LENGTH_SELECTED: 18,
                ARROW_LENGTH_NORMAL: 15,
                ARROW_ANGLE: Math.PI / 6,
                SHADOW_BLUR_SELECTED: 15,
                SHADOW_BLUR_HOVERED: 10,
                TEXT_FONT_SIZE_BASE: 12,
                TEXT_FONT_SIZE_IP: 11,
                TEXT_FONT_SIZE_DOMAIN: 10,
                TEXT_LINE_HEIGHT: 14,
                TEXT_LINE_HEIGHT_IP: 13
            }
        };
        const customImages = new Map(); 
        const customImageCache = new Map(); 
        function validateCustomImageData(imageData) {
            if (!imageData || typeof imageData !== 'object') return false;
            const requiredProperties = ['data', 'name', 'type'];
            return requiredProperties.every(prop => 
                imageData.hasOwnProperty(prop) && imageData[prop] != null
            );
        }
        function getIconImage(type) {
            if (iconImages[type]) {
                return iconImages[type];
            }
            if (ICONS[type]) {
                const img = new Image();
                img.src = ICONS[type];
                iconImages[type] = img;
                return img;
            }
            return null;
        }
        function initDOMCache() {
            const elements = [
                'main-canvas', 'canvas-container', 'minimapCanvas', 'minimapToggle', 'minimapContainer',
                'loadingScreen', 'toastContainer', 'statusIndicator', 'helpOverlay', 'editModal',
                'zoomIn', 'zoomOut', 'zoomFit', 'gridToggle', 'snapToggle', 'forceToggle', 'saveBtn', 'loadBtn',
                'exportBtn', 'helpBtn', 'helpClose', 'cancelEdit', 'saveEdit', 'mobileMenuToggle',
                'searchBox', 'modeIndicator', 'sidebar', 'customUploadBtn', 'customImagesContainer',
                'nodeName', 'nodeIP', 'nodeDomain', 'nodePort', 'nodeNotes'
            ];
            elements.forEach(id => {
                DOM[id] = document.getElementById(id);
            });
        }
        function getDOMElement(elementId) {
            if (DOM[elementId]) {
                return DOM[elementId];
            }
            const element = document.getElementById(elementId);
            if (element) {
                DOM[elementId] = element; // Cache it
            }
            return element;
        }
        function addEventListeners(elementId, events) {
            const element = getDOMElement(elementId);
            if (!element) return;
            Object.entries(events).forEach(([event, handler]) => {
                element.addEventListener(event, handler);
            });
        }
        function setCanvasStyles(ctx, styles) {
            Object.entries(styles).forEach(([property, value]) => {
                if (property === 'lineDash') {
                    ctx.setLineDash(value);
                } else {
                    ctx[property] = value;
                }
            });
        }
        function drawCircle(ctx, x, y, radius, fillStyle, strokeStyle, lineWidth = 2) {
            const s = appState.viewport.scale;
            ctx.fillStyle = fillStyle;
            ctx.strokeStyle = strokeStyle;
            ctx.lineWidth = lineWidth / s;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
        }
        function drawLine(ctx, startX, startY, endX, endY, strokeStyle, lineWidth, dashPattern = []) {
            const s = appState.viewport.scale;
            ctx.strokeStyle = strokeStyle;
            ctx.lineWidth = lineWidth / s;
            ctx.setLineDash(dashPattern.map(dash => dash / s));
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        function drawText(ctx, text, x, y, fontSize, fillStyle = CONSTANTS.COLORS.TEXT_PRIMARY, fontWeight = 'normal', fontStyle = 'normal') {
            if (!ctx || text == null || typeof text === 'undefined' || isNaN(x) || isNaN(y) || fontSize <= 0) {
                return;
            }
            const s = appState.viewport.scale || 1;
            ctx.fillStyle = fillStyle;
            ctx.font = `${fontStyle} ${fontWeight} ${Math.max(8, fontSize / s)}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(String(text), x, y);
        }
        function getFormValues(fieldIds) {
            const values = {};
            fieldIds.forEach(id => {
                const element = DOM[id];
                if (element) {
                    values[id] = element.value;
                }
            });
            return values;
        }
        function setFormValues(values) {
            Object.entries(values).forEach(([id, value]) => {
                const element = DOM[id];
                if (element) {
                    element.value = value || '';
                }
            });
        }
        function scaleValue(value) {
            return value / appState.viewport.scale;
        }
        function validateIP(ip) {
            const ipPattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            return ipPattern.test(ip.trim());
        }
        function parseMultipleIPs(ipText) {
            if (!ipText || typeof ipText !== 'string') return [];
            return ipText
                .split(/[\r\n,;]+/)
                .map(ip => ip.trim())
                .filter(ip => ip.length > 0)
                .filter(ip => validateIP(ip))
                .slice(0, 50);
        }
        function formatIPsForDisplay(ipAddresses) {
            if (!ipAddresses || ipAddresses.length === 0) return '';
            return ipAddresses.join('\n');
        }
        function getWorldCoordinatesFromEvent(e, rect) {
            return screenToWorld(e.clientX - rect.left, e.clientY - rect.top);
        }
        function getConnectionPointRadius(isMobile) {
            return CONSTANTS.CONNECTION_POINT_RADIUS[isMobile ? 'mobile' : 'desktop'];
        }
        function getConnectionPointThreshold(isMobile) {
            return CONSTANTS.CONNECTION_POINT_THRESHOLD[isMobile ? 'mobile' : 'desktop'];
        }
        function validateImageFile(file) {
            if (!file) return { valid: false, error: 'No se seleccionó ningún archivo' };
            if (file.size > CONSTANTS.MAX_FILE_SIZE) {
                return { valid: false, error: 'El archivo es demasiado grande (máximo 5MB)' };
            }
            if (!CONSTANTS.SUPPORTED_IMAGE_TYPES.includes(file.type)) {
                return { valid: false, error: 'Tipo de archivo no soportado. Use SVG o PNG.' };
            }
            return { valid: true };
        }
        function processCustomImage(file, callback) {
            const validation = validateImageFile(file);
            if (!validation.valid) {
                alert(validation.error);
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imageData = e.target.result;
                    const imageId = `custom_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    const img = new Image();
                    img.onload = () => {
                        customImages.set(imageId, {
                            data: imageData,
                            name: file.name,
                            type: file.type,
                            width: img.width,
                            height: img.height
                        });
                        customImageCache.set(imageId, img);
                        callback(imageId);
                    };
                    img.onerror = () => {
                        alert('Error al cargar la imagen. Verifique que sea un archivo válido.');
                    };
                    img.src = imageData;
                } catch (error) {
                    showToast('❌ Error al procesar imagen: ' + error.message, 'error');
                }
            };
            reader.readAsDataURL(file);
        }
        function saveState() {
            if (!validateAppState()) return;
            const currentState = {
                nodes: appState.nodes.map(node => ({...node})),
                connectors: appState.connectors.map(conn => ({...conn})),
                nextId: appState.nextId
            };
            appState.undoStack.push(currentState);
            appState.redoStack = [];
            if (appState.undoStack.length > appState.maxHistorySize) {
                appState.undoStack.shift();
            }
        }
        function undo() {
            if (appState.undoStack.length === 0) {
                showToast('No hay acciones para deshacer', 'info');
                return false;
            }
            const currentState = {
                nodes: appState.nodes.map(node => ({...node})),
                connectors: appState.connectors.map(conn => ({...conn})),
                nextId: appState.nextId
            };
            appState.redoStack.push(currentState);
            const previousState = appState.undoStack.pop();
            appState.nodes = previousState.nodes.map(nodeData => {
                const node = new CanvasNode(nodeData.id, nodeData.type, nodeData.x, nodeData.y, nodeData.customImageId);
                Object.assign(node, nodeData);
                return node;
            });
            appState.connectors = previousState.connectors.map(connData => {
                const conn = new Connector(connData.id, connData.startNodeId, connData.endNodeId);
                Object.assign(conn, connData);
                return conn;
            });
            appState.nextId = previousState.nextId;
            requestRender();
            showToast('↶ Deshacer completado', 'success', 1500);
            return true;
        }
        function redo() {
            if (appState.redoStack.length === 0) {
                showToast('No hay acciones para rehacer', 'info');
                return false;
            }
            const currentState = {
                nodes: appState.nodes.map(node => ({...node})),
                connectors: appState.connectors.map(conn => ({...conn})),
                nextId: appState.nextId
            };
            appState.undoStack.push(currentState);
            const nextState = appState.redoStack.pop();
            appState.nodes = nextState.nodes.map(nodeData => {
                const node = new CanvasNode(nodeData.id, nodeData.type, nodeData.x, nodeData.y, nodeData.customImageId);
                Object.assign(node, nodeData);
                return node;
            });
            appState.connectors = nextState.connectors.map(connData => {
                const conn = new Connector(connData.id, connData.startNodeId, connData.endNodeId);
                Object.assign(conn, connData);
                return conn;
            });
            appState.nextId = nextState.nextId;
            requestRender();
            showToast('↷ Rehacer completado', 'success', 1500);
            return true;
        }
        function autoSave() {
            try {
                const customImagesData = {};
                customImages.forEach((value, key) => {
                    customImagesData[key] = value;
                });
                const saveData = {
                    nodes: appState.nodes.map(node => ({
                        id: node.id, type: node.type, x: node.x, y: node.y,
                        customName: node.customName, ipAddresses: node.ipAddresses,
                        domain: node.domain, port: node.port, notes: node.notes,
                        customImageId: node.customImageId
                    })),
                    connectors: appState.connectors.map(conn => ({
                        id: conn.id, startNodeId: conn.startNodeId, endNodeId: conn.endNodeId
                    })),
                    viewport: appState.viewport,
                    nextId: appState.nextId,
                    customImages: customImagesData,
                    timestamp: Date.now()
                };
                localStorage.setItem('dragonjarAutosave', JSON.stringify(saveData));
                appState.lastSaveTime = Date.now();
                updateStatusIndicator('Último guardado: ' + new Date().toLocaleTimeString());
            } catch (error) {
                updateStatusIndicator('Error en auto-guardado', false);
            }
        }
        function loadAutoSave() {
            try {
                const savedData = localStorage.getItem('dragonjarAutosave');
                if (!savedData) return false;
                const data = JSON.parse(savedData);
                const timeDiff = Date.now() - data.timestamp;
                const hoursDiff = timeDiff / (1000 * 60 * 60);
                if (hoursDiff > 24) {
                    localStorage.removeItem('dragonjarAutosave');
                    return false;
                }
                const shouldRestore = confirm(
                    `Se encontró una sesión guardada automáticamente (${Math.round(hoursDiff * 60)} minutos atrás). ¿Desea restaurarla?`
                );
                if (shouldRestore) {
                    if (data.customImages) {
                        customImages.clear();
                        customImageCache.clear();
                        const imageEntries = Object.entries(data.customImages);
                        let loadedCount = 0;
                        if (imageEntries.length === 0) {
                            renderCustomImages();
                        } else {
                            for (const [key, value] of imageEntries) {
                                if (!validateCustomImageData(value)) {
                                    loadedCount++;
                                    if (loadedCount === imageEntries.length) {
                                        renderCustomImages();
                                    }
                                    continue;
                                }
                                customImages.set(key, value);
                                const img = new Image();
                                img.onload = () => {
                                    customImageCache.set(key, img);
                                    loadedCount++;
                                    if (loadedCount === imageEntries.length) {
                                        renderCustomImages();
                                    }
                                    requestRender();
                                };
                                img.onerror = () => {
                                    loadedCount++;
                                    if (loadedCount === imageEntries.length) {
                                        renderCustomImages();
                                    }
                                };
                                img.src = value.data;
                            }
                        }
                    }
                    appState.nodes = data.nodes.map(nd => {
                        const node = new CanvasNode(nd.id, nd.type, nd.x, nd.y, nd.customImageId);
                        Object.assign(node, nd);
                        return node;
                    });
                    appState.connectors = data.connectors.map(cd => 
                        new Connector(cd.id, cd.startNodeId, cd.endNodeId)
                    );
                    appState.viewport = data.viewport || { x: 0, y: 0, scale: 1 };
                    appState.nextId = data.nextId || 1;
                    requestRender();
                    showToast('Sesión restaurada exitosamente ✅', 'success');
                    return true;
                }
            } catch (error) {
                localStorage.removeItem('dragonjarAutosave');
            }
            return false;
        }
        function startAutoSave() {
            setInterval(() => {
                if (appState.nodes.length > 0 || appState.connectors.length > 0) {
                    autoSave();
                }
            }, appState.autoSaveInterval);
        }
        function copySelectedElements() {
            const { nodes: selectedNodes, connectors: selectedConnectors } = getSelectedElements();
            if (selectedNodes.length === 0) return false;
            appState.clipboard = {
                nodes: selectedNodes.map(node => ({
                    type: node.type, x: node.x, y: node.y,
                    customName: node.customName, ipAddresses: node.ipAddresses,
                    domain: node.domain, port: node.port, notes: node.notes,
                    customImageId: node.customImageId,
                    originalId: node.id
                })),
                connectors: selectedConnectors.map(conn => ({
                    startNodeOriginalId: conn.startNodeId,
                    endNodeOriginalId: conn.endNodeId
                }))
            };
            showToast(`📋 ${selectedNodes.length} elementos copiados`, 'success', 2000);
            return true;
        }
        function pasteElements() {
            if (!appState.clipboard || appState.clipboard.nodes.length === 0) {
                showToast('No hay elementos para pegar', 'info');
                return false;
            }
            saveState(); 
            const idMapping = new Map();
            const offset = 50; 
            clearAllSelections();
            appState.clipboard.nodes.forEach(nodeData => {
                const newId = appState.nextId++;
                const node = new CanvasNode(
                    newId, 
                    nodeData.type, 
                    nodeData.x + offset, 
                    nodeData.y + offset,
                    nodeData.customImageId
                );
                Object.assign(node, nodeData, { 
                    id: newId, 
                    x: nodeData.x + offset, 
                    y: nodeData.y + offset,
                    selected: true 
                });
                idMapping.set(nodeData.originalId, newId);
                appState.nodes.push(node);
            });
            appState.clipboard.connectors.forEach(connData => {
                const startNodeId = idMapping.get(connData.startNodeOriginalId);
                const endNodeId = idMapping.get(connData.endNodeOriginalId);
                if (startNodeId && endNodeId) {
                    const connector = new Connector(appState.nextId++, startNodeId, endNodeId);
                    appState.connectors.push(connector);
                }
            });
            requestRender();
            showToast(`📋 ${appState.clipboard.nodes.length} elementos pegados`, 'success', 2000);
            return true;
        }
        let minimapCanvas, minimapCtx;
        const minimapState = {
            scale: 0.1,
            isCollapsed: false
        };
        function initializeMinimap() {
            minimapCanvas = document.getElementById('minimapCanvas');
            if (!minimapCanvas) return;
            minimapCtx = minimapCanvas.getContext('2d');
            if (!minimapCtx) {
                return;
            }
            minimapCanvas.width = 200;
            minimapCanvas.height = 110; 
            const toggle = getDOMElement('minimapToggle');
            toggle.addEventListener('click', toggleMinimap);
            minimapCanvas.addEventListener('click', handleMinimapClick);
            renderMinimap();
        }
        function toggleMinimap() {
            const container = getDOMElement('minimapContainer');
            const toggle = getDOMElement('minimapToggle');
            minimapState.isCollapsed = !minimapState.isCollapsed;
            container.classList.toggle('collapsed', minimapState.isCollapsed);
            toggle.textContent = minimapState.isCollapsed ? '+' : '−';
        }
        function handleMinimapClick(e) {
            if (minimapState.isCollapsed) return;
            const rect = minimapCanvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;
            const minimapBounds = getMinimapBounds();
            if (!minimapBounds) return;
            const clickRatioX = clickX / minimapCanvas.width;
            const clickRatioY = clickY / minimapCanvas.height;
            const worldX = minimapBounds.minX + (clickRatioX * minimapBounds.width);
            const worldY = minimapBounds.minY + (clickRatioY * minimapBounds.height);
            appState.viewport.x = -worldX * appState.viewport.scale + appState.canvas.width / 2;
            appState.viewport.y = -worldY * appState.viewport.scale + appState.canvas.height / 2;
            requestRender();
            showToast('🗺️ Navegación completada', 'success');
        }
        function getMinimapBounds() {
            if (appState.nodes.length === 0) {
                return { minX: -1000, minY: -750, width: 2000, height: 1500 };
            }
            const padding = 100;
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            appState.nodes.forEach(node => {
                minX = Math.min(minX, node.x - padding);
                minY = Math.min(minY, node.y - padding);
                maxX = Math.max(maxX, node.x + node.width + padding);
                maxY = Math.max(maxY, node.y + node.height + padding);
            });
            return {
                minX, minY,
                width: maxX - minX,
                height: maxY - minY
            };
        }
        function renderMinimap() {
            if (!minimapCtx || minimapState.isCollapsed) return;
            minimapCtx.fillStyle = '#f8f9fa';
            minimapCtx.fillRect(0, 0, minimapCanvas.width, minimapCanvas.height);
            const bounds = getMinimapBounds();
            const worldWidth = bounds.width;
            const worldHeight = bounds.height;
            const scaleX = minimapCanvas.width / worldWidth;
            const scaleY = minimapCanvas.height / worldHeight;
            minimapState.scale = Math.min(scaleX, scaleY, 0.3);
            const offsetX = (minimapCanvas.width - worldWidth * minimapState.scale) / 2;
            const offsetY = (minimapCanvas.height - worldHeight * minimapState.scale) / 2;
            minimapCtx.save();
            minimapCtx.translate(offsetX - bounds.minX * minimapState.scale, offsetY - bounds.minY * minimapState.scale);
            minimapCtx.scale(minimapState.scale, minimapState.scale);
            minimapCtx.strokeStyle = '#dee2e6';
            minimapCtx.lineWidth = 2 / minimapState.scale;
            appState.connectors.forEach(connector => {
                const startNode = appState.nodes.find(n => n.id === connector.startNodeId);
                const endNode = appState.nodes.find(n => n.id === connector.endNodeId);
                if (startNode && endNode) {
                    minimapCtx.beginPath();
                    minimapCtx.moveTo(startNode.x + startNode.width/2, startNode.y + startNode.height/2);
                    minimapCtx.lineTo(endNode.x + endNode.width/2, endNode.y + endNode.height/2);
                    minimapCtx.stroke();
                }
            });
            appState.nodes.forEach(node => {
                minimapCtx.fillStyle = node.selected ? '#C11b05' : '#6c757d';
                minimapCtx.fillRect(node.x, node.y, node.width, node.height);
            });
            const viewportX = -appState.viewport.x / appState.viewport.scale;
            const viewportY = -appState.viewport.y / appState.viewport.scale;
            const viewportWidth = appState.canvas.width / appState.viewport.scale;
            const viewportHeight = appState.canvas.height / appState.viewport.scale;
            minimapCtx.strokeStyle = '#C11b05';
            minimapCtx.lineWidth = 2 / minimapState.scale;
            minimapCtx.strokeRect(viewportX, viewportY, viewportWidth, viewportHeight);
            minimapCtx.restore();
        }
        window.addEventListener('beforeunload', () => {
            if (appState.animationFrame) {
                cancelAnimationFrame(appState.animationFrame);
            }
            autoSave();
        });
        function generateSidebar() {
            const sidebarCategories = {
                'Infraestructura': ['server', 'client', 'cloud', 'database', 'vm', 'proxy'],
                'Seguridad': ['waf', 'vpn', 'firewall', 'soc'],
                'Red': ['router', 'switch'],
                'Aplicaciones': ['web', 'mobile', 'api', 'code', 'scada'],
                'Actores': ['user', 'hacker', 'pentester', 'clients']
            };
            const sidebar = getDOMElement('sidebar');
            sidebar.innerHTML = `
                <div class="sidebar-section">
                    <input type="text" id="component-search" placeholder="Buscar componentes..." style="width: 90%; padding: 8px; margin: 10px 5%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                </div>
            `;
            Object.entries(sidebarCategories).forEach(([category, items]) => {
                const section = document.createElement('div');
                section.className = 'sidebar-section';
                const title = document.createElement('div');
                title.className = 'sidebar-title';
                title.textContent = category;
                const grid = document.createElement('div');
                grid.className = 'tool-grid';
                items.forEach(itemType => {
                    if (ICONS[itemType] && componentLibrary[itemType]) {
                        const button = document.createElement('button');
                        button.className = 'tool-button';
                        button.setAttribute('data-type', itemType);
                        button.setAttribute('draggable', 'true');
                        const iconImg = document.createElement('img');
                        iconImg.className = 'tool-icon';
                        iconImg.src = ICONS[itemType];
                        iconImg.style.width = '24px';
                        iconImg.style.height = '24px';
                        iconImg.style.objectFit = 'contain';
                        const span = document.createElement('span');
                        span.textContent = componentLibrary[itemType].name;
                        button.appendChild(iconImg);
                        button.appendChild(span);
                        grid.appendChild(button);
                    }
                });
                section.appendChild(title);
                section.appendChild(grid);
                sidebar.appendChild(section);
            });
            sidebar.innerHTML += `
                <div class="sidebar-section">
                    <div class="sidebar-title">Elementos Personalizados</div>
                    <div class="tool-grid">
                        <button class="tool-button custom-upload-btn" id="customUploadBtn">
                            <svg class="tool-icon" viewBox="0 0 32 32" fill="#C11b05" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21.6 8h-11l-6.6 9v5c0 1.104 0.896 2 2 2h20c1.104 0 2-0.896 2-2v-5l-6.4-9zM22.465 17.022l-2.052 3.003-8.589-0.020-2.201-2.995-4.086-0.023 5.662-7.975h9.801l5.6 7.975-4.135 0.035zM13.125 14l2.438 0.062v3.938c0 0.553 0.385 1 0.938 1 0.552 0 0.875-0.447 0.875-1v-3.938l2.436-0.062-3.312-3.812-3.375 3.812z"/>
                            </svg>
                            <span>Subir Imagen</span>
                        </button>
                        <div id="customImagesContainer" class="custom-images-grid"></div>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Herramientas</div>
                    <div class="tool-grid">
                        <button class="tool-button" data-action="connect">
                            <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.4481 1.50023C14.844 1.4862 13.3007 2.10727 12.15 3.22645L12.1351 3.24107L11.6464 3.7298C11.2559 4.12032 11.2559 4.75349 11.6464 5.14401L12.3535 5.85112C12.7441 6.24164 13.3772 6.24164 13.7677 5.85112L14.2484 5.37048C14.834 4.80437 15.6142 4.49305 16.4218 4.50012C17.2326 4.50721 18.0103 4.83463 18.5868 5.41517C19.1637 5.99606 19.4927 6.78402 19.4998 7.60991C19.5069 8.43176 19.1946 9.22174 18.633 9.81182L15.5209 12.9432C15.2056 13.2609 14.8269 13.5058 14.4107 13.6622C13.9945 13.8185 13.5501 13.8828 13.1076 13.8509C12.6651 13.8189 12.2341 13.6915 11.8438 13.4768C11.7456 13.4228 11.6504 13.3635 11.5588 13.2993C11.1066 12.9823 10.4859 12.8717 10.0425 13.201L9.23978 13.7973C8.79642 14.1266 8.69902 14.7603 9.09601 15.1443C9.48444 15.52 9.9219 15.8435 10.3977 16.1053C11.1664 16.5282 12.0171 16.78 12.8918 16.8431C13.7666 16.9062 14.6444 16.779 15.4656 16.4706C16.2868 16.1621 17.0317 15.6797 17.65 15.0568L20.7712 11.9162L20.7898 11.8971C21.9007 10.7389 22.5136 9.18987 22.4997 7.58402C22.4859 5.97817 21.8463 4.43996 20.7155 3.30127C19.5844 2.16225 18.0521 1.51427 16.4481 1.50023Z"/><path d="M11.1082 7.15685C10.2334 7.09376 9.35555 7.22089 8.53436 7.52937C7.71347 7.83773 6.96821 8.32053 6.34994 8.94317L3.22873 12.0838L3.21011 12.1029C2.09928 13.261 1.48637 14.8101 1.50023 16.416C1.51409 18.0218 2.15365 19.56 3.28441 20.6987C4.41551 21.8377 5.94781 22.4857 7.55185 22.4997C9.15591 22.5138 10.6993 21.8927 11.85 20.7735L11.8648 20.7589L12.3536 20.2701C12.7441 19.8796 12.7441 19.2465 12.3536 18.8559L11.6464 18.1488C11.2559 17.7583 10.6228 17.7583 10.2322 18.1488L9.75155 18.6295C9.16598 19.1956 8.38576 19.5069 7.5781 19.4999C6.76732 19.4928 5.98963 19.1653 5.41313 18.5848C4.83629 18.0039 4.50725 17.216 4.50012 16.3901C4.49303 15.5682 4.80532 14.7782 5.36694 14.1881L8.47904 11.0567C8.79434 10.7391 9.1731 10.4941 9.58932 10.3378C10.0055 10.1814 10.4498 10.1172 10.8924 10.1491C11.3349 10.181 11.7659 10.3084 12.1561 10.5231C12.2544 10.5772 12.3495 10.6365 12.4411 10.7007C12.8934 11.0177 13.5141 11.1282 13.9574 10.7989L14.7602 10.2026C15.2036 9.87328 15.301 9.23958 14.904 8.85563C14.5155 8.47995 14.0781 8.15644 13.6022 7.89464C12.8335 7.47172 11.9829 7.21993 11.1082 7.15685Z"/>
                            </svg>
                            <span>Conectar</span>
                        </button>
                        <button class="tool-button" data-action="pan">
                            <svg class="tool-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 3V9M12 3L9 6M12 3L15 6M12 15V21M12 21L15 18M12 21L9 18M3 12H9M3 12L6 15M3 12L6 9M15 12H21M21 12L18 9M21 12L18 15" stroke="#C11b05" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Mover Vista</span>
                        </button>
                        <button class="tool-button" data-action="delete">
                            <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                            <span>Eliminar</span>
                        </button>
                        <button class="tool-button" data-action="deleteAll">
                            <svg class="tool-icon" viewBox="0 0 24 24" fill="#C11b05" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                <circle cx="18" cy="6" r="4" fill="#ff4444"/>
                                <path d="M16 4h4M18 2v4" stroke="white" stroke-width="1"/>
                            </svg>
                            <span>Eliminar Todo</span>
                        </button>
                    </div>
                </div>
            `;
            const searchInput = getDOMElement('component-search');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const allSections = sidebar.querySelectorAll('.sidebar-section');
                allSections.forEach((section, index) => {
                    if (index === 0) return; // Skip search bar section
                    const buttons = section.querySelectorAll('.tool-button');
                    let hasVisibleButtons = false;
                    buttons.forEach(button => {
                        const buttonText = button.textContent.toLowerCase();
                        const buttonType = button.getAttribute('data-type');
                        const componentName = buttonType && componentLibrary[buttonType] ? componentLibrary[buttonType].name.toLowerCase() : '';
                        if (buttonText.includes(searchTerm) || componentName.includes(searchTerm)) {
                            button.style.display = 'flex';
                            hasVisibleButtons = true;
                        } else {
                            button.style.display = 'none';
                        }
                    });
                    section.style.display = hasVisibleButtons ? 'block' : 'none';
                });
            });
        }
        window.addEventListener('load', () => {
            MobileUX.init();
            
            if (MobileUX.device.isMobile || MobileUX.device.isTablet) {
                document.body.classList.add('mobile-device');
                if (MobileUX.device.isMobile) {
                    document.body.classList.add('mobile-phone');
                }
                if (MobileUX.device.isTablet) {
                    document.body.classList.add('mobile-tablet');
                }
                if (MobileUX.device.isIOS) {
                    document.body.classList.add('ios-device');
                }
                if (MobileUX.device.isAndroid) {
                    document.body.classList.add('android-device');
                }
            }
            
            setTimeout(() => {
                const loadingScreen = getDOMElement('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        
                        initializeCanvas();
                        MobileGestures.init();
                        MobileFAB.init();
                        MobileSpace.init();
                        ResponsiveUIManager.init();
                        preloadIcons();
                        generateSidebar();
                        setupCustomImageControls();
                        setupEventListeners();
                        initializeHelpSystem();
                        setupMobileSidebarToggle();
                        
                        requestAnimationFrame(() => {
                            resizeCanvas();
                            requestRender();
                        });
                    }, 300);
                }
            }, 500);
        });
        function initializeCanvas() {
            initDOMCache();
            canvas = DOM['main-canvas'];
            if (!canvas) {
                throw new Error('Canvas element not found');
            }
            ctx = canvas.getContext('2d');
            if (!ctx) {
                throw new Error('Canvas 2D context not supported');
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            requestRender();
            loadAutoSave();
            startAutoSave();
            enhanceDropHandler();
            initializeMinimap();
        }
        function setupMobileSidebarToggle() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', () => {
                    MobileSpace.toggleSidebar();
                });
            }
        }
        function preloadIcons() {
            let imagesLoaded = 0;
            const totalImages = Object.keys(ICONS).length;
            Object.entries(ICONS).forEach(([type, base64]) => {
                const img = new Image();
                img.src = base64;
                img.onload = () => {
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        requestRender();
                    }
                };
                iconImages[type] = img;
            });
        }
        function resizeCanvas() {
            const container = DOM['canvas-container'];
            if (!container || !canvas || !ctx) return;
            
            const rect = container.getBoundingClientRect();
            
            let dpr = window.devicePixelRatio || 1;
            if (MobileUX.device.isMobile && dpr > 2) {
                dpr = 2;
            }
            
            const maxCanvasSize = MobileUX.device.isMobile ? 4096 : 8192;
            const width = Math.min(rect.width * dpr, maxCanvasSize);
            const height = Math.min(rect.height * dpr, maxCanvasSize);
            
            canvas.width = width;
            canvas.height = height;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            
            appState.canvas.width = rect.width;
            appState.canvas.height = rect.height;
            
            if (MobileUX.device.isMobile) {
                ctx.imageSmoothingEnabled = false;
                ctx.imageSmoothingQuality = 'low';
            }
            
            requestRender();
        }
        class CanvasNode {
            constructor(id, type, x, y, customImageId = null) {
                const config = componentLibrary[type] || { width: 80, height: 80, name: 'Custom' };
                this.id = id;
                this.type = type;
                this.x = x;
                this.y = y;
                this.width = config.width;
                this.height = config.height;
                this.icon = getIconImage(type);
                this.label = config.name;
                this.customName = '';
                this.ipAddresses = [];
                this.domain = '';
                this.port = '';
                this.notes = '';
                this.selected = false;
                this.hovered = false;
                this.customImageId = customImageId;
                this.iconData = ICONS[type] || null;
                if (customImageId && customImages.has(customImageId)) {
                    const customImg = customImages.get(customImageId);
                    this.label = customImg.name.replace(/\.[^/.]+$/, ""); 
                    this.type = 'custom';
                }
            }
            draw(ctx) {
                const s = appState.viewport.scale;
                if (this.selected || this.hovered) {
                    const shadowIntensity = this.selected ? CONSTANTS.COLORS.SHADOW_PRIMARY : CONSTANTS.COLORS.SHADOW_SECONDARY;
                    const shadowBlur = this.selected ? CONSTANTS.DRAWING.SHADOW_BLUR_SELECTED : CONSTANTS.DRAWING.SHADOW_BLUR_HOVERED;
                    setCanvasStyles(ctx, {
                        shadowColor: shadowIntensity,
                        shadowBlur: shadowBlur / s,
                        shadowOffsetX: 0,
                        shadowOffsetY: 2 / s
                    });
                }
                if (this.customImageId && customImages.has(this.customImageId)) {
                    const cachedImg = customImageCache.get(this.customImageId);
                    if (cachedImg && cachedImg.complete) {
                        try {
                            ctx.drawImage(cachedImg, this.x, this.y, this.width, this.height);
                        } catch (e) {
                            this.drawFallbackText(ctx, 'IMG');
                        }
                    } else {
                        this.drawFallbackText(ctx, 'IMG');
                    }
                } else if (this.icon && this.icon.complete) {
                    ctx.drawImage(this.icon, this.x, this.y, this.width, this.height);
                } else {
                    this.drawFallbackText(ctx, this.type);
                }
                setCanvasStyles(ctx, {
                    shadowColor: 'transparent',
                    shadowBlur: 0,
                    shadowOffsetX: 0,
                    shadowOffsetY: 0
                });
                if (this.selected) {
                    const padding = CONSTANTS.DRAWING.SELECTION_PADDING;
                    setCanvasStyles(ctx, {
                        strokeStyle: CONSTANTS.COLORS.PRIMARY_RED,
                        lineWidth: CONSTANTS.DRAWING.LINE_WIDTH_NORMAL / s,
                        lineDash: CONSTANTS.DRAWING.SELECTION_DASH.map(d => d / s)
                    });
                    ctx.strokeRect(this.x - padding, this.y - padding, this.width + padding * 2, this.height + padding * 2);
                    ctx.setLineDash([]);
                }
                this.drawNodeInfo(ctx);
                if (appState.mode === 'connecting' || this.hovered || this.selected) {
                    this.drawConnectionPoints(ctx);
                }
            }
            drawFallbackText(ctx, text) {
                const fontSize = Math.max(10, 14);
                drawText(ctx, text, this.x + this.width/2, this.y + this.height/2, 
                        fontSize, CONSTANTS.COLORS.PRIMARY_RED);
            }
            drawNodeInfo(ctx) {
                const centerX = this.x + this.width / 2;
                const s = appState.viewport.scale;
                let currentY = this.y + this.height + 18 / s;
                const title = this.customName || this.label;
                const lines = this.wrapText(ctx, title, (this.width + 24));
                lines.forEach(line => {
                    drawText(ctx, line, centerX, currentY, 
                            CONSTANTS.DRAWING.TEXT_FONT_SIZE_BASE, 
                            CONSTANTS.COLORS.TEXT_PRIMARY, '600');
                    currentY += CONSTANTS.DRAWING.TEXT_LINE_HEIGHT / s;
                });
                if (this.ipAddresses && this.ipAddresses.length > 0) {
                    const maxDisplayIPs = 6;
                    const displayIPs = this.ipAddresses.slice(0, maxDisplayIPs);
                    displayIPs.forEach(ip => {
                        drawText(ctx, ip, centerX, currentY, 
                                CONSTANTS.DRAWING.TEXT_FONT_SIZE_IP, 
                                CONSTANTS.COLORS.PRIMARY_RED);
                        currentY += CONSTANTS.DRAWING.TEXT_LINE_HEIGHT_IP / s;
                    });
                    if (this.ipAddresses.length > maxDisplayIPs) {
                        const remaining = this.ipAddresses.length - maxDisplayIPs;
                        drawText(ctx, `... +${remaining} más`, centerX, currentY, 
                                CONSTANTS.DRAWING.TEXT_FONT_SIZE_IP - 1, 
                                CONSTANTS.COLORS.TEXT_SECONDARY, '500', 'italic');
                        currentY += CONSTANTS.DRAWING.TEXT_LINE_HEIGHT_IP / s;
                    }
                }
                if (this.domain) {
                    const text = this.domain.length > 30 ? this.domain.slice(0, 27) + '…' : this.domain;
                    drawText(ctx, text, centerX, currentY, 
                            CONSTANTS.DRAWING.TEXT_FONT_SIZE_DOMAIN, 
                            CONSTANTS.COLORS.BLACK, 'italic');
                }
            }
            wrapText(ctx, text, maxWidth) {
                const words = (text || '').split(' ');
                const lines = [];
                let line = '';
                for (const w of words) {
                    const test = line ? line + ' ' + w : w;
                    if (ctx.measureText(test).width > maxWidth) {
                        if (line) lines.push(line);
                        line = w;
                    } else line = test;
                }
                if (line) lines.push(line);
                return lines.slice(0, 2);
            }
            drawConnectionPoints(ctx) {
                const points = this.getConnectionPoints();
                const adaptiveRadius = MobileUX.device.isMobile || MobileUX.device.isTablet ? 
                    MobileUX.adaptive.connectionPointRadius : 8;
                const pointRadius = scaleValue(adaptiveRadius);
                points.forEach(point => {
                    drawCircle(ctx, point.x, point.y, pointRadius, 
                              CONSTANTS.COLORS.CONNECTION_POINT, 
                              CONSTANTS.COLORS.CONNECTION_POINT_STROKE);
                });
            }
            getConnectionPoints() {
                return [
                    { x: this.x + this.width / 2, y: this.y },
                    { x: this.x + this.width, y: this.y + this.height / 2 },
                    { x: this.x + this.width / 2, y: this.y + this.height },
                    { x: this.x, y: this.y + this.height / 2 }
                ];
            }
            isHit(px, py) {
                const basePadding = MobileUX.device.isMobile || MobileUX.device.isTablet ? 
                    MobileUX.adaptive.selectionThreshold : 8;
                const padding = basePadding / appState.viewport.scale;
                return px >= this.x - padding && px <= this.x + this.width + padding &&
                       py >= this.y - padding && py <= this.y + this.height + padding;
            }
            getCenter() {
                return {
                    x: this.x + this.width / 2,
                    y: this.y + this.height / 2
                };
            }
            getEdgePoint(targetX, targetY) {
                const centerX = this.x + this.width / 2;
                const centerY = this.y + this.height / 2;
                const angle = Math.atan2(targetY - centerY, targetX - centerX);
                const halfWidth = this.width / 2;
                const halfHeight = this.height / 2;
                const tanAngle = Math.tan(angle);
                let edgeX, edgeY;
                const absTan = Math.abs(tanAngle);
                if (absTan * halfWidth <= halfHeight) { 
                    if (targetX > centerX) { 
                        edgeX = centerX + halfWidth;
                        edgeY = centerY + halfWidth * tanAngle;
                    } else { 
                        edgeX = centerX - halfWidth;
                        edgeY = centerY - halfWidth * tanAngle;
                    }
                } else { 
                    if (targetY > centerY) { 
                        edgeX = centerX + halfHeight / tanAngle;
                        edgeY = centerY + halfHeight;
                    } else { 
                        edgeX = centerX - halfHeight / tanAngle;
                        edgeY = centerY - halfHeight;
                    }
                }
                return { x: edgeX, y: edgeY };
            }
        }
        class Connector {
            constructor(id, startNodeId, endNodeId) {
                this.id = id;
                this.startNodeId = startNodeId;
                this.endNodeId = endNodeId;
                this.selected = false;
                this.hovered = false;
            }
            draw(ctx, nodes) {
                const startNode = nodes.find(n => n.id === this.startNodeId);
                const endNode = nodes.find(n => n.id === this.endNodeId);
                if (!startNode || !endNode) return;
                const startCenter = startNode.getCenter();
                const endCenter = endNode.getCenter();
                const startEdge = startNode.getEdgePoint(endCenter.x, endCenter.y);
                const endEdge = endNode.getEdgePoint(startCenter.x, startCenter.y);
                const spacing = scaleValue(CONSTANTS.GRID_SPACING);
                const dx = endEdge.x - startEdge.x;
                const dy = endEdge.y - startEdge.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < spacing * 2) return;
                const ux = dx / dist;
                const uy = dy / dist;
                const start = { x: startEdge.x + ux * spacing, y: startEdge.y + uy * spacing };
                const end = { x: endEdge.x - ux * spacing, y: endEdge.y - uy * spacing };
                const color = this.selected ? CONSTANTS.COLORS.PRIMARY_RED : CONSTANTS.COLORS.BLACK;
                const lineWidth = this.selected || this.hovered ? 
                                 CONSTANTS.DRAWING.LINE_WIDTH_SELECTED : 
                                 CONSTANTS.DRAWING.LINE_WIDTH_NORMAL;
                drawLine(ctx, start.x, start.y, end.x, end.y, color, lineWidth, CONSTANTS.DRAWING.DASH_PATTERN);
                this.drawArrowhead(ctx, end, endEdge, color);
            }
            drawArrowhead(ctx, lineEnd, arrowTip, color) {
                const angle = Math.atan2(arrowTip.y - lineEnd.y, arrowTip.x - lineEnd.x);
                const arrowLength = scaleValue(this.selected || this.hovered ? 
                                              CONSTANTS.DRAWING.ARROW_LENGTH_SELECTED : 
                                              CONSTANTS.DRAWING.ARROW_LENGTH_NORMAL);
                const arrowAngle = CONSTANTS.DRAWING.ARROW_ANGLE;
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(arrowTip.x, arrowTip.y);
                ctx.lineTo(
                    arrowTip.x - arrowLength * Math.cos(angle - arrowAngle),
                    arrowTip.y - arrowLength * Math.sin(angle - arrowAngle)
                );
                ctx.lineTo(
                    arrowTip.x - arrowLength * Math.cos(angle + arrowAngle),
                    arrowTip.y - arrowLength * Math.sin(angle + arrowAngle)
                );
                ctx.closePath();
                ctx.fill();
            }
            isHit(px, py, nodes) {
                const startNode = nodes.find(n => n.id === this.startNodeId);
                const endNode = nodes.find(n => n.id === this.endNodeId);
                if (!startNode || !endNode) return false;
                const start = startNode.getCenter();
                const end = endNode.getCenter();
                const baseThreshold = MobileUX.device.isMobile || MobileUX.device.isTablet ? 
                    MobileUX.adaptive.connectionPointThreshold : 12;
                return this.pointToLineDistance(px, py, start.x, start.y, end.x, end.y) < (baseThreshold / appState.viewport.scale);
            }
            getEndpointHit(px, py, nodes, threshold = 15) {
                const startNode = nodes.find(n => n.id === this.startNodeId);
                const endNode = nodes.find(n => n.id === this.endNodeId);
                if (!startNode || !endNode) return null;
                const startEdge = startNode.getEdgePoint(endNode.getCenter().x, endNode.getCenter().y);
                const endEdge = endNode.getEdgePoint(startNode.getCenter().x, startNode.getCenter().y);
                const adaptiveThreshold = MobileUX.device.isMobile || MobileUX.device.isTablet ? 
                    MobileUX.adaptive.connectionPointThreshold : threshold;
                const scaledThreshold = adaptiveThreshold / appState.viewport.scale;
                const startDistanceSq = (px - startEdge.x) ** 2 + (py - startEdge.y) ** 2;
                if (startDistanceSq < scaledThreshold * scaledThreshold) return 'start';
                const endDistanceSq = (px - endEdge.x) ** 2 + (py - endEdge.y) ** 2;
                if (endDistanceSq < scaledThreshold * scaledThreshold) return 'end';
                return null;
            }
            pointToLineDistance(px, py, x1, y1, x2, y2) {
                const A = px - x1;
                const B = py - y1;
                const C = x2 - x1;
                const D = y2 - y1;
                const dot = A * C + B * D;
                const lenSq = C * C + D * D;
                if (lenSq === 0) return Math.sqrt(A * A + B * B);
                const param = Math.max(0, Math.min(1, dot / lenSq));
                const xx = x1 + param * C;
                const yy = y1 + param * D;
                const dx = px - xx;
                const dy = py - yy;
                return Math.sqrt(dx * dx + dy * dy);
            }
        }
        function drawGrid() {
            if (!appState.showGrid) return;
            const s = appState.viewport.scale;
            const grid = appState.gridSize;
            const topLeft = screenToWorld(0, 0);
            const bottomRight = screenToWorld(appState.canvas.width, appState.canvas.height);
            setCanvasStyles(ctx, {
                strokeStyle: CONSTANTS.COLORS.GRID_LINE,
                lineWidth: 1 / s
            });
            const startX = Math.floor(topLeft.x / grid) * grid;
            const startY = Math.floor(topLeft.y / grid) * grid;
            for (let x = startX; x <= bottomRight.x + grid; x += grid) {
                ctx.beginPath(); 
                ctx.moveTo(x, topLeft.y - grid); 
                ctx.lineTo(x, bottomRight.y + grid); 
                ctx.stroke();
            }
            for (let y = startY; y <= bottomRight.y + grid; y += grid) {
                ctx.beginPath();
                ctx.moveTo(topLeft.x - grid, y);
                ctx.lineTo(bottomRight.x + grid, y);
                ctx.stroke();
            }
        }
        function render() {
            try {
                if (!ctx || !canvas) {
                    return;
                }
                ctx.save();
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            const dpr = window.devicePixelRatio || 1;
            ctx.scale(dpr, dpr);
            ctx.translate(appState.viewport.x, appState.viewport.y);
            ctx.scale(appState.viewport.scale, appState.viewport.scale);
            drawGrid();
            appState.connectors.forEach(conn => {
                if (!(appState.interaction.isDraggingConnector && appState.interaction.dragConnector === conn)) {
                    conn.draw(ctx, appState.nodes);
                }
            });
            appState.nodes.forEach(node => {
                node.draw(ctx);
            });
            if (appState.interaction.isDraggingConnector && appState.interaction.dragConnector) {
                const connector = appState.interaction.dragConnector;
                const whichEnd = appState.interaction.dragConnectorEnd;
                const fixedNodeId = whichEnd === 'start' ? connector.endNodeId : connector.startNodeId;
                const fixedNode = appState.nodes.find(n => n.id === fixedNodeId);
                const mousePos = screenToWorld(appState.interaction.lastPointer.x, appState.interaction.lastPointer.y);
                if (fixedNode) {
                    const startPoint = fixedNode.getEdgePoint(mousePos.x, mousePos.y);
                    drawTemporaryLine(startPoint, mousePos);
                }
            } else if (appState.interaction.connectingFrom) {
                 const startNode = appState.interaction.connectingFrom;
                 const startPoint = startNode.getCenter();
                 const mousePos = screenToWorld(appState.interaction.lastPointer.x, appState.interaction.lastPointer.y);
                 drawTemporaryLine(startPoint, mousePos);
            }
            ctx.restore();
            renderMinimap();
            appState.needsRender = false;
            appState.animationFrame = null;
            } catch (error) {
                appState.animationFrame = null;
            }
        }
        function drawTemporaryLine(startPoint, endPoint) {
            ctx.strokeStyle = '#C11b05';
            ctx.lineWidth = 2 / appState.viewport.scale;
            ctx.setLineDash([8 / appState.viewport.scale, 4 / appState.viewport.scale]);
            ctx.beginPath();
            ctx.moveTo(startPoint.x, startPoint.y);
            ctx.lineTo(endPoint.x, endPoint.y);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        function requestRender() {
            try {
                if (appState.animationFrame) return;
                appState.animationFrame = requestAnimationFrame(render);
            } catch (error) {
            }
        }
        function screenToWorld(x, y) {
            return {
                x: (x - appState.viewport.x) / appState.viewport.scale,
                y: (y - appState.viewport.y) / appState.viewport.scale
            };
        }
        function snapToGrid(x, y) {
            if (!appState.snapToGrid) return { x, y };
            const grid = appState.gridSize;
            return {
                x: Math.round(x / grid) * grid,
                y: Math.round(y / grid) * grid
            };
        }
        function findConnectionPointClick(worldX, worldY, excludeNode = null) {
            const isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;
            const connectionPointThreshold = scaleValue(getConnectionPointThreshold(isMobile));
            for (const node of appState.nodes) {
                if (node === excludeNode) continue;
                const connectionPoints = node.getConnectionPoints();
                for (const point of connectionPoints) {
                    const distance = Math.sqrt(Math.pow(worldX - point.x, 2) + Math.pow(worldY - point.y, 2));
                    if (distance <= connectionPointThreshold) {
                        return { node, point };
                    }
                }
            }
            return null;
        }
        function clearAllSelections() {
            appState.nodes.forEach(node => {
                node.selected = false;
                node.hovered = false;
            });
            appState.connectors.forEach(conn => {
                conn.selected = false;
            });
        }
        function getSelectedElements() {
            const selectedNodes = appState.nodes.filter(node => node.selected);
            const selectedConnectors = appState.connectors.filter(conn => {
                const startNode = appState.nodes.find(n => n.id === conn.startNodeId);
                const endNode = appState.nodes.find(n => n.id === conn.endNodeId);
                return startNode && endNode && startNode.selected && endNode.selected;
            });
            return { nodes: selectedNodes, connectors: selectedConnectors };
        }
        function showToast(message, type = 'info', duration = 3000) {
            const container = getDOMElement('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                success: '✅',
                error: '❌', 
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            const icon = iconMap[type] || iconMap.info;
            
            toast.innerHTML = `
                <span class="toast-icon">${icon}</span>
                <span>${message || 'Mensaje sin contenido'}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }
        function updateStatusIndicator(message, isActive = true) {
            const indicator = getDOMElement('statusIndicator');
            if (!indicator) return;
            const dot = indicator.querySelector('.status-dot');
            const text = indicator.querySelector('span');
            if (text) text.textContent = message;
            if (dot) dot.style.background = isActive ? '#28a745' : '#6c757d';
        }
        function validateAppState() {
            const errors = [];
            if (!appState.nodes) errors.push('Nodos no inicializados');
            if (!appState.connectors) errors.push('Conectores no inicializados');
            if (!appState.viewport) errors.push('Viewport no inicializado');
            appState.connectors.forEach((conn, index) => {
                const startNode = appState.nodes.find(n => n.id === conn.startNodeId);
                const endNode = appState.nodes.find(n => n.id === conn.endNodeId);
                if (!startNode || !endNode) {
                    errors.push(`Conector ${index} tiene referencias inválidas`);
                }
            });
            if (errors.length > 0) {
                return false;
            }
            return true;
        }
        function showHelp() {
            const helpOverlay = getDOMElement('helpOverlay');
            if (!helpOverlay) {
                return;
            }
            helpOverlay.style.display = 'flex';
            setTimeout(() => {
                helpOverlay.classList.add('show');
            }, 10);
        }
        function hideHelp() {
            const helpOverlay = getDOMElement('helpOverlay');
            if (!helpOverlay) {
                return;
            }
            
            helpOverlay.classList.remove('show');
            
            setTimeout(() => {
                if (!helpOverlay.classList.contains('show')) {
                    helpOverlay.style.display = 'none';
                }
            }, 300);
            
        }
        function initializeHelpSystem() {
            const helpOverlay = getDOMElement('helpOverlay');
            if (!helpOverlay) {
                return;
            }
            
            const helpSystem = {
                overlay: helpOverlay,
                searchInput: helpOverlay.querySelector('#helpSearch'),
                noResults: helpOverlay.querySelector('#no-results'),
                sections: helpOverlay.querySelectorAll('.help-section')
            };
            
            helpSystem.sections.forEach(section => {
                section._searchText = section.textContent.toLowerCase();
                const elements = section.querySelectorAll('h3, h4, p, li, td');
                elements.forEach(el => {
                    el._originalText = el.innerHTML;
                });
            });
            
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func.apply(this, args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            function performSearch() {
                if (!helpSystem.searchInput) return;
                const searchTerm = helpSystem.searchInput.value.toLowerCase().trim();
                if (!searchTerm) {
                    clearSearch();
                    return;
                }
                
                requestAnimationFrame(() => {
                    let hasResults = false;
                    const searchWords = searchTerm.split(/\s+/).filter(word => word.length > 0);
                    
                    helpSystem.sections.forEach(section => {
                        const sectionText = (section._searchText || (section._searchText = section.textContent.toLowerCase()));
                        
                        const isMatch = searchWords.every(word => sectionText.includes(word));
                        
                        if (isMatch) {
                            section.style.display = 'block';
                            hasResults = true;
                            
                            const elements = section.querySelectorAll('h3, h4, p, li, td');
                            elements.forEach(el => {
                                const originalText = el._originalText || (el._originalText = el.innerHTML);
                                let highlightedText = originalText;
                                searchWords.forEach(word => {
                                    const regex = new RegExp(`(${word})`, 'gi');
                                    highlightedText = highlightedText.replace(regex, '<mark style="background: #ffeb3b; padding: 2px; border-radius: 2px;">$1</mark>');
                                });
                                el.innerHTML = highlightedText;
                            });
                        } else {
                            section.style.display = 'none';
                        }
                    });
                    
                    if (helpSystem.noResults) {
                        helpSystem.noResults.style.display = hasResults ? 'none' : 'block';
                    }
                });
            }
            function clearSearch() {
                if (helpSystem.noResults) {
                    helpSystem.noResults.style.display = 'none';
                }
                helpSystem.sections.forEach(section => {
                    section.style.display = 'block';
                    
                    const elements = section.querySelectorAll('h3, h4, p, li, td');
                    elements.forEach(el => {
                        if (el._originalText) {
                            el.innerHTML = el._originalText;
                        }
                    });
                });
            }
            const debouncedSearch = debounce(performSearch, 150);
            if (helpSystem.searchInput) {
                helpSystem.searchInput.addEventListener('input', debouncedSearch);
                helpSystem.searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        helpSystem.searchInput.value = '';
                        clearSearch();
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        performSearch();
                    }
                });
                
                helpSystem.searchInput.addEventListener('focus', () => {
                    if (helpSystem.searchInput.value) {
                        performSearch();
                    }
                });
            }
            document.addEventListener('click', (e) => {
                if (helpSystem.overlay.classList.contains('show') && 
                    !helpSystem.overlay.querySelector('.help-content').contains(e.target)) {
                    hideHelp();
                }
            });
            if (window.innerWidth <= 768) {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && 
                            mutation.attributeName === 'class' && 
                            helpSystem.overlay.classList.contains('show')) {
                            document.body.style.overflow = 'hidden';
                        } else if (mutation.type === 'attributes' && 
                                   mutation.attributeName === 'class' && 
                                   !helpSystem.overlay.classList.contains('show')) {
                            document.body.style.overflow = '';
                        }
                    });
                });
                observer.observe(helpSystem.overlay, {
                    attributes: true,
                    attributeFilter: ['class']
                });
            }
        }
        function setupEventListeners() {
            document.querySelectorAll('.tool-button[data-type]').forEach(btn => {
                btn.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.currentTarget.dataset.type);
                });
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = e.currentTarget.dataset.type;
                    if (!componentLibrary[type]) return;
                    const canvasRect = canvas.getBoundingClientRect();
                    const centerX = canvasRect.width / 2;
                    const centerY = canvasRect.height / 2;
                    const world = screenToWorld(centerX, centerY);
                    const config = componentLibrary[type];
                    const pos = snapToGrid(world.x - config.width/2, world.y - config.height/2);
                    saveState(); 
                    const node = new CanvasNode(appState.nextId++, type, pos.x, pos.y);
                    appState.nodes.push(node);
                    requestRender();
                });
            });
            document.querySelectorAll('[data-action]').forEach(btn => {
                btn.addEventListener('click', (e) => handleAction(e.currentTarget.dataset.action));
            });
            canvas.addEventListener('pointerdown', handlePointerDown);
            canvas.addEventListener('pointermove', handlePointerMove);
            canvas.addEventListener('pointerup', handlePointerUp);
            canvas.addEventListener('dblclick', handleDoubleClick);
            canvas.addEventListener('dragover', (e) => e.preventDefault());
            canvas.addEventListener('drop', handleDrop);
            canvas.addEventListener('wheel', handleWheel, { passive: false });
            const eventMappings = {
                zoomIn: { click: () => zoomCanvas(1.2) },
                zoomOut: { click: () => zoomCanvas(0.8) },
                zoomFit: { click: fitCanvas },
                gridToggle: { click: toggleGrid },
                snapToggle: { click: toggleSnap },
                forceToggle: { click: toggleForceLayout },
                saveBtn: { click: saveCanvas },
                loadBtn: { click: loadCanvas },
                exportBtn: { click: exportCanvas },
                helpBtn: { click: showHelp },
                helpClose: { click: hideHelp },
                cancelEdit: { click: closeModal },
                saveEdit: { click: saveNodeEdit },
                mobileMenuToggle: { click: toggleMobileMenu },
                searchBox: { input: handleSearch }
            };
            Object.entries(eventMappings).forEach(([elementId, events]) => {
                addEventListeners(elementId, events);
            });
            
            // Additional safety check for help button
            const helpBtn = getDOMElement('helpBtn');
            if (helpBtn && !helpBtn.hasAttribute('data-help-listener')) {
                helpBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showHelp();
                });
                helpBtn.setAttribute('data-help-listener', 'true');
            }
            document.addEventListener('keydown', handleKeyDown);
            
            if (DOM.nodeIP) {
                DOM.nodeIP.addEventListener('input', (e) => {
                    try {
                        const text = e.target.value || '';
                        if (text.length > 10000) {
                            e.target.value = text.substring(0, 10000);
                            showToast('Máximo 10,000 caracteres permitidos', 'warning');
                            return;
                        }
                        
                        const ips = text.split(/[\r\n,;]+/).map(ip => ip.trim()).filter(ip => ip.length > 0);
                        if (ips.length > 50) {
                            showToast('Máximo 50 IPs permitidas', 'warning');
                        }
                        
                        const validIPs = ips.filter(ip => validateIP(ip));
                        const invalidCount = ips.length - validIPs.length;
                        
                        if (ips.length > 0) {
                            e.target.style.borderColor = invalidCount > 0 ? '#f39c12' : '#27ae60';
                            e.target.title = invalidCount > 0 
                                ? `${validIPs.length} IPs válidas, ${invalidCount} inválidas` 
                                : `${validIPs.length} IP${validIPs.length !== 1 ? 's' : ''} válida${validIPs.length !== 1 ? 's' : ''}`;
                        } else {
                            e.target.style.borderColor = '';
                            e.target.title = '';
                        }
                    } catch (error) {
                        e.target.style.borderColor = '#e74c3c';
                        e.target.title = 'Error en validación';
                    }
                });
            }
        }
        function handleAction(action) {
            if (action === 'deleteAll') {
                deleteAllElements();
                return;
            }
            const modes = ['connect', 'pan', 'delete'];
            const targetMode = action === 'connect' ? 'connecting' : action === 'delete' ? 'deleting' : action === 'pan' ? 'panning' : action;
            if (modes.includes(action)) {
                 appState.mode = appState.mode === targetMode ? 'normal' : targetMode;
            }
            updateModeIndicator();
            updateToolbarStates();
            updateCanvasCursor();
            requestRender();
        }
        function handlePointerDown(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const px = e.clientX - rect.left;
            const py = e.clientY - rect.top;
            const world = screenToWorld(px, py);
            appState.interaction.dragStart = { x: world.x, y: world.y };
            appState.interaction.lastPointer = { x: px, y: py };
            if (appState.mode === 'deleting') {
                const clickedNode = appState.nodes.find(node => node.isHit(world.x, world.y));
                if (clickedNode) { deleteElement(clickedNode); return; }
                const clickedConnector = appState.connectors.find(conn => conn.isHit(world.x, world.y, appState.nodes));
                if (clickedConnector) { deleteElement(clickedConnector); return; }
                return;
            }
            if (appState.mode === 'connecting') {
                const connectionPointHit = findConnectionPointClick(world.x, world.y);
                let clickedNode = connectionPointHit ? connectionPointHit.node : null;
                if (!clickedNode) {
                    clickedNode = appState.nodes.find(node => node.isHit(world.x, world.y));
                }
                if(clickedNode) {
                    if (!appState.interaction.connectingFrom) {
                        appState.interaction.connectingFrom = clickedNode;
                        clickedNode.hovered = true; 
                    } else if (appState.interaction.connectingFrom !== clickedNode) {
                        const existingConnection = appState.connectors.find(conn => 
                            (conn.startNodeId === appState.interaction.connectingFrom.id && conn.endNodeId === clickedNode.id) ||
                            (conn.startNodeId === clickedNode.id && conn.endNodeId === appState.interaction.connectingFrom.id)
                        );
                        if (!existingConnection) {
                            saveState(); 
                            const connector = new Connector(appState.nextId++, appState.interaction.connectingFrom.id, clickedNode.id);
                            appState.connectors.push(connector);
                            connector.selected = true;
                            setTimeout(() => {
                                connector.selected = false;
                                requestRender();
                            }, 500);
                        }
                        appState.interaction.connectingFrom.hovered = false;
                        appState.interaction.connectingFrom = null;
                    } else {
                        appState.interaction.connectingFrom.hovered = false;
                        appState.interaction.connectingFrom = null;
                    }
                } else {
                    if (appState.interaction.connectingFrom) {
                        appState.interaction.connectingFrom.hovered = false;
                        appState.interaction.connectingFrom = null;
                    }
                }
                requestRender();
                return;
            }
            if (appState.mode === 'panning' || e.button === 1) {
                appState.interaction.isPanning = true;
                appState.interaction.dragStart = { x: px, y: py };
                canvas.style.cursor = 'grabbing';
                return;
            }
            const selectedConnectionPointHit = findConnectionPointClick(world.x, world.y);
            if (selectedConnectionPointHit && selectedConnectionPointHit.node.selected) {
                appState.mode = 'connecting';
                appState.interaction.connectingFrom = selectedConnectionPointHit.node;
                selectedConnectionPointHit.node.hovered = true;
                updateModeIndicator();
                updateToolbarStates();
                updateCanvasCursor();
                requestRender();
                return;
            }
            for (const conn of appState.connectors) {
                const endpoint = conn.getEndpointHit(world.x, world.y, appState.nodes);
                if (endpoint) {
                    appState.interaction.isDraggingConnector = true;
                    appState.interaction.dragConnector = conn;
                    appState.interaction.dragConnectorEnd = endpoint;
                    appState.interaction.originalConnectorNodeId = endpoint === 'start' ? conn.startNodeId : conn.endNodeId;
                    requestRender();
                    return;
                }
            }
            const clickedNode = [...appState.nodes].reverse().find(node => node.isHit(world.x, world.y));
            if (clickedNode) {
                appState.interaction.isDragging = true;
                appState.interaction.dragElement = clickedNode;
                if (appState.isForceLayoutActive) {
                    forceSimulation.running = false;
                    if (forceSimulation.animationId) {
                        cancelAnimationFrame(forceSimulation.animationId);
                        forceSimulation.animationId = null;
                    }
                }
                if (!clickedNode.selected) {
                    clearSelection();
                    selectElement(clickedNode);
                }
            } else {
                clearSelection();
            }
            requestRender();
        }
        function handlePointerMove(e) {
            const rect = canvas.getBoundingClientRect();
            const px = e.clientX - rect.left;
            const py = e.clientY - rect.top;
            const world = screenToWorld(px, py);
            const dx = (px - appState.interaction.lastPointer.x);
            const dy = (py - appState.interaction.lastPointer.y);
            appState.interaction.lastPointer = { x: px, y: py };
            if (appState.interaction.isPanning || (appState.mode === 'panning' && e.buttons === 1)) {
                if (!appState.interaction.isPanning && appState.mode === 'panning') {
                    appState.interaction.isPanning = true;
                    canvas.style.cursor = 'grabbing';
                }
                appState.viewport.x += dx;
                appState.viewport.y += dy;
            } else if (appState.interaction.isDragging && appState.interaction.dragElement) {
                const scaledDx = dx / appState.viewport.scale;
                const scaledDy = dy / appState.viewport.scale;
                appState.interaction.dragElement.x += scaledDx;
                appState.interaction.dragElement.y += scaledDy;
            } else if (appState.interaction.isDraggingConnector || appState.interaction.connectingFrom) {
            } else {
                updateHover(world.x, world.y);
            }
            requestRender();
        }
        function handlePointerUp(e) {
            if (appState.interaction.isDragging) {
                if (appState.snapToGrid) {
                    const el = appState.interaction.dragElement;
                    const snapped = snapToGrid(el.x + el.width/2, el.y + el.height/2);
                    el.x = snapped.x - el.width/2;
                    el.y = snapped.y - el.height/2;
                }
                saveState();
            }
            if (appState.interaction.isDraggingConnector) {
                const world = screenToWorld(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top);
                const targetNode = appState.nodes.find(n => n.isHit(world.x, world.y));
                const connector = appState.interaction.dragConnector;
                const whichEnd = appState.interaction.dragConnectorEnd;
                if (targetNode && (whichEnd === 'start' ? targetNode.id !== connector.endNodeId : targetNode.id !== connector.startNodeId)) {
                    if (whichEnd === 'start') connector.startNodeId = targetNode.id;
                    else connector.endNodeId = targetNode.id;
                } else {
                    if (whichEnd === 'start') connector.startNodeId = appState.interaction.originalConnectorNodeId;
                    else connector.endNodeId = appState.interaction.originalConnectorNodeId;
                }
            }
            if (appState.mode === 'connecting' && appState.interaction.connectingFrom) {
                const rect = canvas.getBoundingClientRect();
                const world = getWorldCoordinatesFromEvent(e, rect);
                const connectionPointHit = findConnectionPointClick(world.x, world.y, appState.interaction.connectingFrom);
                let targetNode = connectionPointHit ? connectionPointHit.node : null;
                if (!targetNode) {
                    targetNode = appState.nodes.find(node => 
                        node !== appState.interaction.connectingFrom && node.isHit(world.x, world.y)
                    );
                }
                if (targetNode) {
                    const existingConnection = appState.connectors.find(conn => 
                        (conn.startNodeId === appState.interaction.connectingFrom.id && conn.endNodeId === targetNode.id) ||
                        (conn.startNodeId === targetNode.id && conn.endNodeId === appState.interaction.connectingFrom.id)
                    );
                    if (!existingConnection) {
                        saveState(); 
                        const connector = new Connector(appState.nextId++, appState.interaction.connectingFrom.id, targetNode.id);
                        appState.connectors.push(connector);
                        connector.selected = true;
                        setTimeout(() => {
                            connector.selected = false;
                            requestRender();
                        }, 500);
                    }
                }
                appState.interaction.connectingFrom.hovered = false;
                appState.interaction.connectingFrom = null;
            }
            appState.interaction.isDragging = false;
            appState.interaction.dragElement = null;
            appState.interaction.isPanning = false;
            appState.interaction.isDraggingConnector = false;
            appState.interaction.dragConnector = null;
            if (appState.isForceLayoutActive && !forceSimulation.running) {
                forceSimulation.running = true;
                forceStep();
            }
            updateCanvasCursor();
            requestRender();
        }
        function handleDoubleClick(e) {
            if (appState.mode !== 'normal') return;
            const rect = canvas.getBoundingClientRect();
            const world = getWorldCoordinatesFromEvent(e, rect);
            const clickedNode = appState.nodes.find(node => node.isHit(world.x, world.y));
            if (clickedNode) {
                editNode(clickedNode);
            }
        }
        function handleWheel(e) {
            e.preventDefault();
            const factor = e.deltaY > 0 ? 0.9 : 1.1;
            zoomCanvas(factor, e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top);
        }
        function handleDrop(e) {
            e.preventDefault();
            const type = e.dataTransfer.getData('text/plain');
            if (!componentLibrary[type]) return;
            const rect = canvas.getBoundingClientRect();
            const world = screenToWorld(e.clientX - rect.left, e.clientY - rect.top);
            const config = componentLibrary[type];
            const pos = snapToGrid(world.x - config.width/2, world.y - config.height/2);
            saveState(); 
            const node = new CanvasNode(appState.nextId++, type, pos.x, pos.y);
            appState.nodes.push(node);
            requestRender();
        }
        function handleKeyDown(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            if (e.key === 'Delete' || e.key === 'Backspace') {
                deleteSelectedElements();
            } else if (e.key === 'F1') {
                e.preventDefault();
                showHelp();
                return;
            } else if (e.key === 'Escape') {
                // Close help overlay if open
                const helpOverlay = getDOMElement('helpOverlay');
                if (helpOverlay && helpOverlay.classList.contains('show')) {
                    hideHelp();
                    return;
                }
                appState.mode = 'normal';
                appState.interaction.isPanning = false;
                if (appState.interaction.connectingFrom) {
                    appState.interaction.connectingFrom.hovered = false;
                    appState.interaction.connectingFrom = null;
                }
                updateModeIndicator();
                updateToolbarStates();
                updateCanvasCursor();
                requestRender();
            } else if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                } else if (e.key === 'y' || (e.key === 'z' && e.shiftKey)) {
                    e.preventDefault();
                    redo();
                } else if (e.key === 'c') {
                    e.preventDefault();
                    copySelectedElements();
                } else if (e.key === 'v') {
                    e.preventDefault();
                    pasteElements();
                } else if (e.key === 'u') {
                    e.preventDefault();
                    getDOMElement('customUploadBtn').click();
                }
            }
        }
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            document.querySelectorAll('.tool-button[data-type]').forEach(button => {
                const name = button.querySelector('span').textContent.toLowerCase();
                button.classList.toggle('hidden', !name.includes(searchTerm));
            });
        }
        function clearSelection() {
            appState.selectedElements.forEach(el => el.selected = false);
            appState.selectedElements = [];
        }
        function selectElement(element) {
            element.selected = true;
            appState.selectedElements.push(element);
        }
        function updateHover(x, y) {
            let newHovered = null;
            const hoveredNode = [...appState.nodes].reverse().find(node => node.isHit(x, y));
            if (hoveredNode) {
                newHovered = hoveredNode;
            } else {
                const hoveredConnector = appState.connectors.find(conn => conn.isHit(x, y, appState.nodes));
                if (hoveredConnector) newHovered = hoveredConnector;
            }
            if (appState.hoveredElement !== newHovered) {
                if(appState.hoveredElement) appState.hoveredElement.hovered = false;
                appState.hoveredElement = newHovered;
                if(appState.hoveredElement) appState.hoveredElement.hovered = true;
                requestRender();
            }
        }
        function deleteElement(element) {
            saveState(); 
            if (element instanceof CanvasNode) {
                appState.connectors = appState.connectors.filter(
                    conn => conn.startNodeId !== element.id && conn.endNodeId !== element.id
                );
                appState.nodes = appState.nodes.filter(node => node.id !== element.id);
            } else if (element instanceof Connector) {
                appState.connectors = appState.connectors.filter(conn => conn.id !== element.id);
            }
            appState.selectedElements = appState.selectedElements.filter(el => el.id !== element.id);
            requestRender();
        }
        function deleteSelectedElements() {
            [...appState.selectedElements].forEach(deleteElement);
            clearSelection();
        }
        function deleteAllElements() {
            if (appState.nodes.length === 0 && appState.connectors.length === 0) return;
            if (confirm('¿Estás seguro de que quieres eliminar TODOS los elementos? Esta acción no se puede deshacer.')) {
                appState.nodes = [];
                appState.connectors = [];
                appState.selectedElements = [];
                appState.hoveredElement = null;
                appState.nextId = 1;
                requestRender();
            }
        }
        function editNode(node) {
            setFormValues({
                nodeName: node.customName,
                nodeIP: formatIPsForDisplay(node.ipAddresses),
                nodeDomain: node.domain,
                nodePort: node.port,
                nodeNotes: node.notes
            });
            DOM.editModal.classList.add('show');
            DOM.editModal.dataset.nodeId = node.id;
        }
        function closeModal() {
            DOM.editModal.classList.remove('show');
        }
        function saveNodeEdit() {
            const nodeId = parseInt(DOM.editModal.dataset.nodeId);
            const node = appState.nodes.find(n => n.id === nodeId);
            if (node) {
                const formValues = getFormValues(['nodeName', 'nodeIP', 'nodeDomain', 'nodePort', 'nodeNotes']);
                node.customName = formValues.nodeName;
                node.ipAddresses = parseMultipleIPs(formValues.nodeIP);
                node.domain = formValues.nodeDomain;
                node.port = formValues.nodePort;
                node.notes = formValues.nodeNotes;
                
                if (formValues.nodeIP && formValues.nodeIP.trim()) {
                    const validCount = node.ipAddresses.length;
                    const inputCount = formValues.nodeIP.split(/[\r\n,;]+/).filter(ip => ip.trim().length > 0).length;
                    if (validCount < inputCount) {
                        showToast(`${validCount} IPs válidas guardadas de ${inputCount} ingresadas`, 'warning');
                    } else if (validCount > 0) {
                        showToast(`${validCount} IP${validCount > 1 ? 's' : ''} guardada${validCount > 1 ? 's' : ''}`, 'success');
                    }
                }
                
                requestRender();
            }
            closeModal();
        }
        function updateModeIndicator() {
            // Textos largos para desktop
            const modesDesktop = {
                normal: 'Modo Normal',
                connecting: 'Modo Conectar - Haga clic en nodos para conectar (ESC para salir)',
                panning: 'Modo Mover Vista - Arrastre para mover el lienzo (ESC para salir)',
                deleting: 'Modo Borrar - Haga clic en elementos para eliminar (ESC para salir)'
            };
            
            // Textos cortos para móvil
            const modesMobile = {
                normal: 'Normal',
                connecting: '🔗 Conectar',
                panning: '✋ Mover',
                deleting: '🗑️ Borrar'
            };
            
            // Detectar si es móvil basado en viewport width
            const isMobile = window.innerWidth <= 768;
            const modes = isMobile ? modesMobile : modesDesktop;
            
            // Animación suave al cambiar texto (respetando preferencias de movimiento)
            const newText = modes[appState.mode] || (isMobile ? 'Normal' : 'Modo Normal');
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            
            if (DOM.modeIndicator.textContent !== newText) {
                if (!prefersReducedMotion) {
                    DOM.modeIndicator.style.transform = 'scale(0.95)';
                    DOM.modeIndicator.style.opacity = '0.7';
                    
                    setTimeout(() => {
                        DOM.modeIndicator.textContent = newText;
                        DOM.modeIndicator.style.transform = 'scale(1)';
                        DOM.modeIndicator.style.opacity = '1';
                    }, 150);
                } else {
                    // Sin animación para usuarios que prefieren movimiento reducido
                    DOM.modeIndicator.textContent = newText;
                }
            }
            
            DOM.modeIndicator.className = `mode-indicator ${appState.mode}`;
            
            // Agregar atributo para accesibilidad
            DOM.modeIndicator.setAttribute('aria-label', modesDesktop[appState.mode] || 'Modo Normal');
        }
        
        // Actualizar mode-indicator en cambios de orientación
        window.addEventListener('resize', () => {
            // Debounce para evitar múltiples actualizaciones
            clearTimeout(window.modeIndicatorTimeout);
            window.modeIndicatorTimeout = setTimeout(() => {
                updateModeIndicator();
            }, 100);
        });
        function updateToolbarStates() {
            document.querySelectorAll('.tool-button[data-action]').forEach(btn => {
                const action = btn.dataset.action;
                const isActive = (action === 'connect' && appState.mode === 'connecting') ||
                                 (action === 'pan' && appState.mode === 'panning') ||
                                 (action === 'delete' && appState.mode === 'deleting');
                btn.classList.toggle('active', isActive);
            });
        }
        function updateCanvasCursor() {
            canvas.className = 'main-canvas';
            if (appState.mode !== 'normal') {
                canvas.classList.add(appState.mode);
            }
        }
        function toggleGrid() {
            appState.showGrid = !appState.showGrid;
            DOM.gridToggle.classList.toggle('active', appState.showGrid);
            requestRender();
        }
        function toggleSnap() {
            appState.snapToGrid = !appState.snapToGrid;
            DOM.snapToggle.classList.toggle('active', appState.snapToGrid);
        }
        let forceSimulation = {
            running: false,
            animationId: null,
            alpha: 1.0,
            alphaDecay: 0.0228,
            alphaMin: 0.001,
            velocityDecay: 0.4,
            forces: {
                link: { strength: 0.5, distance: 150 }, // Increased link distance
                charge: { strength: -800 }, // Increased repulsion strength
                center: { strength: 0.1 },
                collision: { strength: 0.7, iterations: 3 } // New collision force
            },
            nodeClassification: {
                connected: [],
                isolated: [],
                lastClassificationUpdate: 0
            }
        };
        function calculateNodeDimensions(node) {
            const baseWidth = node.width || 80;
            const baseHeight = node.height || 80;
            const margin = 25;
            const textHeight = 50; // Approximate height for node text
            return {
                width: baseWidth + margin,
                height: baseHeight + textHeight + margin,
                centerX: node.x + baseWidth / 2,
                centerY: node.y + baseHeight / 2
            };
        }
        function nodesOverlap(node1, node2, minDistance = null) {
            const dim1 = calculateNodeDimensions(node1);
            const dim2 = calculateNodeDimensions(node2);
            const dx = node1.x - node2.x;
            const dy = node1.y - node2.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const minSafeDistance = minDistance || (Math.max(dim1.width, dim1.height) + Math.max(dim2.width, dim2.height)) / 2;
            return distance < minSafeDistance;
        }
        function resolveCollision(node1, node2) {
            const dx = node2.x - node1.x;
            const dy = node2.y - node1.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            if (distance === 0) {
                distance = 0.1;
                const angle = Math.random() * Math.PI * 2;
                node1.x += Math.cos(angle) * 5;
                node1.y += Math.sin(angle) * 5;
                node2.x -= Math.cos(angle) * 5;
                node2.y -= Math.sin(angle) * 5;
                return;
            }
            const dim1 = calculateNodeDimensions(node1);
            const dim2 = calculateNodeDimensions(node2);
            const minDistance = (Math.max(dim1.width, dim1.height) + Math.max(dim2.width, dim2.height)) / 2;
            if (distance < minDistance) {
                const overlap = minDistance - distance;
                const separationForce = overlap * 0.5;
                const fx = (dx / distance) * separationForce;
                const fy = (dy / distance) * separationForce;
                node1.fx -= fx;
                node1.fy -= fy;
                node2.fx += fx;
                node2.fy += fy;
            }
        }
        function classifyNodes() {
            const connected = new Set();
            appState.connectors.forEach(conn => {
                connected.add(conn.startNodeId);
                connected.add(conn.endNodeId);
            });
            const connectedNodes = appState.nodes.filter(node => connected.has(node.id));
            const isolatedNodes = appState.nodes.filter(node => !connected.has(node.id));
            forceSimulation.nodeClassification.connected = connectedNodes;
            forceSimulation.nodeClassification.isolated = isolatedNodes;
            forceSimulation.nodeClassification.lastClassificationUpdate = Date.now();
            return {
                connected: connectedNodes,
                isolated: isolatedNodes
            };
        }
        function positionIsolatedNodes() {
            const { connected, isolated } = forceSimulation.nodeClassification;
            if (isolated.length === 0) return;
            let connectedBounds = {
                minY: Infinity,
                maxY: -Infinity
            };
            if (connected.length > 0) {
                connected.forEach(node => {
                    const dim = calculateNodeDimensions(node);
                    connectedBounds.minY = Math.min(connectedBounds.minY, node.y);
                    connectedBounds.maxY = Math.max(connectedBounds.maxY, node.y + dim.height);
                });
            } else {
                const centerY = appState.canvas.height / (2 * appState.viewport.scale) - appState.viewport.y / appState.viewport.scale;
                connectedBounds.minY = centerY - 100;
                connectedBounds.maxY = centerY + 100;
            }
            const margin = 200; // Increased gap between zones
            const sampleNode = isolated[0];
            const nodeDim = calculateNodeDimensions(sampleNode);
            const nodeSpacingX = Math.max(130, nodeDim.width + 20); // Ensure minimum spacing based on node size
            const nodeSpacingY = Math.max(130, nodeDim.height + 20); // Ensure minimum spacing based on node size
            const nodesPerRow = Math.max(1, Math.ceil(Math.sqrt(isolated.length * 1.2))); // More rectangular grid
            const startY = connectedBounds.maxY + margin;
            const centerX = appState.canvas.width / (2 * appState.viewport.scale) - appState.viewport.x / appState.viewport.scale;
            isolated.forEach((node, index) => {
                const row = Math.floor(index / nodesPerRow);
                const col = index % nodesPerRow;
                const rowWidth = Math.min(isolated.length - row * nodesPerRow, nodesPerRow);
                const rowStartX = centerX - ((rowWidth - 1) * nodeSpacingX) / 2;
                node.targetX = rowStartX + col * nodeSpacingX;
                node.targetY = startY + row * nodeSpacingY;
                if (node.targetX !== undefined && node.targetY !== undefined) {
                    const dx = node.targetX - node.x;
                    const dy = node.targetY - node.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance > 8) { // Slightly increased threshold for better settling
                        const force = 0.15 * forceSimulation.alpha; // Slightly stronger positioning force
                        node.fx += dx * force;
                        node.fy += dy * force;
                    } else {
                        node.vx *= 0.3;
                        node.vy *= 0.3;
                    }
                }
            });
            for (let i = 0; i < isolated.length; i++) {
                for (let j = i + 1; j < isolated.length; j++) {
                    if (nodesOverlap(isolated[i], isolated[j])) {
                        resolveCollision(isolated[i], isolated[j]);
                    }
                }
            }
        }
        function initForceLayout() {
            classifyNodes();
            appState.nodes.forEach(node => {
                if (!node.vx) node.vx = 0;
                if (!node.vy) node.vy = 0;
                delete node.targetX;
                delete node.targetY;
            });
        }
        function applyForces() {
            const nodes = appState.nodes;
            const connectors = appState.connectors;
            const { connected, isolated } = forceSimulation.nodeClassification;
            nodes.forEach(node => {
                node.fx = 0;
                node.fy = 0;
            });
            if (connected.length > 0) {
                const centerX = appState.canvas.width / (2 * appState.viewport.scale) - appState.viewport.x / appState.viewport.scale;
                const centerY = appState.canvas.height / (2 * appState.viewport.scale) - appState.viewport.y / appState.viewport.scale;
                connected.forEach(node => {
                    const dx = centerX - node.x;
                    const dy = centerY - node.y;
                    node.fx += dx * forceSimulation.forces.center.strength * forceSimulation.alpha;
                    node.fy += dy * forceSimulation.forces.center.strength * forceSimulation.alpha;
                });
                for (let i = 0; i < connected.length; i++) {
                    for (let j = i + 1; j < connected.length; j++) {
                        const node1 = connected[i];
                        const node2 = connected[j];
                        const dx = node2.x - node1.x;
                        const dy = node2.y - node1.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance === 0) {
                            distance = 0.1;
                            const angle = Math.random() * Math.PI * 2;
                            node1.x += Math.cos(angle) * 10;
                            node1.y += Math.sin(angle) * 10;
                        }
                        if (distance > 0) {
                            const dim1 = calculateNodeDimensions(node1);
                            const dim2 = calculateNodeDimensions(node2);
                            const minDistance = (Math.max(dim1.width, dim1.height) + Math.max(dim2.width, dim2.height)) / 2;
                            let repulsionForce = forceSimulation.forces.charge.strength * forceSimulation.alpha / (distance * distance);
                            if (distance < minDistance) {
                                const collisionMultiplier = Math.max(2, minDistance / distance);
                                repulsionForce *= collisionMultiplier;
                            }
                            const fx = repulsionForce * dx / distance;
                            const fy = repulsionForce * dy / distance;
                            node1.fx -= fx;
                            node1.fy -= fy;
                            node2.fx += fx;
                            node2.fy += fy;
                            if (nodesOverlap(node1, node2)) {
                                resolveCollision(node1, node2);
                            }
                        }
                    }
                }
                connectors.forEach(connector => {
                    const source = nodes.find(n => n.id === connector.startNodeId);
                    const target = nodes.find(n => n.id === connector.endNodeId);
                    if (source && target) {
                        const dx = target.x - source.x;
                        const dy = target.y - source.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance === 0) {
                            distance = 0.1;
                        }
                        if (distance > 0) {
                            const sourceDim = calculateNodeDimensions(source);
                            const targetDim = calculateNodeDimensions(target);
                            const minSafeDistance = (Math.max(sourceDim.width, sourceDim.height) + Math.max(targetDim.width, targetDim.height)) / 2;
                            const targetDistance = Math.max(forceSimulation.forces.link.distance, minSafeDistance + 20);
                            const force = (distance - targetDistance) * forceSimulation.forces.link.strength * forceSimulation.alpha;
                            const fx = force * dx / distance;
                            const fy = force * dy / distance;
                            source.fx += fx;
                            source.fy += fy;
                            target.fx -= fx;
                            target.fy -= fy;
                            if (distance < minSafeDistance) {
                                resolveCollision(source, target);
                            }
                        }
                    }
                });
                for (let iteration = 0; iteration < forceSimulation.forces.collision.iterations; iteration++) {
                    for (let i = 0; i < connected.length; i++) {
                        for (let j = i + 1; j < connected.length; j++) {
                            if (nodesOverlap(connected[i], connected[j])) {
                                resolveCollision(connected[i], connected[j]);
                            }
                        }
                    }
                }
            }
            positionIsolatedNodes();
        }
        function updatePositions() {
            appState.nodes.forEach(node => {
                node.vx = (node.vx + node.fx) * forceSimulation.velocityDecay;
                node.vy = (node.vy + node.fy) * forceSimulation.velocityDecay;
                node.x += node.vx;
                node.y += node.vy;
                if (appState.snapToGrid) {
                    node.x = Math.round(node.x / appState.gridSize) * appState.gridSize;
                    node.y = Math.round(node.y / appState.gridSize) * appState.gridSize;
                }
            });
        }
        function forceStep() {
            if (!forceSimulation.running || forceSimulation.alpha < forceSimulation.alphaMin) {
                stopForceLayout();
                return;
            }
            const now = Date.now();
            if (now - forceSimulation.nodeClassification.lastClassificationUpdate > 500) {
                classifyNodes();
            }
            applyForces();
            updatePositions();
            forceSimulation.alpha *= (1 - forceSimulation.alphaDecay);
            requestRender();
            if (forceSimulation.running) {
                forceSimulation.animationId = requestAnimationFrame(forceStep);
            }
        }
        function startForceLayout() {
            // Validar que el estado de la aplicación esté inicializado
            if (!appState || !Array.isArray(appState.nodes)) {
                showToast('⚠️ Error: Estado de la aplicación no inicializado', 'error', 2000);
                return;
            }
            
            const nodeCount = appState.nodes.length;
            
            if (nodeCount === 0) {
                showToast('⊛ Añade algunos nodos al canvas para usar el layout dirigido por fuerzas', 'warning', 3000);
                return;
            }
            
            if (nodeCount === 1) {
                showToast('⊛ Se necesita al menos 2 nodos para el layout dirigido por fuerzas', 'warning', 3000);
                return;
            }
            
            try {
                initForceLayout();
                forceSimulation.running = true;
                forceSimulation.alpha = 1.0;
                appState.isForceLayoutActive = true;
                
                if (DOM.forceToggle) {
                    DOM.forceToggle.classList.add('active');
                }
                
                showToast(`⊛ Layout de fuerza iniciado con ${nodeCount} nodos`, 'success', 2000);
                forceStep();
            } catch (error) {
                showToast('❌ Error al iniciar el layout dirigido por fuerzas', 'error', 2000);
            }
        }
        function stopForceLayout() {
            forceSimulation.running = false;
            appState.isForceLayoutActive = false;
            DOM.forceToggle.classList.remove('active');
            if (forceSimulation.animationId) {
                cancelAnimationFrame(forceSimulation.animationId);
                forceSimulation.animationId = null;
            }
            appState.nodes.forEach(node => {
                delete node.vx;
                delete node.vy;
                delete node.fx;
                delete node.fy;
                delete node.targetX;
                delete node.targetY;
            });
            forceSimulation.nodeClassification.connected = [];
            forceSimulation.nodeClassification.isolated = [];
            showToast('⊛ Layout de fuerza detenido', 'info', 1500);
        }
        function toggleForceLayout() {
            try {
                if (appState && appState.isForceLayoutActive) {
                    stopForceLayout();
                    showToast('Layout de fuerza detenido ⊛', 'info', 1500);
                } else {
                    startForceLayout();
                }
            } catch (error) {
                showToast('❌ Error en el layout dirigido por fuerzas', 'error', 2000);
            }
        }
        function zoomCanvas(factor, pivotX = appState.canvas.width / 2, pivotY = appState.canvas.height / 2) {
            const oldScale = appState.viewport.scale;
            const newScale = Math.max(0.1, Math.min(5, oldScale * factor));
            appState.viewport.x = pivotX - (pivotX - appState.viewport.x) * (newScale / oldScale);
            appState.viewport.y = pivotY - (pivotY - appState.viewport.y) * (newScale / oldScale);
            appState.viewport.scale = newScale;
            requestRender();
        }
        function fitCanvas() {
            if (appState.nodes.length === 0) {
                appState.viewport = { x: 0, y: 0, scale: 1 };
                requestRender();
                return;
            }
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            appState.nodes.forEach(node => {
                minX = Math.min(minX, node.x);
                minY = Math.min(minY, node.y);
                maxX = Math.max(maxX, node.x + node.width);
                maxY = Math.max(maxY, node.y + node.height + CONSTANTS.NODE_TEXT_OFFSET); 
            });
            const padding = CONSTANTS.EXPORT_PADDING;
            const contentWidth = maxX - minX;
            const contentHeight = maxY - minY;
            const scaleX = (appState.canvas.width - padding*2) / contentWidth;
            const scaleY = (appState.canvas.height - padding*2) / contentHeight;
            const scale = Math.min(scaleX, scaleY, 2);
            appState.viewport.scale = scale;
            appState.viewport.x = (appState.canvas.width - contentWidth * scale) / 2 - minX * scale;
            appState.viewport.y = (appState.canvas.height - contentHeight * scale) / 2 - minY * scale;
            requestRender();
        }
        function toggleMobileMenu() {
            getDOMElement('sidebar').classList.toggle('open');
        }
        function saveCanvas() {
            const data = {
                nodes: appState.nodes.map(node => ({
                    id: node.id, type: node.type, x: node.x, y: node.y,
                    customName: node.customName, ipAddresses: node.ipAddresses,
                    domain: node.domain, port: node.port, notes: node.notes
                })),
                connectors: appState.connectors.map(conn => ({
                    id: conn.id, startNodeId: conn.startNodeId, endNodeId: conn.endNodeId
                })),
                viewport: appState.viewport,
                nextId: appState.nextId
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            document.body.appendChild(a);
            a.href = url;
            a.download = `dragonjar-scope-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        function loadCanvas() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.style.display = 'none';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (re) => {
                        try {
                            const data = JSON.parse(re.target.result);
                            if (!data || typeof data !== 'object') {
                                throw new Error('Formato de archivo inválido');
                            }
                            if (!Array.isArray(data.nodes) || !Array.isArray(data.connectors)) {
                                throw new Error('El archivo no contiene los datos esperados');
                            }
                            appState.nodes = data.nodes.map(nd => {
                                const node = new CanvasNode(nd.id, nd.type, nd.x, nd.y);
                                if (nd.ipAddress && !nd.ipAddresses) {
                                    nd.ipAddresses = nd.ipAddress ? [nd.ipAddress] : [];
                                    delete nd.ipAddress;
                                }
                                if (!nd.ipAddresses) {
                                    nd.ipAddresses = [];
                                }
                                Object.assign(node, nd);
                                return node;
                            });
                            appState.connectors = data.connectors.map(cd => new Connector(cd.id, cd.startNodeId, cd.endNodeId));
                            appState.viewport = data.viewport || { x: 0, y: 0, scale: 1 };
                            appState.nextId = data.nextId || Math.max(0, ...appState.nodes.map(n=>n.id), ...appState.connectors.map(c=>c.id)) + 1;
                            fitCanvas();
                        } catch (error) {
                            showToast('❌ Error al cargar archivo: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
                document.body.removeChild(input);
            };
            document.body.appendChild(input);
            input.click();
        }
        function exportCanvas() {
            if (appState.nodes.length === 0) {
                showToast('No hay nada que exportar', 'error');
                return;
            }
            showToast('📸 Exportando imagen...', 'info', 2000);
            clearAllSelections();
            const exportPadding = CONSTANTS.EXPORT_PADDING;
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            appState.nodes.forEach(node => {
                minX = Math.min(minX, node.x);
                minY = Math.min(minY, node.y);
                maxX = Math.max(maxX, node.x + node.width);
                maxY = Math.max(maxY, node.y + node.height + CONSTANTS.NODE_TEXT_OFFSET); 
            });
            const contentWidth = maxX - minX;
            const contentHeight = maxY - minY;
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = contentWidth + exportPadding * 2;
            tempCanvas.height = contentHeight + exportPadding * 2;
            tempCtx.translate(-minX + exportPadding, -minY + exportPadding);
            const originalScale = appState.viewport.scale;
            const originalShowGrid = appState.showGrid;
            appState.viewport.scale = 1;
            appState.showGrid = false; 
            appState.connectors.forEach(conn => conn.draw(tempCtx, appState.nodes));
            appState.nodes.forEach(node => node.draw(tempCtx));
            appState.viewport.scale = originalScale;
            appState.showGrid = originalShowGrid;
            tempCanvas.toBlob((blob) => {
                if (!blob) {
                    alert('Error al generar la imagen de exportación');
                    return;
                }
                try {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.href = url;
                    a.download = `dragonjar-scope-${new Date().toISOString().slice(0, 10)}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showToast('Imagen exportada exitosamente ✅', 'success');
                } catch (error) {
                    showToast('Error al exportar: ' + error.message, 'error');
                }
            });
        }
        function setupCustomImageControls() {
            const uploadBtn = getDOMElement('customUploadBtn');
            const customImagesContainer = getDOMElement('customImagesContainer');
            uploadBtn.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/svg+xml,image/png';
                input.style.display = 'none';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        processCustomImage(file, (imageId) => {
                            addCustomImageToSidebar(imageId);
                        });
                    }
                };
                document.body.appendChild(input);
                input.click();
                document.body.removeChild(input);
            });
        }
        function renderCustomImages() {
            const customImagesContainer = getDOMElement('customImagesContainer');
            if (!customImagesContainer) return;
            customImagesContainer.innerHTML = '';
            customImages.forEach((value, key) => {
                addCustomImageToSidebar(key);
            });
        }
        function addCustomImageToSidebar(imageId) {
            const customImagesContainer = getDOMElement('customImagesContainer');
            const customImg = customImages.get(imageId);
            if (!customImg) return;
            const imageBtn = document.createElement('button');
            imageBtn.className = 'tool-button custom-image-btn';
            imageBtn.draggable = true;
            imageBtn.dataset.customImageId = imageId;
            const img = document.createElement('img');
            img.src = customImg.data;
            img.alt = customImg.name;
            const nameSpan = document.createElement('span');
            nameSpan.className = 'custom-image-name';
            nameSpan.textContent = customImg.name.replace(/\.[^/.]+$/, "");
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = '×';
            removeBtn.title = 'Eliminar imagen';
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                customImages.delete(imageId);
                customImageCache.delete(imageId);
                imageBtn.remove();
            });
            imageBtn.appendChild(img);
            imageBtn.appendChild(nameSpan);
            imageBtn.appendChild(removeBtn);
            imageBtn.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', `custom:${imageId}`);
            });
            imageBtn.addEventListener('click', () => {
                if (appState.mode === 'normal') {
                    const rect = canvas.getBoundingClientRect();
                    const centerX = (rect.width / 2 - appState.viewport.x) / appState.viewport.scale;
                    const centerY = (rect.height / 2 - appState.viewport.y) / appState.viewport.scale;
                    const node = new CanvasNode(appState.nextId++, 'custom', centerX - 40, centerY - 40, imageId);
                    appState.nodes.push(node);
                    requestRender();
                }
            });
            customImagesContainer.appendChild(imageBtn);
        }
        function enhanceDropHandler() {
            if (!canvas) return;
            const originalDropHandler = canvas.ondrop;
            canvas.ondrop = (e) => {
                e.preventDefault();
                const data = e.dataTransfer.getData('text/plain');
                if (data.startsWith('custom:')) {
                    const imageId = data.replace('custom:', '');
                    if (customImages.has(imageId)) {
                        const rect = canvas.getBoundingClientRect();
                        const world = getWorldCoordinatesFromEvent(e, rect);
                        const node = new CanvasNode(appState.nextId++, 'custom', world.x - 40, world.y - 40, imageId);
                        appState.nodes.push(node);
                        requestRender();
                    }
                } else {
                    if (originalDropHandler) {
                        originalDropHandler.call(canvas, e);
                    }
                }
            };
        }
        
        
        const ResponsiveUIManager = {
            elements: {
                statusIndicator: null,
                minimapContainer: null,
                originalParent: null
            },
            
            init() {
                this.cacheElements();
                this.setupResponsiveLayout();
                this.setupResizeListener();
            },
            
            cacheElements() {
                this.elements.statusIndicator = document.getElementById('statusIndicator');
                this.elements.minimapContainer = document.getElementById('minimapContainer');
                this.elements.originalParent = this.elements.statusIndicator?.parentNode;
            },
            
            setupResponsiveLayout() {
                if (!this.elements.statusIndicator || !this.elements.minimapContainer) return;
                
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    if (this.elements.statusIndicator.parentNode !== this.elements.minimapContainer) {
                        this.elements.minimapContainer.appendChild(this.elements.statusIndicator);
                    }
                } else {
                    if (this.elements.statusIndicator.parentNode !== this.elements.originalParent) {
                        this.elements.originalParent.appendChild(this.elements.statusIndicator);
                    }
                }
            },
            
            setupResizeListener() {
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        this.setupResponsiveLayout();
                    }, 100);
                });
                
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        this.setupResponsiveLayout();
                    }, 300);
                });
            }
        };
        
    </script>
</body>
</html>
